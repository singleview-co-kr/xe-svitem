v 0.0.1
31st, Dec 2014
1. /tpl/updateitem.html
아래의 코드 추가
<div class="x_control-group">
	<label class="x_control-label" for="display">{$lang->page_type}</label>
	<div class="x_controls">
		<label for="page_type_preparing"><input type="radio" name="page_type" id="page_type_preparing" value="preparing" checked="checked"|cond="$item_info->page_type=='preparing'" />{$lang->preparing_product}</label>
		<label for="page_type_closed_url"><input type="radio" name="page_type" id="page_type_closed_url" value="closed_url" checked="checked"|cond="$item_info->page_type=='closed_url'" />{$lang->closed_url}</label>
	</div>
</div>

2. /lang/lang.xml
아래의 코드 추가
<item name="page_type">
	<value xml:lang="ko"><![CDATA[페이지유형]]></value>
	<value xml:lang="en"><![CDATA[[Page type]]></value>
</item>
<item name="preparing_product">
	<value xml:lang="ko"><![CDATA[제품 준비 중]]></value>
	<value xml:lang="en"><![CDATA[Closed URL]]></value>
</item>
<item name="closed_url">
	<value xml:lang="ko"><![CDATA[폐쇄 URL]]></value>
	<value xml:lang="en"><![CDATA[Not display]]></value>
</item>

3. /nproduct.admin.controller.php::procNproductAdminUpdateItem
아래의 코드 추가
$page_type = Context::get('page_type');

$args->page_type = $page_type;

v 0.0.2
7th, Jan 2015
1. /nproduct.model.php::discountItem()에서

레퍼러에 따른 자동 할인 정책 테스트
아래의 코드를
// 상품개별그룹할인이 없으면 글로벌그룹할인
if(!$output->discount_amount && $item->module_srl)
{
	$output = $this->getGlobalGroupDiscount($item->module_srl, $item, $group_list);
	if(!$output->toBool()) return $output;
}

아래의 코드로 변경
// 상품개별그룹할인이 없으면 글로벌그룹할인
if(!$output->discount_amount && $item->module_srl)
{
	$output = $this->getGlobalGroupDiscount($item->module_srl, $item, $group_list);
	//if(!$output->toBool()) 
	//	return $output;

	if( !$output->discount_amount ) 
	{
		if( strlen( $_SESSION['HTTP_INIT_REFERER'] ) > 0 )
		{
			$sTargetReferrer = 'singleview';
			if( eregi( $sTargetReferrer, $_SESSION['HTTP_INIT_REFERER'] ) >-1 )
			{
				$output->discount_amount = 5000;
				$output->discounted_price -= $output->discount_amount;
				$output->discount_info = $sTargetReferrer.' 회원할인';
			}
		}
		return $output;
	}
}

v 0.0.3
11th, Feb 2015
1. ./skins/inbody/skin.xml에서 상품 목록 페이지의 메인 롤링 배너를 관리자에서 통제하기 위해서 skininfo에 아래의 변수 추가
rolling_img_1
rolling_img_1_floating
rolling_img_1_box_text
rolling_img_1_box_text_link
rolling_img_2
rolling_img_2_floating
rolling_img_2_box_text
rolling_img_2_box_text_link
rolling_img_3
rolling_img_3_floating
rolling_img_3_box_text
rolling_img_3_box_text_link

2. ./skins/inbody/itemlist.html에 관련 변수 추가

v 0.0.4
12th, Feb 2015
1. ./skins/inbody/itemdetail.html에서 바로구매 버튼과 제품 설명 사이에 짧은 description 영역 추가함
2. ./skins/inbody/_footer.html::orderItemsInDetailPage()에서 link_url parameter 추가; user_define link 적용 기능 추가
3. ./skins/inbody/_style.medium_up.html extravars->is_price_undecided 1이면 가격미정으로 표시 변경
4. ./skin/inbody/itemdetail.html에서 extravars->is_price_undecided 1이면 가격, 수량 섹션 표시 안함, 장바구니, 바로구매가 작동되지 않도록 함
5. ./skin/inbody/_footer.html::addItemsToCartInDetailPage에서 bPriceUndecided == 1 이면 '판매 제품이 아닙니다.' 메시지 표시하고 처리 중단
6. ./skin/inbody/_footer.html::orderItemsInDetailPage에서 bPriceUndecided == 1 이면 '판매 제품이 아닙니다.' 메시지 표시하고 처리 중단

v 0.0.5
13th, Feb 2015
1. ./skins/inbody/itemlist.html에 롤링이미지가 설정되지 않으면 롤링배너 섹션 표시안함 조건 추가

v 0.0.6
29th, Mar 2015
1. ./nproduct.admin.view.php::init()에서 cympusadmin 종속성 제거위해 아래의 코드 삭제
// module이 cympusadmin일때 관리자 레이아웃으로
if(Context::get('module')=='cympusadmin')
{
    $classfile = _XE_PATH_.'modules/cympusadmin/cympusadmin.class.php';
    if(file_exists($classfile))
    {
	    require_once($classfile);
	    cympusadmin::init();
    }
}

v 0.0.7
7th, Apr 2015
1. ./nproduct.admin.view.php::init()에서 아래의 코드를 추가
if(Context::get('module')=='svshopmaster')
{
	$this->setLayoutPath('');
	$this->setLayoutFile('common_layout');
}
svshopmaster 레이아웃에서 http://singletest.zc.bz/index.php?module=svshopmaster&act=dispNproductAdminItemList&module_srl=ㅌㅌㅌ 를 호출할 때
$this->module_info->layout_srl에 정보가 있으면 모듈 디자인 설정을 실행하기 때문에 레이아웃을 강제 변경

v 0.0.8
1st, Aug 2015
1. 모듈 이름을 svitem으로 변경

v 0.0.9
9th, Aug 2015
1. ./svitem.model.php::getModuleConfig()에서 svcurrency 모듈이 설치되어 있는 경우에만 호출하도록 변경
if( getClass('svcurrency') ) 조건절 추가

2. ./svitem.view.php::dispSvitemItemList()에서 svreviews 모듈이 설치되어 있는 경우에만 호출하도록 변경
if( getClass('svreview') )
{
	$oStore_reviewModel = &getModel('store_review');
	foreach($item_list as $key => $item)
	{
		$review = $oStore_reviewModel->getTotalReviewInfo($item->item_srl);
		$item_list[$key]->review = $review;
	}
}

3. ./svitem.model.php::getReviews()에서 svreviews 모듈이 설치되어 있는 경우에만 작동하도록 조건절 추가
if( !getClass('svreview') )
	return;

v 0.1.0
15th, Aug 2015
1. svcurrency 모듈 제거하고 svitem 모듈로 기능 병합
./svitem.model.php::getModuleConfig()에서 svcurrency 모듈 호출을 svitem/conf/currency.config.php 로드로 변경
getCurrencyInfo() 메소드 추가

2. svcurrency 모듈 제거하고 svitem 모듈로 기능 병합
./svitem.item.php::svitemItem()에서 $currency = 'KRW', $as_sign = 'N', $decimals = 0 parameter 초기화 비활성 -> svitem.model.php에 의존
./svitem.item.php svitemItem class 전역변수 var $currency; var $as_sign; var $decimals; 초기화 비활성 -> svitem.model.php에 의존
./svitem.item.php::getPrice()에서 svcurrency 모듈 호출을 제거하고 로직 내부화
./svitem.item.php::printPrice()에서 svcurrency 모듈 호출을 제거하고 로직 내부화
./svitem.item.php::setCurrency() 비활성화
./svitem.item.php::price() 비활성화

v 0.1.1
13th, Sep 2015
제품 관리자의 구매옵션 -> 추가가격 기능에서 추가가격을 입력하면 추가가격과 원가격의 합산이 표시되지 않고, 추가가격만 표시되는 문제 해결
./svitem.item.php::getPrice()에서 $nPrice parameter에 값이 입력되고 제품가격과 다른 값이면 추가가격으로 인식하게 변경

v 0.1.2
4th, Oct 2015
./tpl/updateitem.html 화면의 구매옵션->수정 modal 상자 조정하면 svshopmaster iframe 깨지는 현상 해결
./svitem.controller.php::procSvitemInsertOptions()에서 아래의 루틴을
if(!in_array(Context::getRequestMethod(),array('XMLRPC','JSON'))) 
{
	$returnUrl = Context::get('success_return_url') ? Context::get('success_return_url') : getNotEncodedUrl('', 'module','admin','act','dispSvitemAdminUpdateItem','module_srl',Context::get('module_srl'),'item_srl',$item_srl);
	$this->setRedirectUrl($returnUrl);
	return;
}
아래와 같이 변경
if(!in_array(Context::getRequestMethod(),array('XMLRPC','JSON'))) 
{
	$returnUrl = Context::get('success_return_url') ? Context::get('success_return_url') : getNotEncodedUrl('', 'module','svshopmaster','act','dispSvitemAdminUpdateItem','module_srl',Context::get('module_srl'),'item_srl',$item_srl);
	$this->setRedirectUrl($returnUrl);
	return;
}

v 0.1.3
4th, Oct 2015
결제정보 입력화면에서 배송비 선불,착불 선택 기능에 대응
./svitem.model.php::discountItems()에서 아래의 루틴을
if(in_array('svorder', $proc_modules))
{
	if( !$config->freedeliv_amount || ( $ret_obj->total_discounted_price < $config->freedeliv_amount ) )
	{
		$ret_obj->delivery_fee = $config->delivery_fee;
	}
}
아래의 루틴으로 변경
if(in_array('svorder', $proc_modules))
{
	if( !$config->freedeliv_amount || ( $ret_obj->total_discounted_price < (int)$config->freedeliv_amount ) )
	{
		if( $config->shipping_fee_payment_type == 'prepaid' || $config->shipping_fee_payment_type == 'buyer_define' )
			$ret_obj->delivery_fee = $config->delivery_fee;
	}
}

v 0.1.4
3rd, Nov 2015
1. ./svitem.model.php::getDisplayItems()에서 아래의 루틴을
$node_route = 'f.';
아래와 같이 변경
$node_route = '.';
카메론 제품디스플레이 위젯을 사용하기 위해 임시조치


v 0.1.5
17th, Nov 2015
1. 모듈에서 공통 적용되는 글로벌 그룹할인정책 생성(기존 그룹할인 정책 수정)
./tpl/_header.html에서 글로벌 메뉴에 아래의 항목 추가
<block cond="$module_srl">
	<li class="x_active"|cond="$act=='dispSvitemAdminGlobalGroupDiscount'"><a href="{getUrl('act','dispSvitemAdminGlobalGroupDiscount')}">{$lang->global_group_discount}</a></li>
</block>

./conf/module.xml에서 아래의 항목 추가
<action name="dispSvitemAdminGlobalGroupDiscount" type="view" />
<action name="procSvitemAdminGlobalGroupDiscount" type="controller" />

./lang/lang.xml에서 아래의 항목 추가
about_global_group_discount
global_group_discount
title_global_group_discount

./svitem.admin.view.php::dispSvitemAdminGroupDiscount()을 ./svitem.admin.view.php::dispSvitemAdminGlobalGroupDiscount()으로 변경
./tpl/globalgroupdiscount.html 생성

2. 구매자에게 다수 할인 정책이 적용될 때 할인액이 가장 큰 정책을 자동 선별
./svitem.model.php::discountItem() 개편
./svitm.admin.controller.php::procSvitemAdminGlobalGroupDiscount() 생성

v 0.1.6
18th, Nov 2015
1. v.0.1.6 수정에서 할인정책이 없는 경우 결제가격 정보 상실 오류를 해결
아래의 할인정책 판단 루틴을 
if( $nMaxDiscAmnt < $oGroupDiscountOutput->discount_amount )
{
	$sMaxDiscPolicy = 'oGroupDiscountOutput';
	$nMaxDiscAmnt = (int)$oGroupDiscountOutput->discount_amount;
}

아래와 같이 수정 할인정보가 없어도 ->discounted_price 정보가 입력되면 할인정책 채택
if( $nMaxDiscAmnt < $oGroupDiscountOutput->discount_amount || $oGroupDiscountOutput->discounted_price )
{
	$sMaxDiscPolicy = 'oGroupDiscountOutput';
	$nMaxDiscAmnt = (int)$oGroupDiscountOutput->discount_amount;
}

v 0.1.7
20th, Nov 2015
1. ./svitem.mobile.php 초기화

v 0.3.0
12th, Dec 2015
1. 프로모션 기능을 svpromotion으로 이전
아래의 메소드 비활성화 -> 삭제 예정
./svitem.model.php::discountItem(&$item, $group_list=null)
./svitem.model.php::discountItems(&$item_list, $group_list=array(), $width=50, $height=50 )
./svitem.model.php::getDiscount(&$item_info)
./svitem.model.php::getGroupDiscount(&$item_info, $group_list) 
./svitem.model.php::getGlobalGroupDiscount($module_srl, &$item_info, $group_list) 
./svitem.model.php::getQuantityDiscount(&$item_info, $logged_info)
./svitem.model.php::getMemberDiscount(&$item_info, $logged_info)

./svitem.view.php::dispSvitemItemList()에서 아래의 코드를
$discounted = $oSvitemModel->discountItems($item_list);
Context::set('list', $discounted->item_list);

아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$discounted = $oSvpromotionModel->getItemPriceList($item_list);
Context::set('list', $discounted );

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$output = $oSvitemModel->discountItem($item_info);
아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$output = $oSvpromotionModel->getItemPriceDetail($item_info);

./skins/plain/itemdetail_spec.html에서 아래의 코드 추가
&nbsp;<span id='discount_info'>({$discount_info})

./m.skins/trendshop/itemdetail_spec.html에서 아래의 코드 추가
&nbsp;<span id='discount_info'>({$discount_info})

아래의 DB 스키마 제거 예정
./schemas/svitem_member_discount.xml
./schemas/svitem_group_discount.xml
./schemas/svitem_global_group_discount.xml
./schemas/svitem_quantity_discount.xml

./svitem.item.php::getPrice()에서 아래의 코드 비활성화
//else
//	$nPrice += $this->price;

./tpl/_header.html에서 글로벌 그룹할인 메뉴 삭제
./tpl/globalgroupdiscout.html 삭제
./lang/lang.xml에서 글로벌 그룹할인 관련 단어 삭제

./svitem.admin.view.php::dispSvitemAdminGlobalGroupDiscount() 제거
./queries/getGlobalGroupDiscount.xml 제거
./conf/module.xml에서 아래의 코드 제거
<action name="dispSvitemAdminGlobalGroupDiscount" type="view" />

./svitem.admin.controller.php::procSvitemAdminGlobalGroupDiscount() 제거
./queries/deleteGlobalGroupDiscount.xml 제거
./queries/insertGlobalGroupDiscount.xml 제거
./conf/module.xml에서 아래의 코드 제거
<action name="procSvitemAdminGlobalGroupDiscount" type="controller" />

./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 아이템별 group_discount 관련 코드 블록 해제
./queries/getGroupDiscount.xml 제거

./svitem.admin.model.php::getSvitemAdminItemList() 추가

./schemas/svitem_items.xml에 아래의 코드 제거
<column name="discount_amount" type="number" size="11" default="0" notnull="notnull" />
<column name="discount_info" type="varchar" size="250" />

./schemas/svitem_items.xml에 아래의 코드 추가
<column name="ga_brand_name" type="varchar" size="64" notnull="notnull" />
<column name="ga_category_name" type="varchar" size="64" notnull="notnull" />
<column name="ga_variation_name" type="varchar" size="64" notnull="notnull" />

./tpl/updateitem.html에서 할인금액, 할인제목 입력란 삭제
./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드 제거
$discount_amount = Context::get('discount_amount');
$discount_info = Context::get('discount_info');
$args->discount_amount = $discount_amount;
$args->discount_info = $discount_info;

// before
$output = ModuleHandler::triggerCall('svitem.updateItem', 'before', $args);
if (!$output->toBool())
	return $output;

그룹 할인 코드 블록

./queries/updateItemAdmin.xml에서 아래의 코드 제거
./queries/getDisplayItems.xml에서 아래의 코드 제거
./queries/insertItem.xml에서 아래의 코드 제거
./queries/updateItem.xml에서 아래의 코드 제거
<column name="discount_amount" var="discount_amount" />
<column name="discount_info" var="discount_info" default="" />

./svitem.admin.model.php::getModInstList() 추가
./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 getModInstList() 호출

수량 할인 기능 작동 위해 $item_info 구조체에 buying_quantity 멤버 추가
./svitem.controller.php::procSvitemAddItemsToCartObj()에서 아래의 코드 추가
// 수량 할인 기능 추가 위해 구조체 확장
$item_info->buying_quanity = $val->quantity;


v 0.3.1
14th, Dec 2015
1. 프로모션 기능
./svitem.admin.model.php::getAllValidItemList()에서 아래의 코드를
$retobj = $this->discountItems($list);
아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$retobj = $oSvpromotionModel->getItemPriceList($list);

./svitem.admin.model.php::getUpdatedItemList()에서 아래의 코드를
$retobj = $this->discountItems($list);
아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$retobj = $oSvpromotionModel->getItemPriceList($list);

./svitem.admin.model.php::getSvitemItemInfos()에서 아래의 코드를
$items = $this->discountItems($items, $group_list, $image_width, $image_height);
아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$items = $oSvpromotionModel->getItemPriceList($items, $group_list);

./svitem.model.php::getFrontDisplayItems()에서 아래의 코드를
$retobj = $this->discountItems($val->items);
아래와 같이 변경
$retobj = $oSvpromotionModel->getItemPriceList($val->items);

./svitem.model.php::getDisplayItems()에서 아래의 코드를
$retobj = $this->discountItems($items);
아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$retobj = $oSvpromotionModel->getItemPriceList($items);

v 0.4.0
15th, Dec 2015
1. 기존 등록 제품들을 새로운 가격으로 패키징하는 번들링 상품 생성 기능 추가
./skins/plain/item_detail.html에서 번들링 제품 표시 영역 추가
./tpl/updateitem.html에서 번들 구성 기능 추가
./tpl/js/updateitem.js에서 번들 구성 바인드 함수 추가

./conf/module.xml에 아래의 코드 추가
<action name="getSvitemAdminInsertBundling" type="model" />
<action name="procSvitemAdminInsertBundling" type="controller" />

./svitem.admin.model.php::getSvitemAdminInsertBundling()추가
./svitem.admin.controller.php::procSvitemAdminInsertBundling() 추가

./schema/svitem_bundles.xml 추가

./tpl/skin.js/itemdetail.js::getCartParamsInDetailPage()에서
번들링 제품 관련 변수 확인 및 컴파일 코드 블록 추가

./svitem.controller.php::procSvitemAddItemsToCartObj()에서 번들링 제품 선택 정보 관련 코드블록 추가

2. 잘못 구성된 controller 메소드 이전
./conf/module.xml에서 아래의 코드를
<action name="procSvitemInsertOptions" type="controller" />
아래와 같이 변경
<action name="procSvitemAdminInsertOptions" type="controller" />

./svitem.controller.php::procSvitemInsertOptions() 제거
./svitem.admin.controller.php::procSvitemAdminInsertOptions() 생성
./svitem.model.php::getBundlings() 생성

3. 불필요한 중복 메소드 제거
./svitem.controller.php::procSvitemAddItemsToCart() 제거
./tpl/skin.js::direct_order()에서 procSvitemAddItemsToCart 호출을 procSvitemAddItemsToCartObj로 변경
./tpl/skin.js::addItemsToCart()에서 procSvitemAddItemsToCart 호출을 procSvitemAddItemsToCartObj로 변경


v 0.4.1
20th, Feb 2016
1. FB 라이크 버튼 누르면 할인해주는 기능 추가
./skins/plain/item_detail_spec.html에서 FB edge API 추가
./skins/plain/item_detail_spec.html에서 페이스북 라이크 DIV 추가
./m.skins/trendshop/item_detail_spec.html에서 FB edge API 추가
./m.skins/trendshop/item_detail_spec.html에서 페이스북 라이크 DIV 추가

./tpl/skin.js/itemdetail.js::calculate_sum()에서 아래의 코드 추가
if( g_bFB_liked == 1 )
{
	g_decimals = 0;
	related_sum = float2int( related_sum * (1-0.3) );
}
./tpl/skin.js/itemdetail.js::float2int() 추가


./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드 추가
$oConditionalPromotion = $oSvpromotionModel->getItemConditionalPromotionDetail($item_info);
if( $oConditionalPromotion->fb_like_additional_discount_amount > 0 )
{
	Context::set('fb_like_app_id', $oConditionalPromotion->fb_like_app_id);
	Context::set('additional_conditional_discount_amount', $oConditionalPromotion->fb_like_additional_discount_amount);
	Context::set('additional_conditional_discount_info', $oConditionalPromotion->fb_like_additional_discount_info);
}

./tpl/skin.js/itemdetail.js::_g_nFbLikedPromtionAmnt 변수 추가
./tpl/skin.js/itemdetail.js::getTotalPrice()에 아래의 코드 추가
if( g_bFB_liked == 1 )
{
	price = float2int( price - 330 );
}

./tpl/skin.js/itemdetail.js::calculate_sum()에 아래의 코드 추가
var sFbLikePromotion = '';
if( g_bFB_liked == 1 )
	sFbLikePromotion = "&nbsp;&nbsp;<span style='font-size:12px; color:red;'>좋아해 주셔서 감사드려요!</span>";

./tpl/skin.js/itemdetail.js::getCartParamsInDetailPage()에 아래의 코드 추가
param.fb_liked = g_bFB_liked;

./tpl/skin.js/itemdetail.js::applyFbLikePromotion() 추가

./svitem.admin.controller.php::procSvitemAddItemsToCartObj()에 아래의 코드 추가
// 아이템별 부가 할인 정책 가져오기
if( $val->fb_liked == 1 )
{
	$oConditionalPromotion = $oSvpromotionModel->getItemConditionalPromotionDetail($item_info);
	if( $oConditionalPromotion->fb_like_additional_discount_amount > 0 )
	{
		$item_info->discount_info = $item_info->discount_info.' '.$oConditionalPromotion->fb_like_additional_discount_info;
		$item_info->discount_amount = $item_info->discount_amount + $oConditionalPromotion->fb_like_additional_discount_amount;
		$item_info->discounted_price = $item_info->discounted_price - ($val->quantity * $oConditionalPromotion->fb_like_additional_discount_amount);
		$args->conditional_promotion = 'fblike';
	}
}

./svitem.model.php::getSvitemFbLikePromoInfo() 추가

v 0.4.2
29th, Feb 2016
1. 상세페이지 통화기호 표시 오류 임시 해결
./svitem.model.php::getCurrencyInfo()에서 아래의 코드 주석 처리
// 제품 상세페이지에서 통화기호 표시 안되서 무조건 KRW 정보 전송
//$sCurrencyConfigFilePath = _XE_PATH_.'modules/svitem/conf/currency.config.php';
//if( !FileHandler::exists( $sCurrencyConfigFilePath ) )
//{
	$currency->currency = 'KRW';
	$currency->as_sign = 'Y';
	$currency->decimals = 0;
//}
//else
//	require_once( $sCurrencyConfigFilePath );

2. 제품 구매 옵션이 없어도 라이크 할인 적용되도록 수정
./tpl/skin.js/itemdetail.js::getCartParamsInDetailPage()에 아래의 코드 추가
if (options_count == 0) {
	var item = new Object();
	item.item_srl = item_srl;
	item.quantity = jQuery('#quantity_'+item_srl).val();
	item.fb_liked = _g_bFB_liked;   // 추가

	if( $oSelectedBundleItems !== undefined && $oSelectedBundleItems !== null)
	{
		if( oCompiledFinalBundleItems.length > 0 )
			item.bundling_items = oCompiledFinalBundleItems;
	}
	param[param.length] = item;
}

./tpl/skin.js/itemdetail.js::getTotalPrice()에 구매옵션 표시 여부에 따라 처리 루틴 분기
./tpl/skin.js/itemdetail.js::calculate_sum()에 구매옵션 표시 여부에 따라 처리 루틴 분기
아래의 코드를
jQuery('#related_sum').html(number_format(related_sum + sFbLikePromotion ));
아래와 같이 변경
if( jQuery('#related_sum').length) // 구매 옵션이 표시되었을 때
	jQuery('#related_sum').html(number_format(related_sum + sFbLikePromotion ));
else // 구매 옵션이 없을 때
{
	if( _g_bFB_liked == 1 ) // 페북 라이크 할인이 없으면, 가격 변경하지 않음
		jQuery('#sales_price').html(number_format(related_sum + sFbLikePromotion ));
}

./svitem.item.php::printPrice()에서 아래의 코드를
if( $this->as_sign == 'Y' )
{
	$currency = $lang->currency_sign[$this->currency];
	return sprintf("<span class=\"currency_symbol\">%s</span>%s", $currency, number_format($price, $this->decimals));
}
else
{
	$currency = $lang->currency_code[$this->currency];
	return sprintf("%s<span class=\"currency_code\">%s</span>", number_format($price, $this->decimals), $currency);
}
아래의 코드로 변경
if( $this->as_sign == 'Y' )
{
	$currency = $lang->currency_sign[$this->currency];
	return sprintf("<span class=\"currency_symbol\">%s</span><span id=\"sales_price\">%s</span>", $currency, number_format($price, $this->decimals));
}
else
{
	$currency = $lang->currency_code[$this->currency];
	return sprintf("<span id=\"sales_price\">%s</span><span class=\"currency_code\">%s</span>", number_format($price, $this->decimals), $currency);
}

v 0.4.3
13th, Mar 2016
1. 라이크 할인, 기본 할인 동시 적용 논리 추가
./tpl/skin.js/itemdetail.js::calculate_sum()에 아래의 크드 블록 적용
if( jQuery('#related_sum').length) // 구매 옵션이 표시되었을 때
{
	jQuery('#related_sum').html(number_format(related_sum ));
	if( _g_bFB_liked == 1 && !_g_bFB_liked_normal_price_changed ) // 페북 라이크 할인이 없으면, 가격 변경하지 않음
	{
		jQuery('#normal_price_tag').wrap('<strike>');
		jQuery('#discounted_price').html(number_format(g_discounted_price));
		
		var sPromotionTitle = '';
		if( jQuery('#discounted_price_tag').is(':visible') )
			sPromotionTitle = jQuery('#discount_info').html() + ' + ' + sFbLikePromotion;
		else
			sPromotionTitle = sFbLikePromotion;
		
		jQuery('#discount_info').html( sPromotionTitle );
		jQuery('#discounted_price_tag').show();
		_g_bFB_liked_normal_price_changed++; // 재실행 방지
	}
}

./tpl/skin.js/itemdetail.js::drawPriceTag()에 추가

./skins/plain/itemdetail_spec.html에 아래의 코드 블록 추가, 통화기호와 제품 가격 관련 HTML을 스킨으로 이전
<tr>
	<th>{$lang->sales_price}</th>
	<td>
		<span id='normal_price_tag'><span class='currency_symbol'>₩</span><span id='sales_price'>{$item_info->price}</span></span>
		<span id='discounted_price_tag' style="display:none">
			<span class='currency_symbol'>₩</span><span id='discounted_price'>{$discounted_price}</span>&nbsp;(<span id='discount_info'>{$discount_info}</span>)
		</span>
	</td>
</tr>

2. ./svitem.controller.php::procSvitemAddItemsToCartObj()에서, 
svpromotion.model.php::getCouponInfoBySerialNumber() 코드 블록 변경에 따라 아래의 코드를 
$item_info->discount_amount = $item_info->discount_amount + $oConditionalPromotion->fb_like_additional_discount_amount;
$item_info->discounted_price = $item_info->discounted_price - ($val->quantity * $oConditionalPromotion->fb_like_additional_discount_amount);

아래와 같이 변경
$item_info->discount_amount = $oConditionalPromotion->fb_like_additional_discount_amount;
$item_info->discounted_price = ($item_info->price - $oConditionalPromotion->fb_like_additional_discount_amount)*$val->quantity;

v 0.4.4
27th, Mar 2016
1. 구매에 적용된 할인 체계 정리
./svitem.controller.php::procSvitemAddItemsToCartObj()에서 아래의 코드를
$item_info->discount_info = $output->discount_info;
아래와 같이 변경
$oDiscountInfo = new stdClass();
$oDiscountInfo->version = '1.0';
$oDiscountInfo->promotion[0]->type = 'item_policy';
$oDiscountInfo->promotion[0]->unit_disc_amnt = $output->discount_amount;
$oDiscountInfo->promotion[0]->title = $output->discount_info;
$item_info->discount_info = $oDiscountInfo;

./svitem.controller.php::procSvitemAddItemsToCartObj()에서 아래의 코드를
$item_info->discount_info = $item_info->discount_info.' '.$oConditionalPromotion->fb_like_additional_discount_info;
아래와 같이 변경
$oConditionalPromotionInfo = new stdClass();
$$oConditionalPromotionInfo->version = '1.0';
$oConditionalPromotionInfo->promotion[0]->type = 'fblike';
$oConditionalPromotionInfo->promotion[0]->resultant_disc_amnt = $oConditionalPromotion->fb_like_additional_discount_amount;
$oConditionalPromotionInfo->promotion[0]->title = $oConditionalPromotion->fb_like_additional_discount_info;
$args->conditional_promotion = $oConditionalPromotionInfo;

v 0.4.5
29th, Mar 2016
1. svitem과 svcart MECE 강화
./svitem.controller.php::procSvitemAddItemsToCartObj()의 코드 블록을 ./svcart.controller.php::createCartObj()로 이전

v 0.4.6
2nd, Apr 2016
1. FB share promotion 추가
./svitem.model.php::getSvitemFbLikePromoInfo()을 getSvitemConditionalPromoInfo()로 변경
아래의 코드를
if( $oConditionalPromotion->conditi_additional_discount_amount > 0 )
	$this->add('nFbLikePromoAmnt', $oConditionalPromotion->fb_like_additional_discount_amount );
아래와 같이 변경
if( $oConditionalPromotion->conditional_additional_discount_amount > 0 )
	$this->add('nConditionalPromoAmnt', $oConditionalPromotion->conditional_additional_discount_amount );

./conf/module.xml에서 아래의 코드를
<action name="getSvitemFbLikePromoInfo" type="model" />
아래의 코드로 변경
<action name="getSvitemConditionalPromoInfo" type="model" />

./tpl/skin.js/itemdetail.js::applyFbLikePromotion()에서 아래의 코드를
params['item_srl'] = item_srl;
var respons = ['nFbLikePromoAmnt'];
exec_xml('svitem', 'getSvitemFbLikePromoInfo', params, function(ret_obj) {
아래와 같이 변경
params['item_srl'] = item_srl;
params['promotion_type'] = 'fblike';
var respons = ['nFbLikePromoAmnt'];
exec_xml('svitem', 'getSvitemConditionalPromoInfo', params, function(ret_obj) {

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$oConditionalPromotion = $oSvpromotionModel->getItemConditionalPromotionDetail($item_info);
if( $oConditionalPromotion->fb_like_additional_discount_amount > 0 )
{
	Context::set('fb_like_app_id', $oConditionalPromotion->fb_like_app_id);
	Context::set('additional_conditional_discount_amount', $oConditionalPromotion->fb_like_additional_discount_amount);
	Context::set('additional_conditional_discount_info', $oConditionalPromotion->fb_like_additional_discount_info);
}
아래와 같이 변경
$oConditionalPromotion = $oSvpromotionModel->getItemConditionalPromotionList($item_info);
if( $oConditionalPromotion->conditional_additional_discount_amount > 0 )
{
	Context::set('fb_app_id', $oConditionalPromotion->fb_app_id);
	Context::set('additional_conditional_discount_amount', $oConditionalPromotion->conditional_additional_discount_amount);
	Context::set('additional_conditional_discount_info', $oConditionalPromotion->fb_like_additional_discount_info);
}

./skins/plain/itemdetail_spec.html에서 아래의 코드를
FB.init({
	appId: '{$fb_like_app_id}', 
	status: false,
	cookie: false,
	xfbml: true
});
아래와 같이 변경
FB.init({
	appId: '{$fb_app_id}', 
	status: false,
	cookie: false,
	xfbml: true
});

./m.skins/trendshop/itemdetail_spec.html에서 아래의 코드를
FB.init({
	appId: '{$fb_like_app_id}', 
	status: false,
	cookie: false,
	xfbml: true
});
아래와 같이 변경
FB.init({
	appId: '{$fb_app_id}', 
	status: false,
	cookie: false,
	xfbml: true
});

./tpl/skin.js/itemdetail.js::applyFbSharePromotion() 추가
./tpl/skin.js/itemdetail.js::_g_nFbSharedPromtionAmnt 추가
./tpl/skin.js/itemdetail.js::_g_bFB_shared 추가

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
if( $oConditionalPromotion->conditional_additional_discount_amount > 0 )
{
	Context::set('fb_app_id', $oConditionalPromotion->fb_app_id);
	Context::set('additional_conditional_discount_amount', $oConditionalPromotion->conditional_additional_discount_amount);
	Context::set('additional_conditional_discount_info', $oConditionalPromotion->conditional_additional_discount_info);
}
아래와 같이 변경
foreach( $oConditionalPromotion->promotion as $key => $val )
{
	if( $val->conditional_additional_discount_amount > 0 )
	{
		$nConditionalAdditionalDisc += $val->conditional_additional_discount_amount;
		if( $val->conditional_additional_discount_type == 'fblike' )
			$oFbLikePromotion = $oConditionalPromotion->promotion[$key];
		if( $val->conditional_additional_discount_type == 'fbshare' )
			$oFbSharePromotion = $oConditionalPromotion->promotion[$key];
	}
}
if( $nConditionalAdditionalDisc  > 0 )
{
	Context::set('fb_app_id', $oConditionalPromotion->fb_app_id);
	Context::set('additional_conditional_discount_amount', $nConditionalAdditionalDisc );
	Context::set('additional_conditional_discount_info_fblike', $oFbLikePromotion);
	Context::set('additional_conditional_discount_info_fbshare', $oFbSharePromotion);
}

./skins/plain/itemdetail_spec.html에서 아래의 코드를
<td>{$additional_conditional_discount_info}</td>
아래와 같이 변경
<span cond="$additional_conditional_discount_info_fblike->conditional_additional_discount_info">{$additional_conditional_discount_info_fblike->conditional_additional_discount_info}<BR></span>
<span cond="$additional_conditional_discount_info_fbshare->conditional_additional_discount_info"><a href="#" onclick="shareonfacebook()"><img src="../../tpl/img/btn_fbshare_50x18.png" /></a>{$additional_conditional_discount_info_fbshare->conditional_additional_discount_info}</span>

v 0.4.7
16th, May 2016
1. 장바구니, 바로구매 버튼 누를 때 재고부족하면 처리 거부 루틴; svcart v 0.3.3 변경에 대응
./svitem.controller.php::procSvitemAddItemsToCartObj()에서 
아래의 코드를
$aCartSrl = $oSvcartController->createCartObj();

아래와 같이 변경
$oRet = $oSvcartController->createCartObj();
if( !$oRet->toBool() )
	return $oRet;
$aCartSrl = $oRet->get('cart_srl_arr');

2. 새로운 아이템별 재고 확인 메소드 추가
./svitem.model.php::getItemStock() 추가
./svitem.controller.php::addItemsToUnifiedCart()에서 아래의 코드를
$stock = $oSvitemModel->getItemExtraVarValue($item_info->item_srl, 'stock');
아래와 같이 변경
$stock = $oSvitemModel->getItemStock($item_info->item_srl);

3. 새로운 아이템별 재고 변경 메소드 추가
./svitem.controller.php::setItemStock() 추가

v 0.4.8
17th, May 2016
1. 외부 서버에서 아이템별 재고 잔량 가져오기
./tpl/config.html에 아래의 코드 추가
<fieldset class="section">
<h1>{$lang->connect_external_stock_server}</h1>
<ul>
	<li>
		<p class="q">{$lang->select_server}</p>
		<p class="a">
			<select name="external_server_type">
				<option value='' selected="selected"|cond="$config->external_server_type==''">{$lang->connect_internal_stock_server}</option>
				<option value='ecaso' selected="selected"|cond="$config->external_server_type=='ecaso'">ecaso</option>
			</select>
		</p>
		<p class="desc">{$lang->about_select_server}</p>
	</li>
</ul>
</fieldset>

./svitem.model.php::getItemStock()에 아래의 코드 추가
$config = $this->getModuleConfig();
if( $config->external_server_type == 'ecaso' )
{
	$args->item_srl = $nItemSrl;
	$output = executeQuery('svitem.getItemInfo', $args);
	if (!$output->toBool())
		return;
	
	if( strlen($output->data->item_code)>0)
	{
		$oItemCode=explode('|',$output->data->item_code);
		unset($output);
	}
	
	$nItemCodeCnt = count( $oItemCode );
	switch( $nItemCodeCnt )
	{
		case 1: // item without option
			$data = array('puid' => $oItemCode[0]);
			break;
		case 2: // item with option
			$data = array('puid' => $oItemCode[0], 'opuid' => $oItemCode[1]);
			break;
	}

	$url = 'http://211.115.91.247/api/balance_pr_num.php';
	$data = array('puid' => '836', 'opuid' => '1302');

	// use key 'http' even if you send the request to https://...
	$options = array(
		'http' => array(
			'header'  => "Content-type: application/x-www-form-urlencoded\r\n",
			'method'  => 'POST',
			'content' => http_build_query($data)
		)
	);
	$context  = stream_context_create($options);
	$sResult = file_get_contents($url, false, $context);
	if( $sResult === FALSE )
		return 0;
	else // a valid return consisted of nStockQty | nPuid {| nOpuid}
	{
		$oResult=explode('|',$sResult);
		switch( $nItemCodeCnt )
		{
			case 1: // item without option
				if( $oResult[1] == $oItemCode[0])
					return (int)$oResult[0];
				else
					return 0;
				break;
			case 2: // item with option
				if( $oResult[1] == $oItemCode[0] && $oResult[2] == $oItemCode[1] )
					return (int)$oResult[0];
				else
					return 0;
				break;
		}
	}
	return 0;
}

v 0.4.9
18th, May 2016
1. 안전 재고 기능 추가
./tpl/config.html에 아래의 코드 추가
<li>
	<p class="q">{$lang->default_safe_stock}</p>
	<p class="a">
		<input type="text" name="default_safe_stock" value="{$config->default_safe_stock}" />
	</p>
	<p class="desc">{$lang->about_default_safe_stock}</p>
</li>

./svitem.model.php::getItemStock()를 아래와 같이 변경
$config = $this->getModuleConfig();
$args->item_srl = $nItemSrl;
$output = executeQuery('svitem.getItemInfo', $args);
if (!$output->toBool())
	return 0;

$nDefaultSafeStock = (int)$config->default_safe_stock;
$nSafeStockByItem = (int)$output->data->safe_stock;

$nSafeStock = $nDefaultSafeStock;

if( $nSafeStockByItem > 0 )
	$nSafeStock = $nSafeStockByItem;

if( $config->external_server_type == 'ecaso' )
{
	require_once(_XE_PATH_.'modules/svitem/ecaso.class.php');
	$oExtServer = new ecaso( $output->data->item_code );
	$nCurrentStock = $oExtServer->getStock();
}
else
	$nCurrentStock = (int)$this->getItemExtraVarValue($nItemSrl, 'stock');

if( $nSafeStock >= $nCurrentStock )
	return 0;
else 
	return $nCurrentStock;

./ecaso.class.php 추가하고 기존 svitem.model.php::getItemStock()에서 이카소 관련 내용을 이관

./schemas/svitem_items.xml에 아래의 코드 추가
<column name="safe_stock" type="number" size="11" default="0" notnull="notnull" />

./tpl/updateitem.html에 아래의 코드 추가
<div class="x_control-group">
	<label class="x_control-label" for="item_safe_stock">{$lang->item_safe_stock} </label>
	<div class="x_controls">
		<input name="price" type="text" class="inputTypeText w100" value="{$item_info->item_safe_stock}" />
	</div>
</div>

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$safe_stock = Context::get('safe_stock');
$args->safe_stock = $safe_stock;

./queries/updateItemAdmin.xml에 아래의 코드 추가
<column name="safe_stock" var="safe_stock" />

v 0.5.0
19th, Jun 2016
1. 제품 정보에 GA EEC 데이터 추가
./schemas/svitem_items.xml에서 아래의 코드 삭제
<column name="ga_brand_name" type="varchar" size="64" />
<column name="ga_category_name" type="varchar" size="64" />
<column name="ga_variation_name" type="varchar" size="64" />

./schemas/svitem_items.xml에서 아래의 코드 추가
<column name="enhanced_item_info" type="text" />

./skin/plain/itemdetail_spec.html에서 아래의 코드 제거
{@
$aItemName = explode( '_', $item_info->item_name );
$sBrandName = $aItemName[0];
$sVariant = $aItemName[1];
}

./skin/plain/itemdetail_spec.html에 아래의 코드를
gatkDetail.loadItemInfo( '{$item_info->item_srl}', '{$sBrandName}', '{$sBrandName}', '{$sBrandName}', '{$sVariant}', '{$item_info->discounted_price}' );
아래와 같이 변경
gatkDetail.loadItemInfo( '{$item_info->item_srl}', '{$item_info->item_name}', '{$item_info->enhanced_item_info->ga_category_name}', '{$item_info->enhanced_item_info->ga_brand_name}', '{$item_info->enhanced_item_info->ga_variation_name}', '{$item_info->discounted_price}' );

./m.skin/trendshop/itemdetail_spec.html에서 아래의 코드 제거
{@
$aItemName = explode( '_', $item_info->item_name );
$sBrandName = $aItemName[0];
$sVariant = $aItemName[1];
}

./m.skin/trendshop/itemdetail_spec.html에 아래의 코드를
gatkDetail.loadItemInfo( '{$item_info->item_srl}', '{$sBrandName}', '{$sBrandName}', '{$sBrandName}', '{$sVariant}', '{$item_info->discounted_price}' );
아래와 같이 변경
gatkDetail.loadItemInfo( '{$item_info->item_srl}', '{$item_info->item_name}', '{$item_info->enhanced_item_info->ga_category_name}', '{$item_info->enhanced_item_info->ga_brand_name}', '{$item_info->enhanced_item_info->ga_variation_name}', '{$item_info->discounted_price}' );

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$oEnhancedItemInfo = new stdClass();
$sGaBrandName = strip_tags( Context::get('ga_brand_name') );
$sGaCategoryName = strip_tags( Context::get('ga_category_name') );
$sGaVariationName = strip_tags( Context::get('ga_variation_name') );
$oEnhancedItemInfo->ga_brand_name = $sGaBrandName;
$oEnhancedItemInfo->ga_category_name = $sGaCategoryName;
$oEnhancedItemInfo->ga_variation_name = $sGaVariationName;
$args->enhanced_item_info = serialize($oEnhancedItemInfo);

./svitem.item.php::svitemItem()에 아래의 코드 추가
$this->enhanced_item_info = unserialize( $info->enhanced_item_info );

./skin/plain/list.html에서 아래의 코드 제거
{@
$aItemName = explode( '_', $val->item_name );
$sBrandName = $aItemName[0];
$sVariant = $aItemName[1];
}

./skin/plain/list.html에 아래의 코드를
gatkList.queueItemInfo( '{$val->item_srl}', '{$val->item_name}', '{$sBrandName}', '{$sBrandName}', '{$sVariant}' );
아래와 같이 변경
gatkList.queueItemInfo( '{$val->item_srl}', '{$val->item_name}', '{$val->enhanced_item_info->ga_category_name}', '{$val->enhanced_item_info->ga_brand_name}', '{$val->enhanced_item_info->ga_variation_name}' );

./m.skin/trendshop/list_grid.html에서 아래의 코드 제거
{@
$aItemName = explode( '_', $val->item_name );
$sBrandName = $aItemName[0];
$sVariant = $aItemName[1];
}

./m.skin/trendshop/list.html에 아래의 코드를
gatkList.queueItemInfo( '{$val->item_srl}', '{$sBrandName}', '{$sBrandName}', '{$sBrandName}', '{$sVariant}' );
아래와 같이 변경
gatkList.queueItemInfo( '{$val->item_srl}', '{$val->item_name}', '{$val->enhanced_item_info->ga_category_name}', '{$val->enhanced_item_info->ga_brand_name}', '{$val->enhanced_item_info->ga_variation_name}' );

v 0.5.1
28th, Jun 2016
1. 상품 등록시 GA EEC 데이터 입력 기능 추가
./tpl/insertitem.html에서 해당 입력란 활성화
./svitem.controller.php::insertItem() 비활성화
./svitem.controller.php::insertItem()을 ./svitem.admin.controller.php::insertItem()으로 이동
./queries/insertitem.xml에 아래의 코드 추가
<column name="enhanced_item_info" var="enhanced_item_info" />

./svitem.admin.controller.php::procSvitemAdminInsertItem()에서 아래의 코드를
$output = $oSvitemController->insertItem($args);
아래와 같이 변경
$output = $this->insertItem($args);

v 0.5.2
12th, Jul 2016
1. 제품 관리자에 PC용 상세 페이지 내용과 모바일용 상세 페이지 내용 분리하고 모바일 상세 페이지 내용 없으면 PC용 내용 출력
./tpl/updateitem.html 변경

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드 추가
if( strlen( Context::get('description_skin_pc') ) > 0 )
	$extra_vars->description_skin_pc = new NExtraItem($val->module_srl, 9998, 'description_skin_pc', 'description_skin_pc', 'text', '', 'description_skin_pc', 'N', 'N', trim(Context::get('description_skin_pc')));
	
if( strlen( Context::get('description_skin_mob') ) > 0 )
	$extra_vars->description_skin_mob = new NExtraItem($val->module_srl, 9999, 'description_skin_mob', 'description_skin_mob', 'text', '', 'description_skin_mob', 'N', 'N', trim(Context::get('description_skin_mob')));

./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 아래의 코드 추가
$oHiddenExtraVars = unserialize( $item_info->extra_vars );
Context::set('description_skin_pc_selected', $oHiddenExtraVars->description_skin_pc->value);
Context::set('description_skin_mob_selected', $oHiddenExtraVars->description_skin_mob->value);

./svitem.view.php::dispSvitemAdminUpdateItem()에서 아래의 코드 추가
$sDescriptionSkinPath = _XE_PATH_.'files/svitem/';
$oHiddenExtraVars = unserialize( $item_info->extra_vars );
if( strlen( $oHiddenExtraVars->description_skin_pc->value ) > 0 )
	Context::set('description_skin_pc_selected', $sDescriptionSkinPath.$oHiddenExtraVars->description_skin_pc->value);
if( strlen( $oHiddenExtraVars->description_skin_mob->value ) > 0 )
	Context::set('description_skin_mob_selected', $sDescriptionSkinPath.$oHiddenExtraVars->description_skin_mob->value);

v 0.5.3
17th, Jul 2016
1. xe core 1.8.21로 업그레이드하면 스킨의 SEO 명령어 제거
./skins/스킨타이틀/itemdetail_spec.html에서 아래의 코드 제거
<meta property="og:url" content="<?=$_SERVER['SCRIPT_URI']?>" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="ko" />
<meta property="og:locale:alternate" content="en_US" />
<meta property="og:title" content="{$item_info->item_name}" />
<meta property="og:description" content="{$item_info->item_name} {$item_info->getExtraVarValue('desc')}" />
<meta property="og:image" content="{$visual_url[0]}" />

./m.skins/스킨타이틀/itemdetail_spec.html에서 아래의 코드 제거
<meta property="og:url" content="<?=$_SERVER['SCRIPT_URI']?>" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="ko" />
<meta property="og:locale:alternate" content="en_US" />
<meta property="og:title" content="{$item_info->item_name}" />
<meta property="og:description" content="{$item_info->item_name} {$item_info->getExtraVarValue('desc')}" />
<meta property="og:image" content="{$visual_url[0]}" />

v 0.5.4
8th, Aug 2016
1. svitem::item_code 필드의 유일성 제거
./schemas/svitem_items.xml에서 아래의 코드를
<column name="item_code" type="varchar" size="64" notnull="notnull" unique="unique_item_code" />
아래와 같이 변경
<column name="item_code" type="varchar" size="64" notnull="notnull" />

v 0.5.5
13th, Aug 2016
1. 재고 정보를 extra vars에서 독립 변수로 이동
./schemas/svitem_items.xml에서 아래의 코드 추가
<column name="current_stock" type="number" size="11" default="0" notnull="notnull" />

./svitem.model.php::getItemStock()에서 아래의 코드를
$nCurrentStock = (int)$this->getItemExtraVarValue($nItemSrl, 'stock');
아래와 같이 변경
$nCurrentStock = (int)$output->data->current_stock;

./tpl/updateitem.html에 아래의 코드 추가
<div class="x_control-group">
	<label class="x_control-label" for="current_stock">{$lang->item_current_stock} </label>
	<div class="x_controls">
		<input name="current_stock" type="text" class="inputTypeText w100" value="{$item_info->current_stock}" />
	</div>
</div>

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드 추가
$current_stock = Context::get('current_stock');
$args->current_stock = $current_stock;

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드를 제거
$args->item_stock = Context::get('item_stock');
if($args->item_stock < 0)
	$args->item_stock = -1;

./svitem.admin.controller.php::procSvitemAdminInsertItem()에서 아래의 코드를 제거
	if($item_stock > 0) $args->item_stock = $iem_stock;

./svitem.controller.php::setItemStock()에서 아래의 코드를
$output = $this->updateExtraVars($nItemSrl, 'stock', $nStock);
아래와 같이 변경
$args->item_srl = $nItemSrl;
$args->current_stock = $nStock;
$output = executeQuery('svitem.updateCurrentStockCount', $args);

./svitem.class.php::checkUpdate()에서 아래의 코드를 제거
$oDB = &DB::getInstance();
$output = $this->checkModuleExtraVars();
	if($output == 'true') return true;
if(!$oDB->isColumnExists('svitem_items', 'updatetime')) return true;
if(!$oDB->isColumnExists('svitem_items', 'related_items')) return true;

./svitem.class.php::checkModuleExtraVars() 제거
./svitem.class.php::updateExtraVars() 제거

./svitem.class.php::moduleUpdate()에서 아래의 코드를 제거
$oDB = &DB::getInstance();
$this->checkModuleExtraVars('install');

if(!$oDB->isColumnExists('svitem_items', 'updatetime')) $oDB->addColumn('svitem_items', 'updatetime', 'date');
if(!$oDB->isColumnExists('svitem_items', 'related_items')) $oDB->addColumn('svitem_items', 'related_items', 'varchar', '250');

./svitem.model.php::getSvitemExtraVars()에서 아래의 코드를 제거
if($module_name)
{
	$oModel = &getModel($module_name);
	//$oModel->get.ucfirst($module_name).ExtraVars();

	$output = $oModel->getSvitemExtraVars();
	//$output = $this->getSvitemInputExtraVars($output);
	return $output;
}

v 0.5.6
1st, Nov 2016
1. 이카소에서 불러오는 재고 정보에서 무의미한 공백 문자를 제거한 후 무결성 검사
./ecasoo.class.php::ecaso()에서 아래의 코드를
case 1: // item without option
	if( $oResult[1] == $oItemCode[0] )
case 2: // item with option
	if( $oResult[1] == $oItemCode[0] && $oResult[2] == $oItemCode[1] )
아래와 같이 변경
case 1: // item without option
	if( trim( $oResult[1] ) == trim( $oItemCode[0] ) )
case 2: // item with option
	if( trim( $oResult[1] ) == trim( $oItemCode[0] ) && trim( $oResult[2] ) == trim( $oItemCode[1] ) )

v 0.5.7
13th, Jan 2017
1. 위시리스트 기능 오류 제거
./svitem.controller.php::procSvitemAddItemsToFavorites()에서 아래의 코드를 
$output = $oSvitemModel->discountItem($item_info);
아래와 같이 수정
$oSvpromotionModel = &getModel('svpromotion');
$output = $oSvpromotionModel->getItemPriceDetail($item_info);

2. "외부 서버에서 아이템별 재고 잔량 가져오기"를 선택하면 개별 아이템 정보 수정 화면에서 재고 정보 입력란을 감추기
./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 아래의 코드 추가
$config = $oSvitemModel->getModuleConfig();
Context::set('config',$config);

./tpl/updateitem.html에서 아래의 코드를
<div class="x_control-group">
	<label class="x_control-label" for="safe_stock">{$lang->item_current_stock} </label>
	<div class="x_controls">
		<input name="current_stock" type="text" class="inputTypeText w100" value="{$item_info->current_stock}" />
	</div>
</div>
아래와 같이 변경
<div class="x_control-group"|cond="$config->external_server_type==''">
	<label class="x_control-label" for="safe_stock">{$lang->item_current_stock} </label>
	<div class="x_controls">
		<input name="current_stock" type="text" class="inputTypeText w100" value="{$item_info->current_stock}" />
	</div>
</div>

v 0.5.8
14th, Feb 2017
1. Naver EP 연동 기능 추가
./svitem.view.php::dispSvitemNaverEp() 추가
./tpl/naver_ep.html 추가

2. 코드 최적화
./svitem.view.php::dispSvitemItemList()에서 아래의 호출 비활성화
$oSvitemModel = &getModel('svitem');
$oFileModel = &getModel('file');

./svitem.view.php::init()에서 아래의 코드를
$this->setTemplatePath( $this->module_path."skins/{$this->module_info->skin}" );
아래와 같이 변경
$this->setTemplatePath( $this->module_path.'skins/'.$this->module_info->skin );

v 0.5.9
5th, Mar 2017
1. 카테고리 기능 정리
./svitem.model.php::getAllCategories() 비활성화
./queries/getAllCategories.xml 비활성화

./svitem.model.php::getSvitemCategoryInfo()를 아래와 같이 이름 변경
getSvitemCategoryInfoAjax()

./tpl/js/category.js::get_category_location()에서 아래의 코드를
act : "getSvitemCategoryInfo"
아래와 같이 변경
act : "getSvitemCategoryInfoAjax"

./tpl/js/category.js::pb_load_list()에서 아래의 코드를
act : "getSvitemCategoryInfo"
아래와 같이 변경
act : "getSvitemCategoryInfoAjax"

./svitem.model.php::getSvitemCategoryInfoArrayForDetailPage() 추가

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를 비활성화
$this->getCategoryTree($this->module_info->module_srl);

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
Context::set('category', $item_info->category_id);
아래와 같이 변경
//Context::set('category', $item_info->category_id);
if( $item_info->category_id > 0 )
{
	$aCategoryInfo = $oSvitemModel->getSvitemCategoryInfoArrayForDetailPage($this->module_info->mid, $item_info->category_id);
	Context::set('category', $aCategoryInfo);
	$oCurCategory = array_pop($aCategoryInfo);
	if( strlen( $item_info->enhanced_item_info->ga_category_name ) == 0 )
		$item_info->enhanced_item_info->ga_category_name = $oCurCategory->category_name;
}

v 0.6.0
25th, Mar 2017
1. 남아있던 프로모션 기능 제거
./svitem.admin.controller.php::procSvitemAdminMemberDiscount()를 svpromotion으로 이동
./svitem.admin.controller.php::procSvitemAdminQuantityDiscount()를 svpromotion으로 이동
./svitem.admin.controller.php::procSvitemAdminDeleteMemberDiscount()를 svpromotion으로 이동
./svitem.admin.controller.php::procSvitemAdminDeleteQuantityDiscount()를 svpromotion으로 이동
./tpl/quantitydiscount.html를 svpromotion으로 이동
./tpl/memberdiscount.html를 svpromotion으로 이동

v 0.6.1
28th, Mar 2017
1. 네이버 EP 관리 기능 추가
./svitem.admin.view.php::dispSvitemAdminConfig에() 아래의 코드를 추가
$aNvrEpSvitemModuels = array();
foreach( $config->naver_ep_extract_svitem as $k=>$v)
	$aNvrEpSvitemModuels[$v] = 'extract';
$config->naver_ep_extract_svitem = $aNvrEpSvitemModuels;
Context::set('config',$config);	

./tpl/config.html에 아래의 코드 추가
<section class="section">
<h1>{$lang->naver_ep_setting}</h1>
<div class="x_control-group">
	<label class="x_control-label" for="mlayout_srl">{$lang->naver_ep_use}</label>
	<div class="x_controls">중요! .htaccess에 아래의 코드를  추가해야 합니다.<BR>#naver EP<BR>RewriteRule  ^naver_ep\.tsv index.php?module=svitem&act=dispSvitemNaverEp [L,QSA]<BR>
		<label class="x_inline" for="integrate"><input type="radio" name="display_caution" id="integrate" value="Y" checked="checked" />{$lang->naver_ep_on}</label>
		<label class="x_inline" for="individual"><input type="radio" name="display_caution" id="individual" value="N" />{$lang->naver_ep_off}</label>
		<a href="#naver_ep_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="naver_ep_help" class="x_help-block" hidden>{$lang->about_naver_ep}</p>
	</div>
</div>
<div class="x_control-group">
	<label class="x_control-label">{$lang->naver_ep_extract_module}</label>
	<div class="x_controls">
<block loop="$svitem_mod_list=>$key,$val">
		<label class="x_inline" for="extract_svitem_{$val->module_srl}"><input type="checkbox" name="naver_ep_extract_svitem[]" id="naver_ep_extract_svitem[]" value="{$val->module_srl}" checked="checked"|cond="$config->naver_ep_extract_svitem[$val->module_srl] == 'extract'" /> {$val->mid}</label>
</block>
		<a href="#naver_ep_extract_mid_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="naver_ep_extract_mid_help" class="x_help-block" hidden>{$lang->about_naver_ep_extract_mid}</p>
	</div>
</div>
</section>

./svitem.view.php::dispSvitemNaverEp()를 관리자 기능과 연동되도록 수정함

./tpl/updateitem.html에 상품별 EP 연동 정보 기록 섹션 추가

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$sNEpItemName = strip_tags( Context::get('naver_ep_item_name') );
$sNEpMaker = strip_tags( Context::get('naver_ep_maker') );
$sNEpOrigin = strip_tags( Context::get('naver_ep_origin') );
$sNEpSearchTag = strip_tags( Context::get('naver_ep_search_tag') );
$sNEpBarcode = strip_tags( Context::get('naver_ep_barcode') );
$sNEpNvrCategory = strip_tags( Context::get('naver_ep_naver_category') );
$oEnhancedItemInfo->naver_ep_item_name = $sNEpItemName;
$oEnhancedItemInfo->naver_ep_maker = $sNEpMaker;
$oEnhancedItemInfo->naver_ep_origin = $sNEpOrigin;
$oEnhancedItemInfo->naver_ep_search_tag = $sNEpSearchTag;
$oEnhancedItemInfo->naver_ep_barcode = $sNEpBarcode;
$oEnhancedItemInfo->naver_ep_naver_category = $sNEpNvrCategory;

2. 불필요한 코드 비활성화
./svitem.admin.view.php::dispSvitemAdminConfig()에서 아래의 코드를 비활성화
$skin_list = $oModuleModel->getSkins($this->module_path);
Context::set('skin_list', $skin_list);
$mskin_list = $oModuleModel->getSkins($this->module_path, "m.skins");
Context::set('mskin_list', $mskin_list);
// 레이아웃 목록을 구해옴
$oLayoutModel = &getModel('layout');
$layout_list = $oLayoutModel->getLayoutList();
Context::set('layout_list', $layout_list);
$mobile_layout_list = $oLayoutModel->getLayoutList(0,"M");
Context::set('mlayout_list', $mobile_layout_list);
// svpg plugin list
$oSvpgModel = &getModel('svpg');
$modules = $oSvpgModel->getSvpgList();
Context::set('svpg_modules', $modules);
$oSvcartModel = &getModel('svcart');
if($oSvcartModel)
{
	$svcart_insts = $oSvcartModel->getModInstList();
	Context::set('svcart_insts', $svcart_insts);
}

v 0.6.2
1st, Apr 2017
1. 네이버 EP 데이터 추출 기능을 MVC 패턴으로 리팩토링
./svitem.model.php::getNaverEpList() 추가

./svitem.view.php::dispSvitemNaverEp()에서 아래의 코드를
$oSvitemConfig = $this->getModuleConfig();
$oSvcartModel = &getModel('svcart');
$oSvcartConfig = $oSvcartModel->getModuleConfig();
$nDeliveryFee = (int)$oSvcartConfig->delivery_fee;
$nFreeDeliveryAmnt = (int)$oSvcartConfig->freedeliv_amount;
$aExtracted = array();
$nIdx = 0;
foreach( $oSvitemConfig->naver_ep_extract_svitem as $key=>$val)
{
	$args->module_srl = $val;
	$args->display='Y';
	$args->node_route = 'f.';
	$output = executeQueryArray('svitem.getItemsByNodeRoute', $args);
	if( !$output->toBool() )
		return $output;
	$item_list = $output->data;

	$oModuleModel = &getModel('module');
	$oRst = $oModuleModel->getModuleInfoByModuleSrl($val);
	$sMid = $oRst->mid;
	$oSvpromotionModel = &getModel('svpromotion');
	$discounted = $oSvpromotionModel->getItemPriceList($item_list);
	foreach($discounted as $key=>$val)
	{
		if( $val->price > $nFreeDeliveryAmnt )
			$discounted[$key]->shipping_cost = 0;
		else
			$discounted[$key]->shipping_cost = $nDeliveryFee;

		if( strlen( $val->enhanced_item_info->naver_ep_naver_category ) == 0 )
			$discounted[$key]->enhanced_item_info->naver_ep_naver_category = ' ';
		if( strlen( $val->enhanced_item_info->naver_ep_barcode ) == 0 )
			$discounted[$key]->enhanced_item_info->naver_ep_barcode = ' ';
		if( strlen( $val->enhanced_item_info->naver_ep_search_tag ) == 0 )
			$discounted[$key]->enhanced_item_info->naver_ep_search_tag = ' ';

		$discounted[$key]->mid = $sMid;
	}
	// 배열 결합
	foreach($discounted as $key=>$val) 
		$aExtracted[$nIdx++] = $val;

	// svreview 모듈이 설치되어 있으면 상품 리뷰 정보 적재
	/*if( getClass('svreview') )
	{
		$oSvreviewModel = &getModel( 'svreview' );
		foreach( $item_list as $key => $item )
		{
			$review = $oSvreviewModel->getTotalReviewInfo($item->item_srl);
			$item_list[$key]->review = $review;
		}
	}*/
}
./svitem.model.php::getNaverEpList()로 이동

v 0.6.3
2nd, Apr 2017
1. 네이버 EP 데이터 추출 기능을 MVC 패턴으로 리팩토링
./svitem.model.php::getAllValidItemList()를 
./svitem.model.php::getAllDisplayingItemList()로 이름 변경

2. 미사용 메소드 비활성화
./svitem.model.php::getUpdatedItemList() 비활성화

v 0.6.4
8th, Apr 2017
1. 후기 추출 기능을 svreview에서 흡수
./svitem.model.view.php::getModuleConfig() 추가
./svitem.admin.view.php::dispSvitemAdminReviewBoardMgmt() 추가
./svitem.admin.controller.php::procSvitemAdminUpdateReviewBoardMgmt() 추가
./svitem.model.php::getReviewCount() 제거
./svitem.model.php::getReviewCnt() 추가
./tpl/reviewboard_mgmt.html 추가
./svitem.model.php::getNaverEpList()에서 아래의 코드를
if( getClass('svreview') )
	$oSvreviewModel = &getModel( 'svreview' );
if( $oSvreviewModel )
{
	$review = $oSvreviewModel->getTotalReviewInfo($val->item_srl);
	$discounted[$key]->review_cnt = $review->count;
}

아래와 같이 변경
$nReview = $this->getReviewCnt($val->item_srl);
$discounted[$key]->review_cnt = $nReview;

./svitem.model.php::getReviews()를 새로 작성
./skins/plain/itemdetail_review.html 코드 블록 변경

2. 설정 저장 메소드를 개선
./svitem.admin.controller.php::_saveModuleConfig() 추가
./svitem.admin.controller.php::procSvitemAdminConfig()에서 아래의 코드를
$args = Context::getRequestVars();
// save module configuration.
$oModuleControll = getController('module');
$output = $oModuleControll->insertModuleConfig('svitem', $args);
$this->setMessage('success_updated');
if(!in_array(Context::getRequestMethod(),array('XMLRPC','JSON'))) 
{
	$returnUrl = Context::get('success_return_url') ? Context::get('success_return_url') : getNotEncodedUrl('', 'module', Context::get('module'), 'act', 'dispSvitemAdminConfig','module_srl',Context::get('module_srl'));
	$this->setRedirectUrl($returnUrl);
}
아래와 같이 변경
$oArgs = Context::getRequestVars();
// save module configuration.
$output = $this->_saveModuleConfig($oArgs);
if(!$output->toBool())
	$this->setMessage( 'error_occured' );
else
	$this->setMessage( 'success_updated' );
$this->setRedirectUrl( getNotEncodedUrl('', 'module', Context::get('module'), 'act', 'dispSvitemAdminConfig','module_srl',Context::get('module_srl')));

3. naver_ep off면 ep list 출력 안하는 기능 추가
./svitem.model.php::getNaverEpList()에서 아래의 코드 추가
if($oSvitemConfig->naver_ep_use != 'Y')
	return;

v 0.6.5
9th, Apr 2017
1. 상품상세페이지에 표시할 후기 정렬 설정 기능
./svitem.admin.controller.php::procSvitemAdminUpdateReviewBoardMgmt()에 아래의 코드 추가
$oArgs->order_target = $oTempArgs->order_target;
$oArgs->order_type = $oTempArgs->order_type;

./svitem.model.php::getReviews()에 아래의 코드 추가
if($logged_info->member_srl == $aReviews->data[$revval->document_srl]->member_srl)
	$aReviews->data[$revval->document_srl]->isGranted = true;
else
	$aReviews->data[$revval->document_srl]->isGranted = false;

./svitem.admin.view.php::dispSvitemAdminReviewBoardMgmt()에 아래의 코드 추가
$aOrderTarget = array('list_order', 'update_order', 'regdate', 'voted_count', 'blamed_count', 'readed_count', 'comment_count', 'title', 'nick_name');
foreach($aOrderTarget as $key) $order_target[$key] = Context::getLang($key);
$order_target['list_order'] = Context::getLang('document_srl');
$order_target['update_order'] = Context::getLang('last_update');
Context::set('order_target', $order_target);

./tpl/reviewboard_mgmt.html에 아래의 코드 추가
<div cond="$config->connected_review_board_srl!=0" class="x_control-group">
	<label class="x_control-label">{$lang->order_type}</label>
	<div class="x_controls">
		<select name="order_target" id="order_target" title="{$lang->order_target}">
			<option loop="$order_target=>$order_key,$order_val" value="{$order_key}" selected="selected"|cond="$config->order_target== $order_key">{$order_val}</option>
		</select>
		<select name="order_type" id="order_type" title="{$lang->order_type}">
			<option value="asc" selected="selected"|cond="$module_info->order_type != 'desc'">{$lang->order_asc}</option>
			<option value="desc" selected="selected"|cond="$module_info->order_type == 'desc'">{$lang->order_desc}</option>
		</select>
	</div>
</div>

2. 상품상세페이지에 후기 표시 방식 개선
document model이 최대 20개의 게시물만 불러오기 때문에 불러오지 않은 후기 숫자와 후기 게시판 바로가기 표시
$aReviews->mid = $oReviewBoardConfig->mid;
$aReviews->remaining_reviews = $nCurrentReview - $nLoadReviewCount;
$aReviews->category_srl = $args->category_srl;

3. 모바일 상품 상세 페이지를 변경된 후기 리뷰에 맞춤
./m.skins/trendshop/itemdetail_review.html 코드 수정
./m.skins/trendshop/css/itemdetail.css에 아래의 코드 추가
.reviews li.list-hidden{display:none}

v 0.6.6
10th, Apr 2017
1. 상품상세페이지에 표시할 후기가 비회원 작성이면 삭제 버튼 항상 비표시
./svitem.model.php::getReviews()에 아래의 코드를 
if($logged_info->member_srl == $aReviews->data[$revval->document_srl]->member_srl)
아래와 같이 변경
if($aReviews->data[$revval->document_srl]->member_srl!=0 && $logged_info->member_srl == $aReviews->data[$revval->document_srl]->member_srl)

v 0.6.7
22nd, Apr 2017
1. 미사용 코드 블록 제거
./svitem.admin.view.php::dispSvitemAdminMemberDiscount()를 제거
function dispSvitemAdminMemberDiscount()
{
	$oMemberModel = &getModel('member');
	$args->page = Context::get('page');
	$output = executeQueryArray('svitem.getMemberDiscount', $args);
	if(!$output->toBool()) 
		return $output;
	Context::set('total_count', $output->total_count);
	Context::set('total_page', $output->total_page);
	Context::set('page', $output->page);
	Context::set('page_navigation', $output->page_navigation);
	if($output->data)
	{
		$member_discount_list = $output->data;
		foreach($member_discount_list as $k => $v)
		{
			$member_info = $oMemberModel->getMemberInfoByMemberSrl($v->member_srl);
			$v->user_id = $member_info->user_id;
			$v->regdate = substr($v->regdate, 0, 8);
		}
		Context::set('member_discount_list', $member_discount_list);
	}
	$this->setTemplateFile('memberdiscount');
}

./svitem.admin.view.php::dispSvitemAdminQuantityDiscount()를 제거
function dispSvitemAdminQuantityDiscount()
{
	$oSvitemModel = &getModel('svitem');
	$args->page = Context::get('page');
	$output = executeQueryArray('svitem.getQuantityDiscount', $args);
	if(!$output->toBool())
		return $output;
	Context::set('total_count', $output->total_count);
	Context::set('total_page', $output->total_page);
	Context::set('page', $output->page);
	Context::set('page_navigation', $output->page_navigation);
	if($output->data) 
	{
		$quantity_discount_list = $output->data;
		foreach($quantity_discount_list as $k => $v)
		{
			$item_info = $oSvitemModel->getItemInfo($v->item_srl);
			$v->item_name = $item_info->item_name;
			$v->regdate = substr($v->regdate, 0, 8);
		}
		Context::set('quantity_discount_list', $quantity_discount_list);
	}
	$this->setTemplateFile('quantitydiscount');
}

./conf/module.xml에서 아래의 코드 제거
<action name="dispSvitemAdminMemberDiscount" type="view" />
<action name="dispSvitemAdminQuantityDiscount" type="view" />

./svitem.controller.php::procSvitemInsertReview()를 제거
function procSvitemInsertReview() 
{
	$oStoreReviewController = &getController('svreview');
	$oSvitemModel = &getModel('svitem');
	$logged_info = Context::get('logged_info');

	if( !$logged_info )
		return new Object(-1, 'msg_not_permitted');
	if(!$this->grant->write_comment )
		return new Object(-1, 'msg_not_permitted');
	if( !$this->module_srl )
		return new Object(-1,'msg_invalid_request');

	$reqvars = Context::gets('item_srl','document_srl','star_point','content');
	// item info
	if ($reqvars->item_srl)
		$item_info = $oSvitemModel->getItemInfo($reqvars->item_srl);
	else
		$item_info = $oSvitemModel->getItemByDocumentSrl($reqvars->document_srl);
	$args->module_srl = $item_info->module_srl;
	$args->item_srl = $item_info->item_srl;
	$args->comment_srl = getNextSequence();
	$args->content = nl2br($reqvars->content);
	$args->voted_count = $reqvars->star_point;
	$review_output = $oStoreReviewController->insertReview($args);
	if(!$review_output->toBool())
		return $review_output;

	// update review count
	$this->updateReviewCount($item_info->item_srl);

	// give mileage
	$config = $oSvitemModel->getModuleConfig();
	if ($config->review_bonus)
		$this->giveMileage($logged_info->member_srl, $item_info->item_srl, $review_output->get('review_srl'), $config->review_bonus);
	$this->setMessage('success_registed');
	$this->setRedirectUrl(getNotEncodedUrl('', 'mid', Context::get('mid'),'act','','document_srl',$item_info->document_srl));
}
./svitem.controller.php::procSvitemDeleteReview()를 제거
function procSvitemDeleteReview() 
{
	$oReviewModel = &getModel('svreview');
	$oReviewController = &getController('svreview');
	if(!$this->grant->write_comment)
		return new Object(-1, 'msg_not_permitted');
	if(!$this->module_srl)
		return new Object(-1,'msg_invalid_request');

	$args = Context::gets('item_srl','review_srl');
	$args->module_srl = $this->module_srl;

	$review_srl = Context::get('review_srl');
	$oReview = $oReviewModel->getReview($review_srl);
	if(!$oReview->isExists() || !$oReview->isGranted())
		return new Object(-1,'msg_invalid_request');

	$output = $oReviewController->deleteReview($oReview->review_srl);
	if(!$output->toBool())
		return $output;

	$this->setRedirectUrl(getNotEncodedUrl('', 'mid', Context::get('mid'),'act','','item_srl',Context::get('item_srl')));
}

./conf/module.xml에서 아래의 코드 제거
<action name="procSvitemInsertReview" type="controller" />
<action name="procSvitemDeleteReview" type="controller" method="GET|POST" />

./tpl/_header.html에서 아래의 코드 제거
<block cond="$experimental_mode=='Y'">
	<li class="x_active"|cond="$act=='dispSvitemAdminMemberDiscount'"><a href="{getUrl('act','dispSvitemAdminMemberDiscount')}">회원별할인</a></li>
	<li class="x_active"|cond="$act=='dispSvitemAdminQuantityDiscount'"><a href="{getUrl('act','dispSvitemAdminQuantityDiscount')}">구매수량별할인</a></li> 
</block>

2. 카테고리 탐색기 추가
./tpl/_header.html에서 아래의 코드 추가
<li class="x_active"|cond="$act=='dispSvitemAdminCategoryExplorer'"><a href="{getUrl('act','dispSvitemAdminCategoryExplorer')}">{$lang->product_category_explorer}</a></li>

./conf/module.xml에 아래의 코드 추가
<action name="dispSvitemAdminCategoryExplorer" type="view" />

./svitem.admin.view.php::dispSvitemAdminCategoryExplorer() 추가
./tpl/js/category.js::init_tree()에서 아래의 코드 비활성화
"search" : {
    "ajax" : {
	contentType: "application/json; charset=utf-8",
	"url" : "./",
	"data" : function (str) {
	    return { 
		module : "svitem"
		, act : "getSvitemPurplebookSearchFolder"
		, search : str
	    }; 
	},
	"success" : function(d) { 
	    for(i = 0; i < d.data.length; i++) {
		d.data[i] = '#node_'+d.data[i];
	    }
	    return d.data;
	}
    }
},

./svitem.model.php::getSvitemCategoryList() 비활성화하고 코드를 아래의 메소드로 이전
./conf/module.xml에 아래의 코드 제거
<action name="getSvitemCategoryList" type="model" />

./svitem.admin.model.php::getSvitemAdminGetCategoryListAjax() 추가
./conf/module.xml에 아래의 코드 추가
<action name="getSvitemAdminGetCategoryListAjax" type="model" />

./tpl/js/category.js::init_tree()에서 아래의 코드를 
return { 
	module : "svitem"
	, act : "getSvitemCategoryList"
	, node_id : node_id
	, node_type : "1"
	, module_srl : init_tree.module_srl
    }; 

아래와 같이 변경
return { 
	module : "svitem"
	, act : "getSvitemAdminCategoryListAjax"
	, node_id : node_id
	, node_type : "1"
	, module_srl : init_tree.module_srl
    }; 

./tpl/insertitem.html에서 아래의 코드를 
, act : "getSvitemCategoryList"
아래와 같이 변경
, act : "getSvitemAdminCategoryListAjax"

./tpl/js/display_category.js에서 아래의 코드를 
, act : "getSvitemCategoryList"
아래와 같이 변경
, act : "getSvitemAdminCategoryListAjax"

./tpl/js/script.js에서 아래의 코드를 
, act : "getSvitemCategoryList"
아래와 같이 변경
, act : "getSvitemAdminCategoryListAjax"

./tpl/js/category.js::init_tree()를 displayTree()로 변경
./tpl/categorymanagement.html에서 아래의 코드를
init_tree({$module_srl}, '#category_tree', '{$tpl_path}img/');
아래와 같이 변경
displayTree({$module_srl}, '#category_tree', '{$tpl_path}img/');

./svitem.admin.model.php::getSvitemAdminCategoryListAjax()의 로직 변경
./queries/getCategoryNodeList.xml 추가

jstree 3.3.4로 교체
./tpl/js/jstree.min.js추가
./tpl/js/theme 추가
./tpl/js/jquery.jstree 비활성화
./tpl/js/_lib 폴더 비활성화

./svitem.admin.controller.php::procSvitemAdminRenameCategoryNodeAjax() 추가
./conf/module.xml에 아래의 코드 추가
<action name="procSvitemAdminRenameCategoryNodeAjax" type="controller" />

./tpl/filter/update_category.xml 비활성화
./tpl/filter/delete_category.xml 비활성화
./tpl/filter/insert_category.xml 비활성화

./schemas/svitem_categories.xml 비활성화
./schemas/svitem_category_node 추가

./svitem.controller.php::procSvitemUpdateCategory()를 제거
./conf/module.xml에서 아래의 코드를 제거
<action name="procSvitemUpdateCategory" type="controller" />

./svitem.controller.php::procSvitemDeleteCategory()를 제거
./conf/module.xml에서 아래의 코드를 제거
<action name="procSvitemDeleteCategory" type="controller" />

./svitem.admin.controller.php::procSvitemAdminRenameCategoryNodeAjax()를 생성
./svitem.admin.controller.php::procSvitemAdminDeleteCategoryNodeAjax()를 생성

./svitem.model.php::getCategoryInfo() 제거
./svitem.model.php::getSvitemCategoryInfoAjax() 제거
./svitem.model.php::getCategoryNodeInfo() 추가

./queries/getSubCategoryCount.xml 제거
./queries/getCategoryChildrenList.xml 추가

./svitem.model.php::getCategoryChildren() 추가

./schemas/svitem_items.xml에서 아래의 코드를 추가
<column name="category_node_srl" type="number" size="11" default="0" notnull="notnull" index="idx_category_node_srl" />

./svitem.view.php::getCategoryTree()에서 아래의 코드를
$parent_category_info = $oSvitemModel->getCategoryInfo($parent_node);
아래와 같이 변경
$parent_category_info = $oSvitemModel->getCategoryNodeInfo($parent_node);

./svitem.view.php::getCategoryTree()에서 아래의 코드를 비활성화
$oSvitemModel->getSubcategoryCount($current_node_route);

./queries/getItemsByNodeRoute.xml 제거

./svitem.controller.php::procSvitemInsertCategory() 제거
./svitem.admin.controller.php::procSvitemAdminInsertCategoryNodeAjax()를 생성

./svitem.admin.controller.php::procSvitemAdminDeleteItem()에서 아래의 코드를
$returnUrl = Context::get('success_return_url') ? Context::get('success_return_url') : getNotEncodedUrl('', 'module', Context::get('module'), 'act', 'dispSvitemAdminItemList','module_srl',Context::get('module_srl'));
아래와 같이 변경
$returnUrl = Context::get('success_return_url') ? Context::get('success_return_url') : getNotEncodedUrl('', 'module', Context::get('module'), 'act', 'dispSvitemAdminItemListByModule','module_srl',Context::get('module_srl'));

./svitem.admin.controller.php::procSvitemAdminUpdateItemList()에서 아래의 코드를
,'act', 'dispSvitemAdminItemList','module_srl',Context::get('module_srl')
아래와 같이 변경
,'act', 'dispSvitemAdminItemListByModule','module_srl',Context::get('module_srl')

./svitem.admin.view.php::dispSvitemAdminItemList()에서 아래의 코드를 비활성화
$oSvitemView = &getView('svitem');
$oSvitemView->getCategoryTree($this->module_info->module_srl);

./svitem.admin.view.php::dispSvitemAdminItemList()를 제거
./svitem.admin.view.php::dispSvitemAdminItemListByModule()로 생성

./svitem.admin.view.php::dispSvitemAdminItemListByModule()에서 아래의 코드를
$s_item_name = Context::get('s_item_name');
$args->item_name = $s_item_name;
$output = executeQueryArray('svitem.getItemsByNodeRoute', $args);
아래와 같이 변경
$sSearchItemName = Context::get('search_item_name');
$args->item_name = $sSearchItemName;
$output = executeQueryArray('svitem.getAdminItemList', $args);

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서
s_item_name 관련을 search_item_name으로 변경

./svitem.admin.controller.php::procSvitemAdminUpdateItemList()에서
s_item_name 관련을 search_item_name으로 변경

./svitem.admin.view.php::init()에 아래의 코드를 추가
$logged_info = Context::get('logged_info');
if ($logged_info->is_admin!='Y')
	return new Object(-1, 'msg_login_required');

./queries/getAdminItemList.xml 추가

./svitem.model.php::getFrontDisplayItems() 로직 변경
./queries/getDisplayCategoryList.xml 변경
./queries/getDisplayItems.xml 변경

./queries/getItemList.xml을 getItemList 추가
./svitem.view.php::dispSvitemItemList()에서 아래의 코드를
$output = executeQueryArray('svitem.getItemsByNodeRoute', $args);
아래와 같이 변경
$output = executeQueryArray('svitem.getItemList', $args);

./svitem.model.php::getItemList()를 getItemListByItemSrls()로 변경
./queries/getItemList.xml을 getItemListByItemSrls로 변경

./svitem.model.php::getNodeRouteLength()를 _getNodeRouteLength()로 변경
./svitem.model.php::getNodeRoute()를 _getNodeRoute()로 변경

./svitem.admin.model.php::getSvitemAdminDisplayItemListAjax() 추가

그 외 오만가지 카테고리 관련 수정

3. private method 명시
./svitem.controller.php::getArrCommaSrls()를 _getArrCommaSrls()로 변경

v 1.0.0
2nd, May 2017
1. 카탈로그 기능 완전 개편

v 1.0.1
15th, May 2017
1. svcart와 svorder 분리를 위한 사전 대응
./tpl/skin.js/script.js::orderItemsDirectly()을 ./tpl/skin.js/itemdetail.js로 이동
./tpl/skin.js/itemdetail.js::orderItemsDirectly()을 _orderItemsDirectly()로 변경
./tpl/skin.js/itemdetail.js::_orderItemsDirectly()에서 아래의 코드를 추가
params['mode'] = 'bi';
params['svcart_mid'] = svcart_mid;
var response_tags = new Array('error','message','cart_srl','svorder_mid');
var sSvorderMid = ret_obj['svorder_mid'];
if( sSvorderMid )
	location.href = current_url.setQuery('mid', svcart_mid).setQuery('act','dispSvorderOrderItems').setQuery('cartnos',cart_srl);
else
	location.href = current_url.setQuery('mid', svcart_mid).setQuery('act','dispSvcartOrderItems').setQuery('cartnos',cart_srl);


./svitem.controller.php::procSvitemAddItemsToCartObj()에 아래의 코드 추가
$sMode = Context::get('mode');
switch( $sMode )
{
	case 'bi': // in case of buy immediately
		$sSvcartMid = Context::get('svcart_mid');
		if( strlen( $sSvcartMid ) == 0 )
			return new Object(-1, 'svcart mid is not specified');
		
		// find connected svorder module info
		$oModuleModel = getModel('module');
		$oSvcartConfig = $oModuleModel->getModuleInfoByMid($sSvcartMid);

		$nSvorderModuleSrl = (int)$oSvcartConfig->svorder_module_srl;
		if( !$nSvorderModuleSrl )
			return new Object(-1, 'please configure svorder in advance!');

		$oSvorderConfig = $oModuleModel->getModuleInfoByModuleSrl($nSvorderModuleSrl);
		$sSvorderMid = $oSvorderConfig->mid;
		if( strlen( $sSvorderMid ) == 0 )
			return new Object(-1, 'please configure svorder in advance!');

		//$this->add( 'svorder_mid', $sSvorderMid );
		break;
	case 'atc':
		break;
}

./tpl/skin.js/script.js::addItemsToCartObj()을 ./tpl/skin.js/addItemsToCartObj.js로 이동
./tpl/skin.js/itemdetail.js::_addItemsToCartObj()을 _addItemsToCartObj()로 변경
./tpl/skin.js/itemdetail.js::_addItemsToCartObj()에서 아래의 코드를 추가
params['mode'] = 'atc';

2. 미사용 코드 비활성화
./tpl/skin.js/script.js::direct_order() 
./tpl/skin.js/script.js::progressOrderIndividual()
./tpl/skin.js/script.js::progressOrderItems()

v 1.0.2
22nd, May 2017
1. 무의미한 trigger 제거
./svitem.admin.model.php::getProcModules() 추가

./svitem.admin.view.php::dispSvitemAdminInsertModInst()에서 아래의 코드를
// 상품타입 정보 가져오기
$module_list = array();
$output = ModuleHandler::triggerCall('svitem.getProcModules', 'before', $module_list);
if(!$output->toBool())
	return $output;
아래와 같이 변경
$oSvitemAdminModel = &getAdminModel('svitem');
$aModules = $oSvitemAdminModel->getProcModules();
Context::set('module_list', $aModules);

./svitem.admin.view.php::dispSvitemAdminInsertModInst()에서 아래의 코드를
// 상품타입 정보 가져오기
$module_list = array();
$output = ModuleHandler::triggerCall('svitem.getProcModules', 'before', $module_list);
if(!$output->toBool())
	return $output;
아래와 같이 변경
$oSvitemAdminModel = &getAdminModel('svitem');
$aModules = $oSvitemAdminModel->getProcModules();
Context::set('module_list', $aModules);

./svitem.admin.view.php::dispSvitemAdminInsertItem()에서 아래의 코드 제거
$module_list = array();
$output = ModuleHandler::triggerCall('svitem.getProcModules', 'before', $module_list);
if(!$output->toBool()) return $output;
Context::set('module_list', $module_list);

./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 아래의 코드 제거
$module_list = array();
$output = ModuleHandler::triggerCall('svitem.getProcModules', 'before', $module_list);
if(!$output->toBool()) return $output;
Context::set('module_list', $module_list);

v 1.0.3
6th, Jun 2017
1. 내부 재고 데이터 서버 선택 기능 오류 수정
./svitem.admin.controller.php::procSvitemAdminConfig()에 아래의 코드 추가
if( is_null( $oArgs->external_server_type ) )
	$oArgs->external_server_type = '';

v 1.0.4
11th, Jun 2017
1. svpromotion 코드 최적화 대응
./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$oSvpromotionModel = &getModel('svpromotion');
$output = $oSvpromotionModel->getItemPriceDetail($item_info);
$item_info->discounted_price = $output->discounted_price;
$item_info->discount_amount = $output->discount_amount;
$item_info->discount_info = $output->discount_info;
Context::set('discounted_price', $output->discounted_price);
Context::set('discount_amount', $output->discount_amount);
Context::set('discount_info', $output->discount_info);

// 아이템별 부가 할인 정책 가져오기
$oConditionalPromotion = $oSvpromotionModel->getItemConditionalPromotionList($item_info);
$nConditionalAdditionalDisc = 0;
foreach( $oConditionalPromotion->promotion as $key => $val )
{
	if( $val->conditional_additional_discount_amount > 0 )
	{
		$nConditionalAdditionalDisc += $val->conditional_additional_discount_amount;
		if( $val->conditional_additional_discount_type == 'fblike' )
			$oFbLikePromotion = $oConditionalPromotion->promotion[$key];
		if( $val->conditional_additional_discount_type == 'fbshare' )
			$oFbSharePromotion = $oConditionalPromotion->promotion[$key];
	}
}

if( $nConditionalAdditionalDisc > 0 )
{
	Context::set('fb_app_id', $oConditionalPromotion->fb_app_id);
	Context::set('additional_conditional_discount_amount', $nConditionalAdditionalDisc );
	Context::set('additional_conditional_discount_info_fblike', $oFbLikePromotion);
	Context::set('additional_conditional_discount_info_fbshare', $oFbSharePromotion);
}

아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$output = $oSvpromotionModel->getPromotionInfoForItemDetailPage($item_info);
$item_info->discounted_price = $output['unconditional']->discounted_price;
$item_info->discount_amount = $output['unconditional']->discount_amount;
$item_info->discount_info = $output['unconditional']->discount_info;
Context::set('discounted_price', $output['unconditional']->discounted_price);
Context::set('discount_amount', $output['unconditional']->discount_amount);
Context::set('discount_info', $output['unconditional']->discount_info);

$nConditionalAdditionalDisc = 0;
foreach( $output['conditional']->promotion as $key => $val )
{
	if( $val->conditional_additional_discount_amount > 0 )
	{
		$nConditionalAdditionalDisc += $val->conditional_additional_discount_amount;
		if( $val->conditional_additional_discount_type == 'fblike' )
			$oFbLikePromotion = $output['conditional']->promotion[$key];
		if( $val->conditional_additional_discount_type == 'fbshare' )
			$oFbSharePromotion = $output['conditional']->promotion[$key];
	}
}

if( $nConditionalAdditionalDisc > 0 )
{
	Context::set('fb_app_id', $output['conditional']->fb_app_id);
	Context::set('additional_conditional_discount_amount', $nConditionalAdditionalDisc );
	Context::set('additional_conditional_discount_info_fblike', $oFbLikePromotion);
	Context::set('additional_conditional_discount_info_fbshare', $oFbSharePromotion);
}

2. 미사용 코드 제거
./svitem.class.php에서 아래의 코드 제거
define('WAIT_FOR_DEPOSIT', '1');
define('PREPARE_DELIVERY', '2');
const ORDER_STATE_PAID = '2';
const ORDER_STATE_COMPLETE = '3';

./svitem.class.php::svitem()에서 아래의 코드 제거
$this->ORDER_STATE_COMPLETE = svitem::ORDER_STATE_COMPLETE;
$this->ORDER_STATE_PAID = svitem::ORDER_STATE_PAID;
$this->order_status = array('0'=>'카트보관', '1'=>'입금대기', '2'=>'입금완료', '3'=>'구매완료','A'=>'취소','B'=>'반품,교환','C'=>'환불');

./svitem.class.php::getOrderStatus() 제거

3. svitem_item tbl::category_id 제거
./schemas/svitem_items.xml에서 아래의 코드 제거
<column name="category_id" type="number" size="11" default="0" notnull="notnull" index="idx_category_id" />
./queries/getShowWindowItems.xml에서 아래의 코드 제거
<column name="item.category_id" alias="category_id" />
./queries/updateAdminItem.xml에서 아래의 코드 제거
<column name="item.category_id" alias="category_id" />
./queries/updateItem.xml에서 아래의 코드 제거
<column name="item.category_id" alias="category_id" />
./svitem.item.php::svitemItem()에서 아래의 코드 제거
var $category_id = 0;
./svitem.admin.controller.php::checkColumnName()에서 아래의 코드를
if(in_array($column_name, array('module','act','module_srl','category_id', 'document_srl','description', 'delivery_info', 'item_srl','proc_module','category_depth1','category_depth2','category_depth3','category_depth4','thumbnail_image','contents_file'))) 
아래와 같이 변경
if(in_array($column_name, array('module','act','module_srl', 'document_srl','description', 'delivery_info', 'item_srl','proc_module','category_depth1','category_depth2','category_depth3','category_depth4','thumbnail_image','contents_file'))) 
./tpl/filter/update_item.xml에서 아래의 코드 제거
<param name="category_id" target="category_id" />

4. svitem_item tbl::node_route 제거
./schemas/svitem_items.xml에서 아래의 코드 제거
<column name="node_route" type="varchar" size="250" notnull="notnull" index="idx_node_route" />
./queries/updateAdminItem.xml에서 아래의 코드 제거
<column name="node_route" var="node_route" />
./queries/updateItem.xml에서 아래의 코드 제거
<column name="node_route" var="node_route" />
./svitem.item.php::svitemItem()에서 아래의 코드 제거
var $node_route = NULL;

5. svitem_item tbl::group_srl_list 제거
./schemas/svitem_items.xml에서 아래의 코드 제거
<column name="group_srl_list" type="varchar" size="250" />
./queries/insertItem.xml에서 아래의 코드 제거
<column name="group_srl_list" var="group_srl_list" />
./queries/updateAdminItem.xml에서 아래의 코드 제거
<column name="group_srl_list" var="group_srl_list" />
./queries/updateItem.xml에서 아래의 코드 제거
<column name="group_srl_list" var="group_srl_list" />
./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드를 제거
$group_srl_list = Context::get('group_srl_list');
$args->group_srl_list = serialize($group_srl_list);

6. svitem_item tbl::proc_module 제거
./schemas/svitem_items.xml에서 아래의 코드 제거
<column name="proc_module" type="varchar" size="250" notnull="notnull" index="idx_proc_module" />
./queries/insertItem.xml에서 아래의 코드 제거
<column name="proc_module" var="proc_module" notnull="notnull" />
./queries/updateAdminItem.xml에서 아래의 코드 제거
<column name="proc_module" var="proc_module" />
./queries/updateItem.xml에서 아래의 코드 제거
<column name="proc_module" var="proc_module" />
./svitem.admin.controller.php::checkColumnName()에서 아래의 코드를
if(in_array($column_name, array('module','act','module_srl', 'document_srl','description', 'delivery_info', 'item_srl','proc_module','category_depth1','category_depth2','category_depth3','category_depth4','thumbnail_image','contents_file'))) 
아래와 같이 변경
if(in_array($column_name, array('module','act','module_srl', 'document_srl','description', 'delivery_info', 'item_srl','category_depth1','category_depth2','category_depth3','category_depth4','thumbnail_image','contents_file'))) 

./svitem.admin.controller.php::procSvitemAdminUpdateItemList()에서 아래의 코드 제거
$args->proc_module = $module_info->proc_module;
$args->proc_module = $oInArgs->proc_module;

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드 제거
$args->proc_module = Context::get('proc_module');

./svitem.view.php::init()에서 아래의 코드 제거
if( !$this->module_info->proc_module )
	return;
./tpl/insertmodinst.html에서 아래의 코드 제거
<div class="x_control-group">
	<label class="x_control-label" for="proc_module">{$lang->proc_module}</label>
	<div class="x_controls">
		<div cond="!$module_info->proc_module">
			<select name="proc_module" id="proc_module">
				<option loop="$module_list=>$key,$val" value="{$val->module}" selected="selected"|cond="$module_info->proc_module == $val->module">{$val->title} ({$val->module})</option>
			</select>
			<a href="#proc_module_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
			<p id="proc_module_help" class="x_help-block" hidden>{$lang->about_proc_module}</p>
		</div>
		<div cond="$module_info->proc_module"> <input type="hidden" name="proc_module" value="{$module_info->proc_module}" />
			<span class="x_input-large x_uneditable-input">{$module_list[$module_info->proc_module]->title}({$module_info->proc_module})</span>
		</div>
	</div>
</div>

v 1.0.5
17th, Jun 2017
1. svpromotion 코드 최적화 대응
./svitem.view.php::dispSvitemItemList()에서 아래의 코드 제거
$logged_info = Context::get('logged_info');
if($logged_info)
{
	$oSvreservesModel = &getModel('svreserves');
	$svreserves = $oSvreservesModel->getReserves($logged_info->member_srl);
	Context::set('svreserves', $svreserves);
}

v 1.0.6
19th, Jun 2017
1. 장바구니 담은 후 장바구니 화면 이동 기능을 svcart로 이전
./tpl/itemdetail.js::_orderItemsDirectly()에서 아래의 코드를
location.href = current_url.setQuery('mid', svcart_mid).setQuery('act','dispSvcartOrderItems').setQuery('cartnos',cart_srl);
아래와 같이 변경
alert('SVORDER MID is not defined.');
return;

./tpl/itemdetail.js::_addItemsToCartObj()에서 아래의 코드를
exec_xml('svitem', 'procSvitemAddItemsToCartObj', params, function(ret_obj) 
{
	recent_item_reload = jQuery("#c_recent_item").val();	
	if(recent_item_reload == 'true')
		r_load_cart('cart');

	if(jQuery("#is_mobile").val() == "true")
	{
		if (confirm('장바구니에 담겼습니다. 장바구니로 이동하시겠습니까?')) 
		{
			mid = jQuery("#svcart_mid").val();
			current_url = current_url.setQuery('document_srl', '');
			location.href = current_url.setQuery('mid', mid).setQuery('act','dispSvcartCartItems');
		}
	}
});
아래와 같이 변경
var response_tags = new Array('error','message','go_to_cart');
exec_xml('svitem', 'procSvitemAddItemsToCartObj', params, function(ret_obj) 
{
	recent_item_reload = jQuery("#c_recent_item").val();	
	if(recent_item_reload == 'true')
		r_load_cart('cart');
	var bGoCart = ret_obj['go_to_cart'];
	if(bGoCart == 'Y')
	{
		if (confirm('장바구니에 담겼습니다. 장바구니로 이동하시겠습니까?')) 
		{
			mid = g_sSvcartMid;//jQuery("#svcart_mid").val();
			current_url = current_url.setQuery('document_srl', '');
			location.href = current_url.setQuery('mid', mid).setQuery('act','dispSvcartCartItems');
		}
	}
}, response_tags);

./skins/plain/itemlist.html에서 아래의 코드를 
<form cond="$module_info->direct_gocart=='Y'" id="dummy_form">
	<input type="hidden" id="is_mobile" value="true" />
	<input type="hidden" id="svcart_mid" value="{$module_info->svcart_mid}" />
</form>
아래와 같이 변경
var g_sSvcartMid = '{$module_info->svcart_mid}';

./skins/plain/itemdetail.html에서 아래의 코드를 
<form cond="$module_info->direct_gocart=='Y'" id="dummy_form">
	<input type="hidden" id="is_mobile" value="true" />
	<input type="hidden" id="svcart_mid" value="{$module_info->svcart_mid}" />
</form>
아래와 같이 변경
var g_sSvcartMid = '{$module_info->svcart_mid}';

./m.skins/trendshop/itemlist.html에서 아래의 코드를 
<form cond="$module_info->direct_gocart=='Y'" id="dummy_form">
	<input type="hidden" id="is_mobile" value="true" />
	<input type="hidden" id="svcart_mid" value="{$module_info->svcart_mid}" />
</form>
아래와 같이 변경
var g_sSvcartMid = '{$module_info->svcart_mid}';

./m.skins/trendshop/itemdetail.html에서 아래의 코드를 
<form cond="$module_info->direct_gocart=='Y'" id="dummy_form">
	<input type="hidden" id="is_mobile" value="true" />
	<input type="hidden" id="svcart_mid" value="{$module_info->svcart_mid}" />
</form>
아래와 같이 변경
var g_sSvcartMid = '{$module_info->svcart_mid}';

./svitem.controller.php::procSvitemAddItemsToCartObj()에서 아래의 코드를
$oSvcartController = &getController('svcart');
$oRet = $oSvcartController->createCartObj();
if( !$oRet->toBool() )
	return $oRet;

$aCartSrl = $oRet->get('cart_srl_arr');
$this->add( 'cart_srl', implode(',',$aCartSrl));

$sMode = Context::get('mode');
switch( $sMode )
{
	case 'bi': // in case of buy immediately
		$sSvcartMid = Context::get('svcart_mid');
		if( strlen( $sSvcartMid ) == 0 )
			return new Object(-1, 'svcart mid is not specified');
		
		// find connected svorder module info
		$oModuleModel = getModel('module');
		$oSvcartConfig = $oModuleModel->getModuleInfoByMid($sSvcartMid);
		$nSvorderModuleSrl = (int)$oSvcartConfig->svorder_module_srl;
		if( !$nSvorderModuleSrl )
			return new Object(-1, 'please configure svorder in advance!');

		$oSvorderConfig = $oModuleModel->getModuleInfoByModuleSrl($nSvorderModuleSrl);
		$sSvorderMid = $oSvorderConfig->mid;
		if( strlen( $sSvorderMid ) == 0 )
			return new Object(-1, 'please configure svorder in advance!');

		$this->add( 'svorder_mid', $sSvorderMid );
		break;
	case 'atc':
		break;
}
아래와 같이 변경
$oSvcartController = &getController('svcart');
$oRet = $oSvcartController->createCartObj();
if( !$oRet->toBool() )
	return $oRet;

$aCartSrl = $oRet->get('cart_srl_arr');
$this->add( 'cart_srl', implode(',',$aCartSrl));

$sSvcartMid = Context::get('svcart_mid');
if( strlen( $sSvcartMid ) == 0 )
	return new Object(-1, 'svcart mid is not specified');		
// find connected svorder module info
$oModuleModel = getModel('module');
$oSvcartConfig = $oModuleModel->getModuleInfoByMid($sSvcartMid);
$sMode = Context::get('mode');
switch( $sMode )
{
	case 'bi': // in case of buy immediately
		$nSvorderModuleSrl = (int)$oSvcartConfig->svorder_module_srl;
		if( !$nSvorderModuleSrl )
			return new Object(-1, 'please configure svorder on svcart in advance!');
		
		$oSvorderConfig = $oModuleModel->getModuleInfoByModuleSrl($nSvorderModuleSrl);
		$sSvorderMid = $oSvorderConfig->mid;
		if( strlen( $sSvorderMid ) == 0 )
			return new Object(-1, 'please configure svorder in advance!');

		$this->add( 'svorder_mid', $sSvorderMid );
		break;
	case 'atc':
		$bCheckCart = 'N';
		if( $oSvcartConfig->check_cart == 'Y' )
			$bCheckCart = 'Y';
		$this->add( 'go_to_cart', $bCheckCart );
		break;
}

./tpl/insertmodinst.html에서 아래의 코드 제거
<div class="x_control-group">
	<label class="x_control-label" for="direct_gocart">{$lang->direct_gocart}</label>
	<div class="x_controls">
		<select name="direct_gocart" id="direct_gocart">
			<option value="N" selected="selected"|cond="$module_info->direct_gocart=='N'">{$lang->not_goto_cart}</option>
			<option value="Y" selected="selected"|cond="$module_info->direct_gocart=='Y'">{$lang->confirm_after_putting}</option>
		</select>
		<a href="#direct_gocart_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="direct_gocart_help" class="x_help-block" hidden>{$lang->about_direct_gocart}</p>
	</div>
</div>

2. 미사용 코드 제거
./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드 제거
if($_COOKIE['mobile'] == "true") 
	Context::set('is_mobile', 'true');

./svitem.admin.controller.php::procSvitemAdminDeleteItem()에서 아래의 코드 제거
$output = $oSvreviewAdminController->deleteReviewList($item_srl);
if(!$output->toBool())
	return $output;

./svitem.admin.controller.php::procSvitemAdminUpdateItemList()에서 아래의 코드 제거
$output = ModuleHandler::triggerCall('svitem.updateItem', 'after', $updated_itemlist);
if (!$output->toBool())
	return $output;

3. 카탈로그 캐쉬 초기화 기능 추가
./svitem.admin.controller.php::procSvitemAdminUpdateItemList()에서 아래의 코드 추가
$this->_resetCache();

v 1.0.7
2nd, Jul 2017
1. daum kakao EP 추가
./svitem.view.php::dispSvitemAdminConfig()에 아래의 코드 추가
$aDaumEpSvitemModules = array();
foreach( $config->daum_ep_extract_svitem as $k=>$v)
	$aDaumEpSvitemModules[$v] = 'extract';
$config->daum_ep_extract_svitem = $aDaumEpSvitemModules;

./tpl/config.html에 아래의 코드 추가
<section class="section">
	<h1>{$lang->daum_ep_setting}</h1>
	<div class="x_control-group">
		<label class="x_control-label" for="mlayout_srl">{$lang->daum_ep_use}</label>
		<div class="x_controls">{$lang->daum_ep_use_htaccess}<BR>
			<label class="x_inline" for="daum_ep_use"><input type="radio" name="daum_ep_use" id="daum_ep_use" value="Y" checked="checked"|cond="$config->daum_ep_use=='Y'" />{$lang->daum_ep_on}</label>
			<label class="x_inline" for="daum_ep_use"><input type="radio" name="daum_ep_use" id="daum_ep_use" value="N" checked="checked"|cond="$config->daum_ep_use=='N'"/>{$lang->daum_ep_off}</label>
			<a href="#daum_ep_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
			<p id="daum_ep_help" class="x_help-block" hidden>{$lang->about_daum_ep}</p>
		</div>
	</div>
	<div class="x_control-group">
		<label class="x_control-label">{$lang->daum_ep_extract_module}</label>
		<div class="x_controls">
<block loop="$svitem_mod_list=>$key,$val">
			<label class="x_inline" for="extract_svitem_{$val->module_srl}"><input type="checkbox" name="daum_ep_extract_svitem[]" id="daum_ep_extract_svitem[]" value="{$val->module_srl}" checked="checked"|cond="$config->daum_ep_extract_svitem[$val->module_srl] == 'extract'" /> {$val->mid}</label>
</block>
			<a href="#daum_ep_extract_mid_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
			<p id="daum_ep_extract_mid_help" class="x_help-block" hidden>{$lang->about_daum_ep_extract_mid}</p>
		</div>
	</div>
</section>

./svitem.model.php::getDaumEpList() 추가
./svitem.view.php::dispSvitemDaumEp() 추가

2. EP 추출 모듈 선택 해제해도 해제 안되는 오류 개선
./svitem.admin.controller.php::procSvitemAdminConfig()에 아래의 코드 추가
if( is_null( $oArgs->naver_ep_extract_svitem ) )
	$oArgs->naver_ep_extract_svitem = '';
if( is_null( $oArgs->daum_ep_extract_svitem ) )
	$oArgs->daum_ep_extract_svitem = '';

v 1.0.8
8th, Jul 2017
1. 관리자 제품등록/수정 화면에서 카탈로그 정보 호출 에러 수정
./svitem.admin.model.php::getSvitemAdminGetCategoryListAjax()를 getSvitemAdminCatalogAjax()로 변경
./tpl/insertitem.html에서 아래의 코드 제거, ./tpl/js/script.js와 함수 중복
function load_categories(module_srl, node_id, target) 
{
	if (typeof(node_id)=='undefined') node_id = 'f.';
	if (typeof(target)=='undefined') target = '#category_depth1';

	$target = jQuery(target);
	var $first_option = jQuery(target).children().eq(0);
	$target.empty();
	$target.append($first_option);

	jQuery.ajax({
		type: 'POST',
		dataType: "json",
		contentType: "application/json; charset=utf-8",
		async : false,
		url: "./",
		data : { 
			module : "svitem"
			, act : "getSvitemAdminCatalogAjax"
			, node_id : node_id
			, module_srl : module_srl
		}, 
		success : function (r) {
			if (r.error == -1) {
				alert(r.message);
			} else {
				for (i = 0; i < r.data.length; i++) {
					jQuery('<option value="' + r.data[i].attr.node_id + '">' + r.data[i].attr.node_name + '</option>').appendTo(target);
				}
			}
		}
	});
}
(function($) {
	jQuery(function($) {
		load_categories({$module_srl});
		$('.category').change(function() {
			var node_id = $('option:selected', this).val();
			var depth = $(this).attr('depth');
			depth = parseInt(depth);
			depth++;
			jQuery('input[name=category_id]').val(node_id);
			load_categories({$module_srl}, node_id, '#category_depth'+depth);
		});
	});
}) (jQuery);

./tpl/updateitem.html에서 아래의 코드 제거, ./tpl/js/script.js와 함수 중복
function load_categories(module_srl, node_id, target) 
{
	if (typeof(node_id)=='undefined') node_id = 'f.';
	if (typeof(target)=='undefined') target = '#category_depth1';

	$target = jQuery(target);
	var $first_option = jQuery(target).children().eq(0);
	$target.empty();
	$target.append($first_option);

	jQuery.ajax({
		type: 'POST',
		dataType: "json",
		contentType: "application/json; charset=utf-8",
		async : false,
		url: "./",
		data : { 
			module : "svitem"
			, act : "getSvitemAdminCatalogAjax"
			, node_id : node_id
			, module_srl : module_srl
		}, 
		success : function (r) {
			if (r.error == -1) {
				alert(r.message);
			} else {
				for (i = 0; i < r.data.length; i++) {
					jQuery('<option value="' + r.data[i].attr.node_id + '">' + r.data[i].attr.node_name + '</option>').appendTo(target);
				}
			}
		}
	});
}
(function($) {
	jQuery(function($) {
		load_categories({$module_srl});
		$('.category').change(function() {
			var node_id = $('option:selected', this).val();
			var depth = $(this).attr('depth');
			depth = parseInt(depth);
			depth++;
			jQuery('input[name=category_id]').val(node_id);
			load_categories({$module_srl}, node_id, '#category_depth'+depth);
		});
	});
}) (jQuery);

2. 미사용 코드 제거
./svitem.admin.model.php::getProcModules() 제거
./svitem.model.php::getProcModules() 제거

3. 관리자 상품 정보 수정화면에서 스킨 폴더의 파일만 표시하도록 변경
./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 아래의 코드를 
if( strpos($val, 'html.' ) === FALSE)
아래와 같이 변경
if( strpos($val, '.html' ) && strpos($val, 'html.' ) === FALSE)

v 1.0.9
17th, Jul 2017
1. daum kakao 쇼핑하우 EP 통신 코드 개선
./svitem.model.php::getDaumEpList()에서 아래의 코드를
foreach($discounted as $key=>$val)
{
	$val->item_name = iconv('UTF-8', 'EUC-KR', $val->item_name);
	$val->enhanced_item_info->naver_ep_item_name = iconv('UTF-8', 'EUC-KR', $val->enhanced_item_info->naver_ep_item_name );
	$val->enhanced_item_info->ga_category_name = iconv('UTF-8', 'EUC-KR', $val->enhanced_item_info->ga_category_name );
	$val->enhanced_item_info->ga_brand_name = iconv('UTF-8', 'EUC-KR', $val->enhanced_item_info->ga_brand_name );
	$val->enhanced_item_info->naver_ep_maker = iconv('UTF-8', 'EUC-KR', $val->enhanced_item_info->naver_ep_maker );
	$val->enhanced_item_info->naver_ep_origin = iconv('UTF-8', 'EUC-KR', $val->enhanced_item_info->naver_ep_origin );
	$discounted[$key]->link = $sServerName.'/'.$sMid.'/'.$val->document_srl.'?utm_source=daum&utm_medium=cpc&utm_campaign=DAUM_PS_CPC_DMSHOPPING_00_00&utm_term=DMSHOPPING_'.$val->document_srl;

	if( $val->price > $nFreeDeliveryAmnt )
		$discounted[$key]->shipping_cost = 0;
	else
		$discounted[$key]->shipping_cost = $nDeliveryFee;
	
	if( strlen( $val->enhanced_item_info->naver_ep_naver_category ) == 0 )
		$discounted[$key]->enhanced_item_info->naver_ep_naver_category = ' ';

	$nReview = $this->getReviewCnt($val->item_srl);
	$discounted[$key]->review_cnt = $nReview;
}
foreach($discounted as $key=>$val) 
	$aExtracted[$nIdx++] = $val;

아래와 같이 변경
foreach($discounted as $key1=>$val1)
{
	$oCatalog = $this->getCatalog($val1->module_srl, $val1->category_node_srl );
	$val1->item_name = iconv('UTF-8', 'EUC-KR', $val1->item_name);
	$val1->catalog_name = iconv('UTF-8', 'EUC-KR', $oCatalog->current_catalog_info->node_name);
	$val1->enhanced_item_info->naver_ep_item_name = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->naver_ep_item_name );
	//$val1->enhanced_item_info->ga_category_name = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->ga_category_name );
	$val1->enhanced_item_info->ga_category_name = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->ga_category_name );
	$val1->enhanced_item_info->ga_brand_name = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->ga_brand_name );
	$val1->enhanced_item_info->naver_ep_maker = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->naver_ep_maker );
	$val1->enhanced_item_info->naver_ep_origin = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->naver_ep_origin );
	$discounted[$key1]->link = $sServerName.'/'.$sMid.'/'.$val1->document_srl.'?utm_source=daum&utm_medium=cpc&utm_campaign=DAUM_PS_CPC_DMSHOPPING_00_00&utm_term=DMSHOPPING_'.$val1->document_srl;

	if( $val1->price > $nFreeDeliveryAmnt )
		$discounted[$key1]->shipping_cost = 0;
	else
		$discounted[$key1]->shipping_cost = $nDeliveryFee;
	
	if( strlen( $val1->enhanced_item_info->naver_ep_naver_category ) == 0 )
		$discounted[$key1]->enhanced_item_info->naver_ep_naver_category = ' ';

	$nReview = $this->getReviewCnt($val1->item_srl);
	$discounted[$key1]->review_cnt = $nReview;
}
// 배열 결합
foreach($discounted as $key2=>$val2) 
	$aExtracted[$nIdx++] = $val2;
2. naver 쇼핑하우 EP 통신 코드 개선
./svitem.model.php::getNaverEpList()에서 아래의 코드를
foreach($discounted as $key=>$val)
{
	$discounted[$key]->link = $sServerName.'/'.$sMid.'/'.$val->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOPPING_00_00&utm_term=NVSHOPPING_'.$val->document_srl;

	if( $val->price > $nFreeDeliveryAmnt )
		$discounted[$key]->shipping_cost = 0;
	else
		$discounted[$key]->shipping_cost = $nDeliveryFee;

	if( strlen( $val->enhanced_item_info->naver_ep_naver_category ) == 0 )
		$discounted[$key]->enhanced_item_info->naver_ep_naver_category = ' ';
	if( strlen( $val->enhanced_item_info->naver_ep_barcode ) == 0 )
		$discounted[$key]->enhanced_item_info->naver_ep_barcode = ' ';
	if( strlen( $val->enhanced_item_info->naver_ep_search_tag ) == 0 )
		$discounted[$key]->enhanced_item_info->naver_ep_search_tag = ' ';

	$nReview = $this->getReviewCnt($val->item_srl);
	$discounted[$key]->review_cnt = $nReview;
}
// 배열 결합
foreach($discounted as $key=>$val) 
	$aExtracted[$nIdx++] = $val;

아래와 같이 변경
foreach($discounted as $key1=>$val1)
{
	$discounted[$key1]->link = $sServerName.'/'.$sMid.'/'.$val1->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOPPING_00_00&utm_term=NVSHOPPING_'.$val1->document_srl;

	if( $val1->price > $nFreeDeliveryAmnt )
		$discounted[$key1]->shipping_cost = 0;
	else
		$discounted[$key1]->shipping_cost = $nDeliveryFee;

	if( strlen( $val1->enhanced_item_info->naver_ep_naver_category ) == 0 )
		$discounted[$key1]->enhanced_item_info->naver_ep_naver_category = ' ';
	if( strlen( $val1->enhanced_item_info->naver_ep_barcode ) == 0 )
		$discounted[$key1]->enhanced_item_info->naver_ep_barcode = ' ';
	if( strlen( $val1->enhanced_item_info->naver_ep_search_tag ) == 0 )
		$discounted[$key1]->enhanced_item_info->naver_ep_search_tag = ' ';

	$nReview = $this->getReviewCnt($val1->item_srl);
	$discounted[$key1]->review_cnt = $nReview;
}
// 배열 결합
foreach($discounted as $key2=>$val2) 
	$aExtracted[$nIdx++] = $val2;

v 1.1.0
26th, Jul 2017
1. daum kakao 쇼핑하우 EP 통신 코드 개선
./svitem.admin.view.php::dispSvitemAdminUpdateItem()에 아래의 코드 추가
Context::set('daum_ep_use', $oConfig->daum_ep_use);

./svitem.admin.view.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$sDEpItemName = strip_tags( Context::get('daum_ep_item_name') );
$oEnhancedItemInfo->daum_ep_item_name = $sDEpItemName;

./tpl/updateitem.html에 아래의 코드 추가
<section class="section collapsed" cond="$daum_ep_use=='Y'">
	<h1>{$lang->title_daum_ep_info}</h1>
	<div class="x_control-group">
		<div class="x_control-label" for="">EP 연동 상품명</div>
		<div class="x_controls">
			<input name="daum_ep_item_name" type="text" value="{$item_info->enhanced_item_info->daum_ep_item_name}" />
		</div>
	</div>
</section>

./tpl/daum_ep.html에서 아래의 코드를
<<<pname>>>{$val->enhanced_item_info->naver_ep_item_name}{@echo PHP_EOL;}
아래와 같이 변경
<<<pname>>>{$val->enhanced_item_info->daum_ep_item_name}{@echo PHP_EOL;}

./svitem.model.php::getDaumEpList()에서 아래의 코드를
$val1->enhanced_item_info->naver_ep_item_name = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->naver_ep_item_name );
아래와 같이 변경
$val1->enhanced_item_info->daum_ep_item_name = iconv('UTF-8', 'EUC-KR', $val1->enhanced_item_info->daum_ep_item_name );

v 1.1.1
28th, Jul 2017
1. daum kakao 쇼핑하우 CPC EP 추적 URL 변경 -> 광고주 입력 화면 글자수 제한에 맞춤
./svitem.model.php::getDaumEpList()에서 아래의 코드를
$discounted[$key1]->link = $sServerName.'/'.$sMid.'/'.$val1->document_srl.'?utm_source=daum&utm_medium=cpc&utm_campaign=DAUM_PS_CPC_DMSHOP_00_00&utm_term=DMSHOPPING_'.$val1->document_srl;
아래와 같이 변경
$discounted[$key1]->link = $sServerName.'/'.$sMid.'/'.$val1->document_srl.'?utm_source=daum&utm_medium=cpc&utm_campaign=DAUM_PS_CPC_DMSHOP_00_00&utm_term=DMSHOP_'.$val1->document_srl;

2. Naver 쇼핑 CPC EP 추적 URL 변경 -> 광고주 입력 화면 글자수 제한에 맞춤
./svitem.model.php::getNaverEpList()에서 아래의 코드를
$discounted[$key1]->link = $sServerName.'/'.$sMid.'/'.$val1->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOPPING_00_00&utm_term=NVSHOPPING_'.$val1->document_srl;
아래와 같이 변경
$discounted[$key1]->link = $sServerName.'/'.$sMid.'/'.$val1->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOP_00_00&utm_term=NVSHOP_'.$val1->document_srl;

v 1.1.2
2nd, Sep 2017
1. svorder v 0.8.5에 대응
./svitem.admin.view.php::dispSvitemAdminItemExtraSetup()에서 아래의 코드 제거
$oModel = &getModel($this->module_info->proc_module);
foreach($ExtraList as $k => $v)
{
	$check_name = $oModel->checkSvitemExtraName($v->column_name);
	if($check_name == true)
		$v->index_extra = "true";
}

v 1.1.3
3rd, Nov 2017
1. 아이템별 QNA 기능 추가
./tpl/_header.html에 아래의 코드 추가
<li class="x_active"|cond="$act=='dispSvitemAdminQnaBoardMgmt'"><a href="{getUrl('act','dispSvitemAdminQnaBoardMgmt')}">{$lang->cmd_qna_board_mgmt}</a></li>

./svitem.admin.view.php::dispSvitemAdminQnaBoardMgmt() 추가

./tpl/qnaboard_mgmt.html 추가

./svitem.admin.controller.php::procSvitemAdminUpdateQnaBoardMgmt() 추가

v 2.1.3
10th, Mar 2018
1. ext_mall logger 기능 추가
./tpl/itemlist.html에 아래의 코드 추가
<th>{$lang->cmd_extmall_logger}</th>

./schemas/svitem_items.xml에서 아래의 코드 추가
<column name="extmall_log_conf" type="text" />

./svitem.admin.view.php::dispSvitemAdminExtMallLogger() 추가

./tpl/extmall_logger.html 추가

./queries/updateAdminItemExtmallLogConfig.xml 추가

./svitem.admin.controller.php::procSvitemAdminUpdateExtmallLogger() 추가
./svitem.admin.controller.php::_updateExtmallLoggerConfig() 추가
./svitem.admin.controller.php::_registerExtmallLogger() 추가
./svitem.admin.controller.php::_registerExtmallLoggerDaily() 추가

./queries/insertAdminExtmall.xml 추가

./svitem.model.admin.php::getExtMallListByItemSrl() 추가
./queries/getExtmallListByItemSrl.xml 추가

./tpl/skin.js/layer_popup.js 추가
./tpl/css/layer_popup_mob.css 추가
./tpl/css/layer_popup_pc.css 추가

./svitem.model.php::getSvitemDetailPageAction() 추가

./tpl/skin.js/itemdetail.js::_g_bExtmallLayerProcessed 추가

./tpl/skin.js/itemdetail.js::_showExtmallLayerPopup() 추가
./tpl/skin.js/itemdetail.js::orderItemsInDetailPage()에서 아래의 코드를
var param = _getCartParamsInDetailPage(item_srl);
var nParamCnt = param.length;
var nQty = 0;
for( var i = 0; i < nParamCnt; i++ )
	nQty += parseInt( param[i].quantity );

gatkDetail.patchBuyImmediately( nQty );
_orderItemsDirectly(param);

아래와 같이 변경
var params = new Array();
params['item_srl'] = item_srl;
var respons = ['sExtmallLoggerToggle','sLayerHtml'];
exec_xml('svitem', 'getSvitemDetailPageAction', params, function(ret_obj) {
	sExtmallToggle = ret_obj['sExtmallLoggerToggle'];
	if( sExtmallToggle == 'on' )
	{
		_showExtmallLayerPopup(ret_obj['sLayerHtml']);
		gatkDetail.patchBuyImmediately( 1 );
	}
	else
	{
		var param = _getCartParamsInDetailPage(item_srl);
// Enhanced E-Commerce Tagging Begin (20151121) singleview.co.kr
		var nParamCnt = param.length;
		var nQty = 0;
		for( var i = 0; i < nParamCnt; i++ )
			nQty += parseInt( param[i].quantity );

		gatkDetail.patchBuyImmediately( nQty );
// Enhanced E-Commerce Tagging End (20151121) singleview.co.kr
		_orderItemsDirectly(param);
	}
},respons);

./tpl/skin.js/itemdetail.js::addItemsToCartInDetailPage()에서 아래의 코드를
var param = _getCartParamsInDetailPage(item_srl);
// Enhanced E-Commerce Tagging Begin (20151121) singleview.co.kr
var nParamCnt = param.length;
var nQty = 0;
for( var i = 0; i < nParamCnt; i++ )
	nQty += parseInt( param[i].quantity );

gatkDetail.patchAddToCart( nQty );
// Enhanced E-Commerce Tagging End (20151121) singleview.co.kr
_addItemsToCartObj(param);

아래와 같이 변경
var params = new Array();
params['item_srl'] = item_srl;
var respons = ['sExtmallLoggerToggle','sLayerHtml'];
exec_xml('svitem', 'getSvitemDetailPageAction', params, function(ret_obj) {
	sExtmallToggle = ret_obj['sExtmallLoggerToggle'];
	if( sExtmallToggle == 'on' )
	{
		_showExtmallLayerPopup(ret_obj['sLayerHtml']);
		gatkDetail.patchBuyImmediately( 1 );
	}
	else
	{
		var param = _getCartParamsInDetailPage(item_srl);
// Enhanced E-Commerce Tagging Begin (20151121) singleview.co.kr
		var nParamCnt = param.length;
		var nQty = 0;
		for( var i = 0; i < nParamCnt; i++ )
			nQty += parseInt( param[i].quantity );

		gatkDetail.patchAddToCart( nQty );
// Enhanced E-Commerce Tagging End (20151121) singleview.co.kr
		_addItemsToCartObj(param);
	}
},respons);

2. tbl::svitem_items->review_count 제거
./schemas/svitem_items.xml에서 아래의 코드 제거
<column name="review_count" type="number" size="11" default="0" notnull="notnull" index="idx_review_count" />

./queries/getAdminItemList.xml에서 아래의 코드 제거
<column name="review_count" />

./queries/getShowWindowItems.xml에서 아래의 코드 제거
<column name="item.review_count" alias="review_count" />

./queries/insertItem.xml에서 아래의 코드 제거
<column name="review_count" var="review_count" />

./svitem.admin.model.php::_getItemList()에 아래의 코드 추가
$oSvitemModel = &getModel('svitem');
foreach( $output->data as $key=>$val )
	$val->review_count = $oSvitemModel->getReviewCnt($val->item_srl);

3. 코드 오류 수정
./svitem.admin.model.php::_getItemList()에서 아래의 코드를
$output = executeQueryArray('svitem.getAdminItemList', $oParam );
아래와 같이 변경
$output = executeQueryArray('svitem.getAdminItemList', $oArg);

4. 상품별 후기 게시판 미설정이면 관리자 화면에서 오류 발생하는 상황 수정
./svitem.model.php::_getItemList()에서 아래의 코드를
$oConfig = $this->getModuleConfig();
$oDocumentModel = getModel('document');
$category_content = $oDocumentModel->getCategoryPhpFile($oConfig->connected_review_board_srl);
require($category_content );
$nReviewCnt = 0;
foreach( $oConfig->review_for_item[$nItemSrl] as $key=>$val)
{
	if( $val == 'match' )
		$nReviewCnt += (int)$menu->list[$key]['document_count'];
}
return $nReviewCnt;

아래와 같이 변경
$oConfig = $this->getModuleConfig();
if( $oConfig->connected_review_board_srl > 0 )
{
	$oDocumentModel = getModel('document');
	$category_content = $oDocumentModel->getCategoryPhpFile($oConfig->connected_review_board_srl);

	require($category_content );
	$nReviewCnt = 0;
	foreach( $oConfig->review_for_item[$nItemSrl] as $key=>$val)
	{
		if( $val == 'match' )
			$nReviewCnt += (int)$menu->list[$key]['document_count'];
	}
}
else
	$nReviewCnt = 0;
return $nReviewCnt;

v 2.1.4
14th, Mar 2018
1. ext_mall logger를 표시하는 DOM 요소가 브라우저에 등록되는 시간을 보장하도록 수정
./tpl/skin.js/itemdetail.js::addItemsToCartInDetailPage()에서 아래의 코드를
// load css
var isMobile = false; //initiate as false
// device detection
if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
	|| /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) 
	isMobile = true;

var sCssFullPath = isMobile ? '/modules/svitem/tpl/css/layer_popup_mob.css' : '/modules/svitem/tpl/css/layer_popup_pc.css'

if( document.createStyleSheet )
	document.createStyleSheet(sCssFullPath);
else 
	jQuery("head").append(jQuery("<link rel='stylesheet' href='"+ sCssFullPath + "' type='text/css' media='screen' />"));

// load javascript
jQuery.getScript("/modules/svitem/tpl/skin.js/layer_popup.js", function(){
	layer_open('layer_ext_mall');
	var scmove = jQuery('#layer_ext_mall').offset().top;
	jQuery('html, body').animate( { scrollTop : scmove }, 400 );
});
_g_bExtmallLayerProcessed = true;

아래와 같이 수정
var delayInMilliseconds = 300; // wait for completing layer DOM element
setTimeout(function() {
	// load css
	var isMobile = false; //initiate as false
	// device detection
	if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
		|| /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) 
		isMobile = true;

	var sCssFullPath = isMobile ? '/modules/svitem/tpl/css/layer_popup_mob.css' : '/modules/svitem/tpl/css/layer_popup_pc.css'

	if( document.createStyleSheet )
		document.createStyleSheet(sCssFullPath);
	else 
		jQuery("head").append(jQuery("<link rel='stylesheet' href='"+ sCssFullPath + "' type='text/css' media='screen' />"));

	// load javascript
	jQuery.getScript("/modules/svitem/tpl/skin.js/layer_popup.js", function(){
		layer_open('layer_ext_mall');
		var scmove = jQuery('#layer_ext_mall').offset().top;
		jQuery('html, body').animate( { scrollTop : scmove }, 400 );
	});
	_g_bExtmallLayerProcessed = true;
}, delayInMilliseconds);

v 2.1.5
18th, Apr 2018
1. 카탈로그 페이지의 cache가 작동하면 page URI가 작동하지 않는 문제 해결
./svitem.model.php::extractItemListForListPage()에서 아래의 코드를
$sCatalogItemListCacheFile = FileHandler::readFile('./files/cache/svitem/catalog_itemlist.'.$nModuleSrl.'.'.$nCatalogSrl.'.cache.php');
if($sCatalogItemListCacheFile)
	$output = unserialize( $sCatalogItemListCacheFile );
else
	$output = $this->_compileCatalogItemListCache($nModuleSrl, $nCatalogSrl, $args);

아래와 같이 변경
if( is_null( $args->page ) )
	$args->page = 1;

$sCatalogItemListCacheFile = FileHandler::readFile('./files/cache/svitem/catalog_itemlist.'.$nModuleSrl.'.'.$nCatalogSrl.'.'.$args->page.'.cache.php');
if($sCatalogItemListCacheFile)
	$output = unserialize( $sCatalogItemListCacheFile );
else
	$output = $this->_compileCatalogItemListCache($nModuleSrl, $nCatalogSrl, $args);

./svitem.model.php::_compileCatalogItemListCache()에서 아래의 코드를
FileHandler::writeFile('./files/cache/svitem/catalog_itemlist.'.$nModuleSrl.'.'.$nCatalogSrl.'.cache.php', $sSerializedRst);
아래와 같이 변경
FileHandler::writeFile('./files/cache/svitem/catalog_itemlist.'.$nModuleSrl.'.'.$nCatalogSrl.'.'.$oArgs->page.'.cache.php', $sSerializedRst);

2. 상품 목록 관리자 페이지에서 미분류 상품 영역에 미분류 상품만 표시하도록 수정
./svitem.model.php::_getItemList()에서 아래의 코드를
if( !is_null($oParam->category_node_srl) && $oParam->category_node_srl != 0 )
아래와 같이 변경
if( !is_null($oParam->category_node_srl) )

v 2.1.6
19th, Apr 2018
1. ext_mall logger를 표시하는 DOM 요소가 브라우저에 등록되는 시간을 보장하도록 수정
./tpl/skin.js/itemdetail.js::_showExtmallLayerPopup()에서 아래의 코드를
// load layer popup html
jQuery('body').append(sLayerHtml);

var delayInMilliseconds = 300; // wait for completing layer DOM element
setTimeout(function() {
	// load css
	var isMobile = false; //initiate as false
	// device detection
	if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
		|| /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) 
		isMobile = true;

	var sCssFullPath = isMobile ? '/modules/svitem/tpl/css/layer_popup_mob.css' : '/modules/svitem/tpl/css/layer_popup_pc.css'

	if( document.createStyleSheet )
		document.createStyleSheet(sCssFullPath);
	else 
		jQuery("head").append(jQuery("<link rel='stylesheet' href='"+ sCssFullPath + "' type='text/css' media='screen' />"));

	// load javascript
	jQuery.getScript("/modules/svitem/tpl/skin.js/layer_popup.js", function(){
		layer_open('layer_ext_mall');
		var scmove = jQuery('#layer_ext_mall').offset().top;
		jQuery('html, body').animate( { scrollTop : scmove }, 400 );
	});
	_g_bExtmallLayerProcessed = true;
}, delayInMilliseconds);

아래와 같이 수정
jQuery('body').append(sLayerHtml);
// load css
var isMobile = false; //initiate as false
// device detection
if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
	|| /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) 
	isMobile = true;

var sCssFullPath = isMobile ? '/modules/svitem/tpl/css/layer_popup_mob.css' : '/modules/svitem/tpl/css/layer_popup_pc.css'

if( document.createStyleSheet )
	document.createStyleSheet(sCssFullPath);
else 
	jQuery("head").append(jQuery("<link rel='stylesheet' href='"+ sCssFullPath + "' type='text/css' media='screen' />"));

jQuery.getScript("/modules/svitem/tpl/skin.js/layer_popup.js", function(){}); // load javascript

_g_bExtmallLayerProcessed = true;

var delayInMilliseconds = 300; // wait for completing layer DOM element
setTimeout(function() {
	layer_open('layer_ext_mall');
	var scmove = jQuery('#layer_ext_mall').offset().top;
	jQuery('html, body').animate( { scrollTop : scmove }, 400 );
}, delayInMilliseconds);

v 2.1.7
20th, Apr 2018
1. ext_mall logger 레이어 팝업이 svtracker layer popup과 겹쳐서 표시되는 문제 해결
./svitem.model.php::getSvitemDetailPageAction()에서 아래의 코드를
$sLayerHtml = "<div class='layer'>

아래와 같이 변경
$sLayerHtml = "<div class='svitem_layer'>

./tpl/skin.js/layer_popup.js에서 아래의 코드를
.layer
아래와 같이 변경
.svitem_layer

./tpl/css/layer_popup_mob.css에서 아래의 코드를
.layer
아래와 같이 변경
.svitem_layer

./tpl/css/layer_popup_pc.css에서 아래의 코드를
.layer
아래와 같이 변경
.svitem_layer

v 2.1.8
25th, Apr 2018
1.svitem 외부 모듈에서 currency_symbol의 style을 제어하기 위한 변경, class 식별자로는 접근성 제약이 생김
./svitem.item.php::printPrice()에서 아래의 코드를
return sprintf("<span class=\"currency_symbol\">%s</span><span id=\"sales_price\">%s</span>", $currency, number_format($price, $this->decimals));
아래와 같이 변경
return sprintf("<span id=\"currency_symbol\" class=\"currency_symbol\">%s</span><span id=\"sales_price\">%s</span>", $currency, number_format($price, $this->decimals));

v 2.1.9
26th, Apr 2018
1. plain skin에서 카테고리 제목을 명시적으로 표시하는 것으로 설정할 때만 표시하도록 변경
./skins/plain/skin.xml에서 아래의 코드 추가
<options value="">
	<title xml:lang="ko">선택하세요.</title>
</options>

./skins/plain/itemlist.html에서 아래의 코드를
<include cond="$module_info->category_display != 'N' && $module_info->category_title != 'N'" target="categorylist_title.html" />
아래와 같이 변경
<include cond="$module_info->category_display != 'N' && $module_info->category_title == 'Y'" target="categorylist_title.html" />

./m.skins/trendshop/itemlist.html에서 아래의 코드를
<include cond="$module_info->category_display != 'N' && $module_info->category_title != 'N'" target="categorylist_title.html" />
아래와 같이 변경
<include cond="$module_info->category_display != 'N' && $module_info->category_title == 'Y'" target="categorylist_title.html" />

v 2.1.10
16th, May 2018
1. naver_ep.tsv에서 https 적용 (네이버쇼핑 EP 검수팀 의견에 따른 수정)
./svitem.model.php::getNaverEpList()에서 아래의 코드를
$sServerName = 'http://'.$_SERVER['SERVER_NAME'];

아래와 같이 변경
$sServerName = $db_info->default_url;

./svitem.model.php::getNaverEpList()에 아래의 코드 추가
$discounted[$key1]->thumbnail_url = str_replace('https', 'http', $val1->getThumbnail(300,300,'crop'));

./tpl/naver_ep.html에서 아래의 코드를
{$val->getThumbnail(300,300,'crop')}
아래와 같이 변경
{$val->thumbnail_url}

v 2.1.11
18th, May 2018
1. naver_ep.tsv에서 필수 입력값이 공백이면 출력하지 않도록 변경
./svitem.model.php::getNaverEpList()에서 아래의 코드를
foreach($discounted as $key1=>$val1)
{
	$discounted[$key1]->link = $sServerName.$sMid.'/'.$val1->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOP_00_00&utm_term=NVSHOP_'.$val1->document_srl;
	$discounted[$key1]->thumbnail_url = str_replace('https', 'http', $val1->getThumbnail(300,300,'crop'));

	if( $val1->price > $nFreeDeliveryAmnt )
		$discounted[$key1]->shipping_cost = 0;
	else
		$discounted[$key1]->shipping_cost = $nDeliveryFee;

	if( strlen( $val1->enhanced_item_info->naver_ep_naver_category ) == 0 )
		$discounted[$key1]->enhanced_item_info->naver_ep_naver_category = ' ';
	if( strlen( $val1->enhanced_item_info->naver_ep_barcode ) == 0 )
		$discounted[$key1]->enhanced_item_info->naver_ep_barcode = ' ';
	if( strlen( $val1->enhanced_item_info->naver_ep_search_tag ) == 0 )
		$discounted[$key1]->enhanced_item_info->naver_ep_search_tag = ' ';

	$nReview = $this->getReviewCnt($val1->item_srl);
	$discounted[$key1]->review_cnt = $nReview;
}

foreach($discounted as $key2=>$val2)
{
	$aExtracted[$nIdx++] = $val2;
}

아래와 같이 변경
foreach($discounted as $key1=>$val1)
{
	$discounted[$key1]->link = $sServerName.$sMid.'/'.$val1->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOP_00_00&utm_term=NVSHOP_'.$val1->document_srl;
	$discounted[$key1]->thumbnail_url = str_replace('https', 'http', $val1->getThumbnail(300,300,'crop'));

	if( $val1->price > $nFreeDeliveryAmnt )
		$discounted[$key1]->shipping_cost = 0;
	else
		$discounted[$key1]->shipping_cost = $nDeliveryFee;

	if( strlen( $val1->enhanced_item_info->naver_ep_item_name ) == 0 )
	{
		$discounted[$key1]->bPrintOut = false;
		continue;
	}
	else
	{
		if( strlen( $val1->enhanced_item_info->naver_ep_naver_category ) == 0 )
			$discounted[$key1]->enhanced_item_info->naver_ep_naver_category = ' ';
		if( strlen( $val1->enhanced_item_info->naver_ep_barcode ) == 0 )
			$discounted[$key1]->enhanced_item_info->naver_ep_barcode = ' ';
		if( strlen( $val1->enhanced_item_info->naver_ep_search_tag ) == 0 )
			$discounted[$key1]->enhanced_item_info->naver_ep_search_tag = ' ';

		$nReview = $this->getReviewCnt($val1->item_srl);
		$discounted[$key1]->review_cnt = $nReview;
		$discounted[$key1]->bPrintOut = true;
	}
}

foreach($discounted as $key2=>$val2)
{
	if( $val2->bPrintOut )
		$aExtracted[$nIdx++] = $val2;
}

v 2.1.12
31st, May 2018
1. 후기 게시판 관리 화면에서 MID + 상품명 표시
./svitem.admin.model.php::getAllDisplayingItemList()에서 아래의 코드를
$list = $output->data;
$oSvpromotionModel = &getModel('svpromotion');
$retobj = $oSvpromotionModel->getItemPriceList($list);
return $retobj;

아래와 같이 변경
$oModuleModel = getModel('module');
foreach( $output->data as $key=>$val )
{
	$oModuleInfo = $oModuleModel->getModuleInfoByModuleSrl($val->module_srl);
	$output->data[$key]->mid = $oModuleInfo->mid;
}
return $output->data;

./svitem.admin.view.php::dispSvitemAdminReviewBoardMgmt()에서 아래의 코드를
foreach( $aDisplayList as $key=>$val)
	$aDisplayItems[$val->item_srl] = $val->item_name;

아래와 같이 변경
foreach( $aDisplayList as $key=>$val)
{
	$aDisplayItems[$val->item_srl]->item_name = $val->item_name;
	$aDisplayItems[$val->item_srl]->mid = $val->mid;
}

./svitem.admin.view.php::dispSvitemAdminQnaBoardMgmt()에서 아래의 코드를
foreach( $aDisplayList as $key=>$val)
	$aDisplayItems[$val->item_srl] = $val->item_name;

아래와 같이 변경
foreach( $aDisplayList as $key=>$val)
{
	$aDisplayItems[$val->item_srl]->item_name = $val->item_name;
	$aDisplayItems[$val->item_srl]->mid = $val->mid;
}

./tpl/reviewboard_mgmt.html에서 아래의 코드를 
<label class="x_control-label" for="review_for_item">"{$item_val}"=> 후기</label>
아래와 같이 변경
<label class="x_control-label" for="review_for_item">{$item_val->mid}<BR>"{$item_val->item_name}"=> 후기</label>

./tpl/qnaboard_mgmt.html에서 아래의 코드를 
<label class="x_control-label" for="qna_for_item">"{$item_val}"=> 질문</label>
아래와 같이 변경
<label class="x_control-label" for="qna_for_item">{$item_val->mid}<BR>"{$item_val->item_name}"=> 질문</label>

v 2.1.13
17th, Jun 2018
1. 외부 업체 스크립트용 변수 기능 추가
./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$sDescriptionSkinPath = _XE_PATH_.'files/svitem/';
$oHiddenExtraVars = unserialize( $item_info->extra_vars );

Context::set('extmall_logger_toggle', $oHiddenExtraVars->extmall_logger);

if( strlen( $oHiddenExtraVars->description_skin_pc->value ) > 0 )
	Context::set('description_skin_pc_selected', $sDescriptionSkinPath.$oHiddenExtraVars->description_skin_pc->value);

if( strlen( $oHiddenExtraVars->description_skin_mob->value ) > 0 )
	Context::set('description_skin_mob_selected', $sDescriptionSkinPath.$oHiddenExtraVars->description_skin_mob->value);

아래와 같이 변경
$sArchivePath = _XE_PATH_.'files/svitem/';
$oHiddenExtraVars = unserialize( $item_info->extra_vars );

Context::set('extmall_logger_toggle', $oHiddenExtraVars->extmall_logger);

if( strlen( $oHiddenExtraVars->description_skin_pc->value ) > 0 )
	Context::set('description_skin_pc_selected', $sArchivePath.$oHiddenExtraVars->description_skin_pc->value);

if( strlen( $oHiddenExtraVars->description_skin_mob->value ) > 0 )
	Context::set('description_skin_mob_selected', $sArchivePath.$oHiddenExtraVars->description_skin_mob->value);

./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
$oTemplate = &TemplateHandler::getInstance();
$sExtScript = $oTemplate->compile($sArchivePath, 'ext_script_detail_page_'.$this->module_info->module_srl);
Context::set('ext_script', $sExtScript );

./tpl/detaillistsetup.html 에 아래의 코드 추가
<BR><BR><BR>
<div class="x_control-group">
	<div class="x_control-label" for="">3rd party script with skin vars </div>
	<div class="x_controls">
		<textarea name="ext_script">{$ext_script}</textarea>
	</div>
</div>

./svitem.admin.controller.php::procSvitemAdminInsertDetailListConfig()에 아래의 코드 추가
$this->_registerExtScript('detail_page');

./svitem.admin.controller.php::_registerExtScript() 추가

./svitem.admin.model.php::getExtScript() 추가

./svitem.admin.view.php::dispSvitemAdminDetailListSetup()에 아래의 코드 추가
$oSvitemAdminModel = &getAdminModel('svitem');
$sExtScript = $oSvitemAdminModel->getExtScript($this->module_info->module_srl, 'detail_page');
Context::set('ext_script', htmlspecialchars($sExtScript) );

./skins/plain/itemdetail.html에 아래의 코드 추가
<block cond="$ext_script">
{$ext_script}
</block>

./m.skins/trendshop/itemdetail.html에 아래의 코드 추가
<block cond="$ext_script">
{$ext_script}
</block>

./tpl/listsetup.html 에 아래의 코드 추가
<BR><BR><BR>
<div class="x_control-group">
	<div class="x_control-label" for="">3rd party script with skin vars </div>
	<div class="x_controls">
		<textarea name="ext_script">{$ext_script}</textarea>
	</div>
</div>

./svitem.admin.view.php::dispSvitemAdminDetailListSetup()에 아래의 코드 추가
$oSvitemAdminModel = &getAdminModel('svitem');
$sExtScript = $oSvitemAdminModel->getExtScript($this->module_info->module_srl, 'list_page');
Context::set('ext_script', htmlspecialchars($sExtScript) );

./svitem.admin.controller.php::procSvitemAdminInsertDetailListConfig()에 아래의 코드 추가
$this->_registerExtScript('list_page');

v 2.1.14
23rd, Jun 2018
1. 외부 업체 스크립트용 변수 기능 오류 수정
./svitem.view.php::dispSvitemItemList()에서 아래의 코드를
$sArchivePath = _XE_PATH_.'files/svitem/';
$oTemplate = &TemplateHandler::getInstance();
$sExtScript = $oTemplate->compile($sArchivePath, 'ext_script_list_page_'.$this->module_info->module_srl);
Context::set('ext_script', $sExtScript );

아래와 같이 변경
$sArchivePath = _XE_PATH_.'files/svitem/';
$sExtScriptFilename = 'ext_script_list_page_'.$this->module_info->module_srl;
$bRst = FileHandler::exists( $sArchivePath.$sExtScriptFilename.'.html');
if( $bRst )
{
	$oTemplate = &TemplateHandler::getInstance();
	$sExtScript = $oTemplate->compile($sArchivePath, 'ext_script_list_page_'.$this->module_info->module_srl);
	Context::set('ext_script', $sExtScript );
}


./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$oTemplate = &TemplateHandler::getInstance();
$sExtScript = $oTemplate->compile($sArchivePath, 'ext_script_detail_page_'.$this->module_info->module_srl);
Context::set('ext_script', $sExtScript );

아래와 같이 변경
$sExtScriptFilename = 'ext_script_detail_page_'.$this->module_info->module_srl;
$bRst = FileHandler::exists( $sArchivePath.$sExtScriptFilename.'.html');
if( $bRst )
{
	$oTemplate = &TemplateHandler::getInstance();
	$sExtScript = $oTemplate->compile($sArchivePath, $sExtScriptFilename);
	Context::set('ext_script', $sExtScript );
}

v 2.1.15
23rd, Aug 2018
1. svshopmaster v 0.1.3의 레이아웃 표시 방법 변경에 대응
./svcrm.admin.view.php::init()에 아래의 코드 추가
if(Context::get('module') == 'svshopmaster')
{
	$sClassPath = _XE_PATH_ . 'modules/svshopmaster/svshopmaster.class.php';
	if(file_exists($sClassPath))
	{
		require_once($sClassPath);
		svshopmaster::init($this);
	}
}

v 2.1.16
27th, Aug 2018
1. svshopmaster v 0.1.3의 레이아웃 변경 후 입력칸 너비 조정
./tpl/itemlist.html에서 아래의 코드를
<td><a href="{getUrl('act','dispSvitemAdminUpdateItem','item_srl',$val->item_srl)}"><span style="margin-right:6px;"><img src="{$val->getThumbnail(30)}" /></span></a><input type="text" name="item_name[]" value="{$val->item_name}" /></td>
아래와 같이 변경
<td><a href="{getUrl('act','dispSvitemAdminUpdateItem','item_srl',$val->item_srl)}"><span style="margin-right:6px;"><img src="{$val->getThumbnail(30)}" /></span></a><input type="text" style="width:270px" name="item_name[]" value="{$val->item_name}" /></td>

v 2.1.17
05th, Oct 2018
1. 관리자 UI의 상품 목록에서 상품 등록 페이지 정보가 같이 노출되도록 수정
./queries/getAdminItemList.xml에 아래의 코드 추가
<column name="module_srl" />

./svitem.admin.model.php::_getItemList()에서 아래의 코드를
$oSvitemModel = &getModel('svitem');
foreach( $output->data as $key=>$val )
	$val->review_count = $oSvitemModel->getReviewCnt($val->item_srl);

아래와 같이 변경
$oSvitemModel = &getModel('svitem');
$oModuleModel = getModel('module');
foreach( $output->data as $key=>$val )
{
	$oModuleInfo = $oModuleModel->getModuleInfoByModuleSrl($val->module_srl);
	$val->mid = $oModuleInfo->mid;
	$val->review_count = $oSvitemModel->getReviewCnt($val->item_srl);
}

v 2.1.18
10th, Oct 2018
1. 상품 페이지와 연동되는 후기 게시판의 출력 게시물 수 설정 기능 추가
./tpl/reviewboard_mgmt.html에 아래의 코드 추가
<div class="x_control-group">
	<label class="x_control-label" for="review_board_title">{$lang->max_reviews_cnt_title}</label>
	<div class="x_controls">
		<select name="max_reviews_cnt">
			<option value="2" selected="selected"|cond="$config->max_reviews_cnt==2">2개</option>
			<option value="3" selected="selected"|cond="$config->max_reviews_cnt==3">3개</option>
			<option value="4" selected="selected"|cond="$config->max_reviews_cnt==4">4개</option>
			<option value="5" selected="selected"|cond="$config->max_reviews_cnt==5">5개</option>
		</select>
		<a href="#review_board_title_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="review_board_title_help" class="x_help-block" hidden>{$lang->about_connecting_board}</p>
	</div>
</div>

./svitem.admin.controller.php::procSvitemAdminUpdateReviewBoardMgmt()에 아래의 코드 추가
$oArgs->max_reviews_cnt = $oTempArgs->max_reviews_cnt;

./svitem.model.php::getReviews()에 아래의 코드 추가
$aReviews->max_reviews_cnt = $oConfig->max_reviews_cnt;

./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
Context::set('max_reviews_cnt', $review_list->max_reviews_cnt);

./skins/skinname/itemdetail_review.html에서 아래의 코드를 
$listi % 5==0
아래와 같이 변경
$listi % $max_reviews_cnt==0

./m.skins/skinname/itemdetail_review.html에서 아래의 코드를 
$listi % 5==0
아래와 같이 변경
$listi % $max_reviews_cnt==0

2. 상품 페이지와 연동되는 QNA 게시판의 출력 게시물 수 설정 기능 추가
<div cond="$config->connected_review_board_srl!=0" class="x_control-group">
	<label class="x_control-label" for="review_board_title">{$lang->max_qnas_cnt_title}</label>
	<div class="x_controls">
		<select name="max_qnas_cn">
			<option value="2" selected="selected"|cond="$config->max_qnas_cn==2">2개</option>
			<option value="3" selected="selected"|cond="$config->max_qnas_cn==3">3개</option>
			<option value="4" selected="selected"|cond="$config->max_qnas_cn==4">4개</option>
			<option value="5" selected="selected"|cond="$config->max_qnas_cn==5">5개</option>
		</select>
		<a href="#review_board_title_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="review_board_title_help" class="x_help-block" hidden>{$lang->about_connecting_board}</p>
	</div>
</div>

./svitem.admin.controller.php::procSvitemAdminUpdateQnaBoardMgmt()에 아래의 코드 추가
$oArgs->max_qnas_cnt = $oTempArgs->max_qnas_cnt;

./svitem.model.php::getQnas() 추가

./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
if( $config->connected_qna_board_srl > 0 )
{
	$qna_list = $oSvitemModel->getQnas($item_info);
	Context::set('qnas_per_page', $qna_list->qnas_per_page);
	Context::set('qna_list', $qna_list->data);
	Context::set('qna_board_mid', $qna_list->mid);
	Context::set('remaining_qna', $qna_list->remaining_qnas);
	Context::set('qna_category_srl', $qna_list->category_srl);
}

v 2.1.19
1st, Jan 2019
1. 후기 게시판 연동 관리자 화면에서 전체 상품이 표시되지 않는 문제 해결
./queries/getItemList.xml에서 아래의 코드를
<navigation>
	<index var="sort_index" default="item_srl" order="asc" />
	<list_count var="list_count" default="20" />
	<page_count var="page_count" default="10" />
	<page var="page" default="1" />
</navigation>

아래와 같이 변경
<navigation>
	<index var="sort_index" default="item_srl" order="desc" />
</navigation>

v 2.1.20
5th, Jan 2019
1. 상세페이지에 증정 프로모션 정보 표시
./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
Context::set('giveaway_item_name', $output['giveaway']->conditional_additional_discount_giveaway_item_name); 
Context::set('giveaway_item_price', $output['giveaway']->conditional_additional_discount_giveaway_item_price);
Context::set('giveaway_item_url', $output['giveaway']->conditional_additional_discount_giveaway_item_url);

skins/.../itemdetail_spec.html에서 아래의 코드를
<tr cond="$additional_conditional_discount_amount > 0">
아래와 같이 변경
<tr cond="$additional_conditional_discount_info_fblike">

skins/.../itemdetail_spec.html에 아래의 코드 추가
<tr cond="$giveaway_item_name">
	<th><font color='red'>증정</font></th>
	<td>
		<span><a href='{$giveaway_item_url}' target='_new'><span style='text-decoration: underline; text-decoration-color: black;'>{$giveaway_item_name}</span></a> (<span class='currency_symbol'>₩</span>{number_format($giveaway_item_price)} 상당)</span>
	</td>
</tr>

v 3.0.0
26th, Feb 2019
1. svitem.item.php 제거 준비
./svitem.view.php::_dispThumbnailUrl() 추가
./svitem.view.php::_dispExtraValue() 추가
./svitem.view.php::_dispExtraTitle() 추가

./skins/plain/itemdetail_review.html에서 아래의 코드를
svitemItem::printPrice 
아래와 같이 변경
number_format

./skins/plain/itemdetail_spec.html에서 아래의 코드를
svitemItem::printPrice 
아래와 같이 변경
number_format

./skins/plain/list.html에서 아래의 코드를
{$val->getItemName($module_info->subject_cutsize)}
아래와 같이 변경
{$val->item_name}

./skins/plain/list.html에서 아래의 코드를
{$val->printPrice()}
{$val->printDiscountedPrice()}

아래와 같이 변경
{number_format($val->price)}
{number_format($val->discounted_price)}

./skins/trendshopA_sv/itemdetail_spec.html에서 아래의 코드를
svitemItem::printPrice 
아래와 같이 변경
number_format

./skins/trendshopS_sv/itemdetail_spec.html에서 아래의 코드를
svitemItem::printPrice 
아래와 같이 변경
number_format

./skins/trendshopS_sv/itemdetail_review.html에서 아래의 코드를
svitemItem::printPrice 
아래와 같이 변경
number_format

./m.skins/trendshop/itemdetail_spec.html에서 아래의 코드를
svitemItem::printPrice 
아래와 같이 변경
number_format

./m.skins/trendshop/itemdetail_review.html에서 아래의 코드를
svitemItem::printPrice 
아래와 같이 변경
number_format

./tpl/itemlist.html에서 아래의 코드를
{$val->getThumbnail(30)}
아래와 같이 변경
{svitemView::getThumbnailUrl($val->thumb_file_srl,30)}

./svitem.model.php::_getItemInfo() 추가

./svitem.model.php::getItemByDocumentSrl()을 getItemInfoByDocumentSrl()로 변경

./svitem.controller.php::procSvitemInsertComment()에서 아래의 코드를
$item_info = $oSvitemModel->getItemByDocumentSrl($reqvars->document_srl);
아래와 같이 변경
$item_info = $oSvitemModel->getItemInfoByDocumentSrl($reqvars->document_srl);

./svitem.model.php::getItemInfoByDocumentSrl()에서 아래의 코드를
$config = $this->getModuleConfig();
$args->document_srl = $document_srl;
$output = executeQuery('svitem.getItemInfo', $args);
if (!$output->toBool()) 
	return;
$item = new svitemItem($output->data, $config->currency, $config->as_sign, $config->decimals);
return $item;

아래와 같이 변경
$oArgs->document_srl = $nDocumentSrl;
$oItem = $this_getItemInfo($oArgs);
return $oItem;

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
if($item_srl) 
	$args->item_srl = $item_srl;
else if($document_srl) 
	$args->document_srl = $document_srl;
else 
	return new Object(-1, 'Item Not Found.');

$output = executeQuery('svitem.getItemInfo', $args);
if (!$output->toBool()) 
	return $output;

$item_info = $output->data;
// thumbnail
if($item_info->thumb_file_srl) 
{
	$oFileModel = &getModel('file');
	$file = $oFileModel->getFile($item_info->thumb_file_srl);
	if($file)
		$item_info->thumbnail_url = getFullUrl().$file->download_url;
}
$item_info = new svitemItem($item_info);

아래와 같이 변경
$item_info = $oSvitemModel->getItemInfoByDocumentSrl($document_srl);

./svitem.view.php::getItemInfoByItemSrl() 추가

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$nargs->item_srl = $aFloatingBundling[$j];
$result = executeQuery('svitem.getItemInfo', $nargs);
if (!$result->toBool()) 
	return $result;

아래와 같이 변경
$result = $oSvitemModel->getItemInfoByItemSrl($aFloatingBundling[$j]);

2. code 오류 수정
./svitem.model.php::getNaverEpList()에서 아래의 코드를
$oSvcartModel = &getModel('svcart');
$oSvcartConfig = $oSvcartModel->getModuleConfig();
$nDeliveryFee = (int)$oSvcartConfig->delivery_fee;
$nFreeDeliveryAmnt = (int)$oSvcartConfig->freedeliv_amount;

아래와 같이 변경
$oSvorderModel = &getModel('svorder');
$oSvorderConfig = $oSvorderModel->getModuleConfig();
$nDeliveryFee = (int)$oSvorderConfig->delivery_fee;
$nFreeDeliveryAmnt = (int)$oSvorderConfig->freedeliv_amount;

./svitem.model.php::getDaumEpList()에서 아래의 코드를
$oSvcartModel = &getModel('svcart');
$oSvcartConfig = $oSvcartModel->getModuleConfig();
$nDeliveryFee = (int)$oSvcartConfig->delivery_fee;
$nFreeDeliveryAmnt = (int)$oSvcartConfig->freedeliv_amount;

아래와 같이 변경
$oSvorderModel = &getModel('svorder');
$oSvorderConfig = $oSvorderModel->getModuleConfig();
$nDeliveryFee = (int)$oSvorderConfig->delivery_fee;
$nFreeDeliveryAmnt = (int)$oSvorderConfig->freedeliv_amount;

./svitem.model.php::_getWidgetDefaultCatalogItems()에서 아래의 코드를 제거
$oSvpromotionModel = &getModel('svpromotion');
$retobj = $oSvpromotionModel->getItemPriceList($items);

3. 미사용 코드 제거
./svitem.model.php::getSvitemItemInfos() 제거
./svitem.model.php::getItemExtraVarValue() 제거
./svitem.model.php::getItemExtraVarList() 제거
./svitem.model.php::getItemExtraByModuleSrl() 제거
./svitem.model.php::getSvitemInputExtraVars() 제거
./svitem.model.php::getItemSrlByItemName() 제거
./svitem.model.php::getItemInfo() 제거
./svitem.admin.model.php::convertDataIntoSvitem() 제거

4. svitem.item.php 제거
./svitem.class.php에서 아래의 코드를 제거
require_once(_XE_PATH_.'modules/svitem/svitem.item.php');

./svitem.admin.view.php::dispSvitemAdminItemListByModule()에서 아래의 코드를 제거
$aItemList = $output->data;
$oSvitemAdminModel->convertDataIntoSvitem($aItemList);

./svitem.admin.view.php::dispSvitemAdminItemListExcelDownload()에서 아래의 코드를 제거
$oSvitemAdminModel->convertDataIntoSvitem($aItemList);

./svitem.model.php::getNaverEpList()에서 아래의 코드를
$discounted[$key1]->thumbnail_url = str_replace('https', 'http', $val1->getThumbnail(300,300,'crop'));

아래와 같이 변경
$oSvitemView = &getView('svitem');
$discounted[$key1]->thumbnail_url = str_replace('https', 'http', $oSvitemView->getThumbnailUrl( $val1->thumb_file_srl, 300, 300, 'crop') );

./svitem.model.php::getNaverEpList()에 아래의 코드 추가
$discounted[$key1]->thumbnail_url = str_replace('https', 'http', $val1->get
$this->_unserializeItemInfo($oVal);

./svitem.model.php::getNaverEpList()에서 아래의 코드를
foreach( $output->data as $itemkey=>$itemval)
	$output->data[$itemkey]->mid = $oSvitemModuleConfig->mid;

아래와 같이 변경
foreach( $output->data as $itemkey=>$itemval)
{
	$this->_unserializeItemInfo($itemval);
	$output->data[$itemkey]->mid = $oSvitemModuleConfig->mid;
}

5. ./svitem.model.php::getItemInfo() 제거
./svitem.controller.php::procSvitemAddItemsToFavorites()에서 아래의 코드를
$item_info = $oSvitemModel->getItemInfo($val);

아래와 같이 변경
$item_info = $oSvitemModel->getItemInfoByItemSrl($val);

./svitem.controller.php::procSvitemInsertComment()에서 아래의 코드를
$item_info = $oSvitemModel->getItemInfo($reqvars->item_srl);

아래와 같이 변경
$item_info = $oSvitemModel->getItemInfoByItemSrl($reqvars->item_srl);

./svitem.admin.controller.php::procSvitemAdminDeleteItem()에서 아래의 코드를
$item_info = $oSvitemModel->getItemInfo($item_srl);

아래와 같이 변경
$item_info = $oSvitemModel->getItemInfoByItemSrl($item_srl);

./svitem.admin.controller.php::procSvitemAdminUpdateItemList()에서 아래의 코드를
$item_info = $oSvitemModel->getItemInfoByItemSrl($item_srl);

아래와 같이 변경
$item_info = $oSvitemModel->getItemInfo($item_srl);

./svitem.admin.model.php::getSvitemAdminShowWindowItemListAjax()에서 아래의 코드를
$oItem = $oSvitemModel->getItemInfo($val->item_srl);

아래와 같이 변경
$oItem = $oSvitemModel->getItemInfoByItemSrl($val->item_srl);

./svitem.admin.model.php::getSvitemAdminDeleteItem()에서 아래의 코드를
$item_info = $oSvitemModel->getItemInfo($item_srl);

아래와 같이 변경
$item_info = $oSvitemModel->getItemInfoByItemSrl($item_srl);

./svitem.admin.view.php::dispSvitemAdminExtMallLogger()에서 아래의 코드를
$item_info = $oSvitemModel->getItemInfo($item_srl);

아래와 같이 변경
$item_info = $oSvitemModel->getItemInfoByItemSrl($item_srl);

v 3.0.1
6th, Mar 2019
1. 미사용 DB 제거
./schemas/svitem_items.sql에서 아래의 코드 제거
<column name="file_srl" type="number" size="11" default="0" notnull="notnull" />
<column name="download_count" type="number" size="11" default="0" notnull="notnull" index="idx_download_count" />

./queries/insertItem.sql에서 아래의 코드 제거
<column name="file_srl" var="file_srl" />
<column name="download_count" var="download_count" />

./queries/updateItemFile.sql에서 아래의 코드 제거
<column name="file_srl" var="file_srl" />

./queries/getShowWindowItems.sql에서 아래의 코드 제거
<column name="item.file_srl" alias="file_srl" />

./svitem.model.php::getDefaultListConfig()에서 아래의 코드를
$virtual_vars = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count', 'download_count');
아래와 같이 변경
$virtual_vars = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count' );

./svitem.model.php::getListConfig()에서 아래의 코드를
$list_config = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count', 'download_count');
아래와 같이 변경
$list_config = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count');

./svitem.model.php::getDetailListConfig()에서 아래의 코드를
$list_config = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count', 'download_count');
아래와 같이 변경
$list_config = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count');

./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 아래의 코드 제거
if($item_info->file_srl)
{
	$file = $oFileModel->getFile($item_info->file_srl);
	if($file)
		$item_info->download_file = $file;
}

./svitem.admin.controller.php::procSvitemAdminDeleteItem()에서 아래의 코드 제거
$oFileController->deleteFile($item_info->file_srl);

./svitem.admin.controller.php::procSvitemAdminInsertItem()에서 아래의 코드 제거
if(is_uploaded_file($args->contents_file['tmp_name']))
{
	$output = $oFileController->insertFile($args->contents_file, $args->module_srl, $item_srl);
	if(!$output || !$output->toBool())
		return $output;
	$args->file_srl = $output->get('file_srl');
}

./svitem.admin.controller.php::procSvitemAdminInsertItem()에서 아래의 코드를
if($args->file_srl || $args->thumb_file_srl || $args->thumb_file_1_srl)
아래와 같이 변경
if($args->thumb_file_srl || $args->thumb_file_1_srl)

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드 제거
if(Context::get('delete_file'))
{
	$delete_file_srl = Context::get('delete_file');
	$this->deleteSvitemFile($delete_file_srl, $item_srl);
}


./svitem.admin.controller.php::procSvitemAdminUpdateItemFile()을 _updateItemFile()으로 변경

./svitem.admin.controller.php::_updateItemFile()에서 아래의 코드 제거
if(is_uploaded_file($args->contents_file['tmp_name'])) 
{
	// delete contents file
	if($item_info->file_srl) 
		$oFileController->deleteFile($item_info->file_srl);
	// attach thumbnail
	$output = $oFileController->insertFile($args->contents_file, $args->module_srl, $args->item_srl);
	if(!$output || !$output->toBool())
		return $output;
	$args->file_srl = $output->get('file_srl');
}

./svitem.admin.controller.php::deleteSvitemFile() 제거

./tpl/updateitem.html에서 아래의 코드 제거
<div cond="$item_info->download_file" id="contents_file_select" class="x_control-group">
	<label class="x_control-label" for="contents_file">{$lang->contents_file}</label>
	<div class="x_controls">
		<p id="file_info"><a href="{$item_info->download_file->download_url}">{$item_info->download_file->source_filename}</a> ({FileHandler::filesize($item_info->download_file->file_size)}) <button onClick="delete_file({$item_info->file_srl})">{$lang->cmd_delete}</button></p>
		<p><a href="{getUrl('act','dispSvorder_digital_contentsAdminItemList')}">디지털 콘텐츠 관리</a>모듈에서 업로드 하세요.</p>
	</div>
</div>

./tpl/js/script.js에서 아래의 코드 제거
function delete_file(file_srl)
{
	jQuery("#file_info").html("<input type='hidden' value='" + file_srl  +"' name='delete_file' />");
}



2. 미사용 코드 제거
./svitem.admin.model.php::getSvitemAdminPlusMileage() 제거

v 3.0.2
7th, Mar 2019
1. 메소드 이름 개선
./svitem.model.php::getListConfig()을 getOutpusOnCatalogPage()로 변경

./svitem.view.php::dispSvitemItemList()에서 아래의 코드를
Context::set('list_config', $oSvitemModel->getListConfig($nModuleSrl));
아래와 같이 변경
Context::set('list_config', $oSvitemModel->getOutpusOnCatalogPage($nModuleSrl));

./svitem.admin.view.php::dispSvitemAdminListSetup()에서 아래의 코드를
if($oSvitemModel->getListConfig($this->module_info->module_srl))
	Context::set('list_config', $oSvitemModel->getListConfig($this->module_info->module_srl));

아래와 같이 변경
if($oSvitemModel->getOutpusOnCatalogPage($this->module_info->module_srl))
	Context::set('list_config', $oSvitemModel->getOutpusOnCatalogPage($this->module_info->module_srl));

./svitem.model.php::getDetailListConfig()을 getOutpusOnDetailPage()로 변경

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
Context::set('list_config', $oSvitemModel->getDetailListConfig($this->module_info->module_srl));
아래와 같이 변경
Context::set('list_config', $oSvitemModel->getOutpusOnDetailPage($this->module_info->module_srl));

./svitem.admin.view.php::dispSvitemAdminDetailListSetup()에서 아래의 코드를
if($oSvitemModel->getDetailListConfig($this->module_info->module_srl))
	Context::set('list_config', $oSvitemModel->getDetailListConfig($this->module_info->module_srl));

아래와 같이 변경
if($oSvitemModel->getOutpusOnDetailPage($this->module_info->module_srl))
	Context::set('list_config', $oSvitemModel->getOutpusOnDetailPage($this->module_info->module_srl));

v 3.0.3
16th, Mar 2019
1. 메소드 이름 개선
./tpl/detaillistsetup.html을 disp_detail_setup.html로 변경
./tpl/listsetup.html을 disp_list_setup.html로 변경

./svitem.admin.view.php::dispSvitemAdminListSetup()을 dispSvitemAdminListDisplaySetup()로 변경
./svitem.admin.view.php::dispSvitemAdminDetailListSetup()을 dispSvitemAdminDetailDisplaySetup()로 변경

./svitem.admin.controller.php::procSvitemAdminInsertDetailListConfig()을 procSvitemAdminInsertDetailDisplayConfig()로 변경
./svitem.admin.controller.php::procSvitemAdminInsertListConfig()을 procSvitemAdminInsertListDisplayConfig()로 변경

2. 코드 효율 개선
./svitem.admin.view.php::dispSvitemAdminDetailListSetup()에서 아래의 코드를
if($oSvitemModel->getDetailListConfig($this->module_info->module_srl))
	Context::set('list_config', $oSvitemModel->getDetailListConfig($this->module_info->module_srl));

아래와 같이 변경
$aRst = $oSvitemModel->getOutputsOnDetailPage($this->module_info->module_srl);
if($aRst)
	Context::set('list_config', $aRst);

./svitem.admin.view.php::dispSvitemAdminListDisplaySetup()에서 아래의 코드를
if($oSvitemModel->getOutpusOnCatalogPage($this->module_info->module_srl))
	Context::set('list_config', $oSvitemModel->getOutpusOnCatalogPage($this->module_info->module_srl));

아래와 같이 변경
$aRst = $oSvitemModel->getOutputsOnCatalogPage($this->module_info->module_srl);
if($aRst)
	Context::set('list_config', $aRst);

3. 상세 페이지 버튼 표시 기능 추가
./svitem.model.php::getOutpusOnDetailPage()를 getOutputsOnDetailPage로 변경

./svitem.admin.controller.php::_insertDetailListConfig()에 아래의 코드 추가
$oArgs = Context::getRequestVars();
$output = $this->_saveModuleConfig($oArgs);

./svitem.admin.view.php::dispSvitemAdminDetailDisplaySetup()에 아래의 코드 추가
$oConfig = $oSvitemModel->getModuleConfig(); ////////////////////
Context::set('config', $oConfig);

./tpl/disp_detail_setup.html에 아래의 코드 추가
<div class="x_control-group">
	<label class="x_control-label" for="display">{$lang->buy_button} {$lang->display_or_not}</label>
	<div class="x_controls">
		<label class="x_inline"><input type="radio" id="display_buy_btn" name="display_buy_btn" value="Y" checked="checked"|cond="$config->display_buy_btn=='' || $config->display_buy_btn=='Y'" />{$lang->display}</label>
		<label class="x_inline"><input type="radio" id="display_buy_btn" name="display_buy_btn" value="N" checked="checked"|cond="$config->display_buy_btn=='N'"/>{$lang->not_display}</label>
		<a href="#display_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="display_help" class="x_help-block" hidden>{$lang->about_display_or_not}</p>
	</div>
	<label class="x_control-label" for="display">{$lang->cart_buttons} {$lang->display_or_not}</label>
	<div class="x_controls">
		<label class="x_inline"><input type="radio" id="display_cart_btn" name="display_cart_btn" value="Y" checked="checked"|cond="$config->display_cart_btn=='' || $config->display_buy_btn=='Y'" />{$lang->display}</label>
		<label class="x_inline"><input type="radio" id="display_cart_btn" name="display_cart_btn" value="N" checked="checked"|cond="$config->display_cart_btn=='N'"/>{$lang->not_display}</label>
		<a href="#display_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="display_help" class="x_help-block" hidden>{$lang->about_display_or_not}</p>
	</div>
	<label class="x_control-label" for="display">{$lang->favorite_button} {$lang->display_or_not}</label>
	<div class="x_controls">
		<label class="x_inline"><input type="radio" id="display_favorite_btn" name="display_favorite_btn" value="Y" checked="checked"|cond="$config->display_favorite_btn=='' || $config->display_buy_btn=='Y'"/>{$lang->display}</label>
		<label class="x_inline"><input type="radio" id="display_favorite_btn" name="display_favorite_btn" value="N" checked="checked"|cond="$config->display_favorite_btn=='N'"/>{$lang->not_display}</label>
		<a href="#display_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="display_help" class="x_help-block" hidden>{$lang->about_display_or_not}</p>
	</div>
</div>
<div class="x_control-group"></div>

./svitem.model.php::getDefaultListConfig() 제거

./svitem.model.php::getDefaultDisplayConfig() 추가

./svitem.model.php:svitemModel()에 아래의 코드 추가
private $_g_aCatalogDefaultDisplay = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count' );
private $_g_aDetailDefaultDisplay = array( );

./svitem.model.php:getOutputsOnCatalogPage()에서 아래의 코드를
if(!$list_config || !count($list_config))
	$list_config = array('checkbox', 'image', 'title', 'quantity', 'amount', 'cart_buttons', 'sales_count');//, 'download_count');

아래와 같이 변경
if(!$list_config || !count($list_config))
	$list_config = $this->_g_aCatalogDefaultDisplay;

./svitem.model.php:getOutputsOnDetailPage()에서 아래의 코드를
if(!$list_config || !count($list_config))
	$list_config = array('sales_count' );//'checkbox', 'image', 'quantity', 'title', 'amount', 'download_count');

아래와 같이 변경
if(!$list_config || !count($list_config))
	$list_config = $this->_g_aDetailDefaultDisplay;	

v 3.0.4
19th, Mar 2019
1. 가상 쇼핑몰 페이지 기능 강화 - 상세페이지 표시 항목 설정을 MID 레벨로 분리함
./svitem.admin.view.php::dispSvitemAdminDetailDisplaySetup()에서 아래의 코드를
$oConfig = $oSvitemModel->getModuleConfig();

아래와 같이 변경
$oConfig = $oSvitemModel->getMidLevelConfig($this->module_info->module_srl);

./svitem.admin.view.php::_insertDetailListConfig()에서 아래의 코드를
$oArgs = Context::getRequestVars();
$output = $this->_saveModuleConfig($oArgs);

$module_srl = Context::get('module_srl');
$list = explode(',',Context::get('list'));
if(!count($list))
	return new Object(-1, 'msg_invalid_request');

$list_arr = array();
foreach($list as $val)
{
	$val = trim($val);
	if(!$val)
		continue;
	if(substr($val,0,10)=='extra_vars')
		$val = substr($val,10);
	$list_arr[] = $val;
}
$oModuleController = &getController('module');
$output = $oModuleController->insertModulePartConfig('svitem.detail', $module_srl, $list_arr);
if(!$output->toBool())
	return $output;

아래와 같이 변경
$aListFromQuery = explode(',',Context::get('list'));
if(!count($aListFromQuery ))
	return new Object(-1, 'msg_invalid_request');
$aList = array();
foreach($aListFromQuery as $val)
{
	$val = trim($val);
	if(!$val)
		continue;
	if(substr($val,0,10)=='extra_vars')
		$val = substr($val,10);
	$aList[] = $val;
}
$oModuleController = &getController('module');
$nModuleSrl = Context::get('module_srl');
$output = $oModuleController->insertModulePartConfig('svitem.detail', $nModuleSrl, $aList);
if(!$output->toBool())
	return $output;

$oArgs = Context::getRequestVars();		
if($oArgs->module_srl) 
	return $this->_updateMidLevelConfig($oArgs);
else
	return new Object(-1, 'msg_invalid_module_srl');

./svitem.model.php:getMidLevelConfig() 추가

./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
$oMidConfig = $oSvitemModel->getMidLevelConfig( $this->module_info->module_srl);
unset( $oMidConfig->module_srl );
unset( $oMidConfig->module );
unset( $oMidConfig->module_category_srl );
unset( $oMidConfig->use_mobile );
unset( $oMidConfig->mlayout_srl );
unset( $oMidConfig->site_srl );
unset( $oMidConfig->mid );
unset( $oMidConfig->is_skin_fix );
unset( $oMidConfig->skin );
unset( $oMidConfig->is_mskin_fix );
unset( $oMidConfig->mskin );
unset( $oMidConfig->browser_title );
unset( $oMidConfig->description );
unset( $oMidConfig->is_default );
unset( $oMidConfig->content );
unset( $oMidConfig->mcontent );
unset( $oMidConfig->open_rss );
unset( $oMidConfig->header_text );
unset( $oMidConfig->footer_text );
unset( $oMidConfig->regdate );
unset( $oMidConfig->category_display );
unset( $oMidConfig->delivery_info );
unset( $oMidConfig->layout_srl );
unset( $oMidConfig->menu_srl );
unset( $oMidConfig->primary_key );
unset( $oMidConfig->svcart_mid );
Context::set('mid_config',$oMidConfig);

2. 상세 페이지의 아이템코드 표시 선택 기능 추가
./tpl/disp_detail_setup.html에 아래의 코드 추가
<label class="x_control-label" for="display">{$lang->item_code} {$lang->display_or_not}</label>
<div class="x_controls">
	<label class="x_inline"><input type="radio" id="display_buy_btn" name="display_itemcode" value="Y" checked="checked"|cond="$config->display_itemcode=='' || $config->display_itemcode=='Y'" />{$lang->display}</label>
	<label class="x_inline"><input type="radio" id="display_buy_btn" name="display_itemcode" value="N" checked="checked"|cond="$config->display_itemcode=='N'"/>{$lang->not_display}</label>
	<a href="#display_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
	<p id="display_help" class="x_help-block" hidden>{$lang->about_display_or_not}</p>
</div>

./skins/.../itemdetail_spec.html에서 아래의 코드를
<tr>
	<th>{$lang->item_code}</th>
	<td>{$item_info->item_code}</td>
</tr>

아래와 같이 변경
<tr cond="$mid_config->display_itemcode!='N'">
	<th>{$lang->item_code}</th>
	<td>{$item_info->item_code}</td>
</tr>

./skins/.../itemdetail_spec.html에서 아래의 코드를
<a cond="$config->display_buy_btn!='N'" class="btn-buynow" href="#" onclick="orderItemsInDetailPage(); return false;">BUY NOW</a>
<a cond="$config->display_cart_btn!='N'" class="btn-addcart" href="#" onclick="addItemsToCartInDetailPage(); return false;">ADD CART</a>
<a cond="$config->display_favorite_btn!='N'" class="btn-wishlist" href="#" onclick="addItemsToFavorites(); return false;">WISH LIST</a>

아래와 같이 변경
<a cond="$mid_config->display_buy_btn!='N'" class="btn-buynow" href="#" onclick="orderItemsInDetailPage(); return false;">BUY NOW</a>
<a cond="$mid_config->display_cart_btn!='N'" class="btn-addcart" href="#" onclick="addItemsToCartInDetailPage(); return false;">ADD CART</a>
<a cond="$mid_config->display_favorite_btn!='N'" class="btn-wishlist" href="#" onclick="addItemsToFavorites(); return false;">WISH LIST</a>

v 3.0.5
20th, Mar 2019
1. ./svitem.view.php::dispSvitemReplyComment() 제거
./svitem.view.php::dispSvitemReplyComment() 제거
./svitem.controller.php::procSvitemInsertComment() 제거
./svitem.controller.php::procSvitemDeleteComment() 제거

./skins/.../itemdetail_qna.html에서 아래의 코드를
<!--@else-->
	<div class="no-comment newclearfix">{$lang->msg_no_questions}. <a cond="$is_logged" href="#" id="qna-write">{$lang->qna_write}</a></div>
<!--@endif-->

아래와 같이 변경
<!--@else-->
	<div class="no-comment newclearfix">{$lang->msg_no_questions}. <a href="/{$qna_board_mid}" id="qna-write">{$lang->qna_write}</a></div>
<!--@endif-->

2. 제품 상세 페이지 QNA 섹션 기능 개선
./svitem.model.php::getQnas()에서 아래의 코드를
if(!count($aQnas->data))
	return null;
$aQnas->mid = $oQnaBoardConfig->mid;
$aQnas->qnas_per_page = $oConfig->qnas_per_page ? $oConfig->qnas_per_page : 2;
$aQnas->remaining_qnas = $nCurrentQna - $nLoadQnaCount;
$aQnas->category_srl = $args->category_srl;

아래와 같이 변경
if(count($aQnas->data))
{
	$aQnas->qnas_per_page = $oConfig->qnas_per_page ? $oConfig->qnas_per_page : 2;
	$aQnas->remaining_qnas = $nCurrentQna - $nLoadQnaCount;
	$aQnas->category_srl = $args->category_srl;
}

v 3.1.0
28th, Mar 2019
1. 변수 효율 개선
./svitem.view.php::svitemView()에 아래의 코드 추가
private $_g_sArchivePath = '';

./svitem.view.php::init()에 아래의 코드 추가
$this->_g_sArchivePath = _XE_PATH_.'files/svitem/';

./svitem.view.php::dispSvitemItemList()에서 아래의 코드를
$sArchivePath = _XE_PATH_.'files/svitem/';
$sExtScriptFilename = 'ext_script_list_page_'.$this->module_info->module_srl;
$bRst = FileHandler::exists( $sArchivePath.$sExtScriptFilename.'.html');
if( $bRst )
{
	$oTemplate = &TemplateHandler::getInstance();
	$sExtScript = $oTemplate->compile($sArchivePath, 'ext_script_list_page_'.$this->module_info->module_srl);
	Context::set('ext_script', $sExtScript );
}

아래와 같이 변경
$sExtScriptFilename = 'ext_script_list_page_'.$this->module_info->module_srl;
$bRst = FileHandler::exists( $this->_g_sArchivePath.$sExtScriptFilename.'.html');
if( $bRst )
{
	$oTemplate = &TemplateHandler::getInstance();
	$sExtScript = $oTemplate->compile($this->_g_sArchivePath, 'ext_script_list_page_'.$this->module_info->module_srl);
	Context::set('ext_script', $sExtScript );
}

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를 제거
$sArchivePath = _XE_PATH_.'files/svitem/';

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
if( strlen( $oHiddenExtraVars->description_skin_pc->value ) > 0 )
	Context::set('description_skin_pc_selected', $sArchivePath.$oHiddenExtraVars->description_skin_pc->value);

if( strlen( $oHiddenExtraVars->description_skin_mob->value ) > 0 )
	Context::set('description_skin_mob_selected', $sArchivePath.$oHiddenExtraVars->description_skin_mob->value);

아래와 같이 변경
if( strlen( $oHiddenExtraVars->description_skin_pc->value ) > 0 )
	Context::set('description_skin_pc_selected', $this->_g_sArchivePath.$oHiddenExtraVars->description_skin_pc->value);

if( strlen( $oHiddenExtraVars->description_skin_mob->value ) > 0 )
	Context::set('description_skin_mob_selected', $this->_g_sArchivePath.$oHiddenExtraVars->description_skin_mob->value);

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$bRst = FileHandler::exists( $sArchivePath.$sExtScriptFilename.'.html');
if( $bRst )
{
	$oTemplate = &TemplateHandler::getInstance();
	$sExtScript = $oTemplate->compile($sArchivePath, $sExtScriptFilename);
	Context::set('ext_script', $sExtScript );
}

아래와 같이 변경
$bRst = FileHandler::exists( $this->_g_sArchivePath.$sExtScriptFilename.'.html');
if( $bRst )
{
	$oTemplate = &TemplateHandler::getInstance();
	$sExtScript = $oTemplate->compile($this->_g_sArchivePath, $sExtScriptFilename);
	Context::set('ext_script', $sExtScript );
}

2. 코드 효율 개선
./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$oArgs = Context::getRequestVars();
if($oArgs->module_srl)

아래와 같이 변경
if($nModuleSrl)
{
	$oArgs = Context::getRequestVars();

./tpl/skin.js/itemdetail.js:_addItemsToCartObj()에서 아래의 코드 제거
recent_item_reload = jQuery("#c_recent_item").val();	
if(recent_item_reload == 'true')
	r_load_cart('cart');

3. 네이버페이 플러그인 적용
./skins/~~~/itemdetail.html에 아래의 코드 추가
var g_nItemSrl = '{$item_info->item_srl}';
{$npay_script_handler_global}

./skins/~~~/itemdetail_spec.html에서 아래의 코드를
<a cond="$config->display_buy_btn!='N'" class="btn-buynow" href="#" onclick="orderItemsInDetailPage({$item_info->item_srl}); return false;">BUY NOW</a>
<a cond="$config->display_cart_btn!='N'" class="btn-addcart" href="#" onclick="addItemsToCartInDetailPage({$item_info->item_srl}); return false;">ADD CART</a>
<a cond="$config->display_favorite_btn!='N'" class="btn-wishlist" href="#" onclick="addItemsToFavorites({$item_info->item_srl}); return false;">WISH LIST</a>

아래와 같이 변경
<a cond="$mid_config->display_buy_btn!='N'" class="btn-buynow" href="#" onclick="orderItemsInDetailPage(); return false;">BUY NOW</a>
<a cond="$mid_config->display_cart_btn!='N'" class="btn-addcart" href="#" onclick="addItemsToCartInDetailPage(); return false;">ADD CART</a>
<a cond="$mid_config->display_favorite_btn!='N'" class="btn-wishlist" href="#" onclick="addItemsToFavorites(); return false;">WISH LIST</a>

./tpl/skin.js/itemdetail.js::applyFbSharePromotion()에서 item_srl 인수를 전역변수 참조로 변경
./tpl/skin.js/itemdetail.js::applyFbLikePromotion()에서 item_srl 인수를 전역변수 참조로 변경
./tpl/skin.js/itemdetail.js::addItemsToCartInDetailPage()에서 item_srl 인수를 전역변수 참조로 변경
./tpl/skin.js/itemdetail.js::orderItemsInDetailPage()에서 item_srl 인수를 전역변수 참조로 변경
./tpl/skin.js/itemdetail.js::_getCartParamsInDetailPage()에서 item_srl 인수를 전역변수 참조로 변경

./skins/~~~/itemdetail_spec.html에 아래의 코드 추가
{$npay_script_handler_button}

./tpl/skin.js/itemdetail.js::onClickNaverpayBuy() 추가

./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
$aNpayScript = $oSvitemModel->getNpayScriptBySvcartMid($oMidConfig->svcart_mid);
Context::set('npay_script_handler_global', $aNpayScript['global'] );
Context::set('npay_script_handler_button', $aNpayScript['btn'] );

./svitem.controller.php::getNpayScriptBySvcartMid() 추가

v 3.1.1
30th, Mar 2019
1. 모든 등록 아이템의 카테고리 정보 추출 기능 추가
./svitem.admin.model.php::getAllItemCategoryInfo() 추가

v 3.1.2
4th, Apr 2019
1. Npay 연동용 XML 추출 기능 추가
./svitem.view.php::dispSvitemNpayXml() 추가
./svitem.model.php::getNpayEpListXml() 추가
./svitem.model.php::_constructCategoryInfoByItemSrl() 추가

2. 미사용 코드 제거
./svitem.model.php::getItemListByItemSrls() 제거

v 3.1.3
9th, Apr 2019
1. 관리자 화면에서 mid 별 설정 변경 저장하면 상세 페이지 설정 초기화 되는 현상 해결
./svitem.admin.controller.php::procSvitemAdminInsertModInst()에서 아래의 코드 제거
if($args->module_srl) 
{
	$module_info = $oModuleModel->getModuleInfoByModuleSrl($args->module_srl);
	if($module_info->module_srl != $args->module_srl)
		unset($args->module_srl);
}

./svitem.admin.controller.php::procSvitemAdminInsertModInst()에서 아래의 코드를
$output = $oModuleController->updateModule($args);

아래와 같이 변경
$output = $this->_updateMidLevelConfig($args);

2. 모바일 상세페이지에서 제품 소개 이미지 표시안되는 문제 해결
./svitem.view.php::svitemView()에서 아래의 코드를
private $_g_sArchivePath = '';

아래와 같이 변경
protected $_g_sArchivePath = '';

./svitem.mobile.php::init()에 아래의 코드 추가
$this->_g_sArchivePath = _XE_PATH_.'files/svitem/';

v 3.1.4
12th, Apr 2019
1. svcart v0.5.12에 대응하여 네이버페이 버튼이 제품 상세페이지에서만 찜버튼 표시하도록 변경
./svitem.model.php::getNpayScriptBySvcartMid()에서 아래의 코드를
return $oSvcartModel->getNpayScriptBySvcartMid( $sSvcartMid);

아래와 같이 변경
return $oSvcartModel->getNpayScriptBySvcartMid( $sSvcartMid, 'svitem');

2. npay 검수팀 요청에 따라 관심상품 기능 추가
./tpl/skin.js/handler_item.js 추가

./tpl/skin.js/handler_item.js::addItemsToFavoritesInCatalogPage() 추가
./tpl/skin.js/handler_item.js::_makeItemList() 추가
./tpl/skin.js/handler_item.js::addItemsToFavoritesInDetailPage() 추가

./svitem.controller.php::procSvitemAddItemsToFavorites()에서 아래의 코드를\ 제거
$args->discount_amount = $output->discount_amount;
$args->discount_info = $output->discount_info;
$args->discounted_price = $output->discounted_price;

./skins/.../itemlist.html에서 아래의 코드를
<load target="../../tpl/skin.js/script.js" />

아래와 같이 변경
<load target="../../tpl/skin.js/handler_item.js" />

./skins/.../list.html에서 아래의 코드 제거
<a href="#" class="btn" onclick="addItemsToCart({$val->item_srl}); return false;">{$lang->cmd_cart}</a>

./skins/.../itemdetail.html에서 아래의 코드를
<load target="../../tpl/skin.js/itemdetail.js" />

아래와 같이 변경
<load target="../../tpl/skin.js/handler_item.js" />

./skins/.../itemdetail_spec.html에서 아래의 코드를
<a cond="$mid_config->display_favorite_btn!='N'" href="#" onclick="addItemsToFavorites(); return false;"><img src="img/wish_list.png" style="width:96px; height:96px" /></a>

아래와 같이 변경
<a cond="$mid_config->display_favorite_btn!='N'" href="#" onclick="addItemsToFavoritesInDetailPage(); return false;"><img src="img/wish_list.png" style="width:96px; height:96px" /></a>

./m.skins/.../itemlist.html에서 아래의 코드를
<load target="../../tpl/skin.js/handler_item.js" />

아래와 같이 변경
<load target="../../tpl/skin.js/handler_item.js" />

./m.skins/.../itemdetail.html에서 아래의 코드를
<load target="../../tpl/skin.js/itemdetail.js" />

아래와 같이 변경
<load target="../../tpl/skin.js/handler_item.js" />

./m.skins/.../list.html에서 아래의 코드 제거
<a href="#" class="btn" onclick="addItemsToCart({$val->item_srl}); return false;">{$lang->cmd_cart}</a>

./m.skins/.../itemdetail_spec.html에서 아래의 코드를
<a cond="$mid_config->display_favorite_btn!='N'" href="#" onclick="addItemsToFavorites(); return false;"><img src="img/wish_list.png" style="width:96px; height:96px" /></a>

아래와 같이 변경
<a cond="$mid_config->display_favorite_btn!='N'" href="#" onclick="addItemsToFavoritesInDetailPage(); return false;"><img src="img/wish_list.png" style="width:96px; height:96px" /></a>

v 3.1.5
17th, Apr 2019
1. 외부몰 구매 링크 레이어팝업 관리 기능 개선
./svitem.admin.view.php::dispSvitemAdminExtMallLogger()에 아래의 코드 추가
Context::set('item_name', $item_info->item_name);

./tpl/extmall_logger.html에 아래의 코드 추가
<h1>{$item_name}</h1>

v 3.1.6
23rd, Apr 2019
1. svpromotion v 0.4.22에 대응하여 제품 상세 페이지 표시위해서 쿠폰 프로모션을 conditional promotion 정보에 추가
./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
if( $val->conditional_additional_discount_type == 'coupon' )
	$aCouponPromotion[] = $output['conditional']->promotion[$key];

./skins/.../itemdetail_spec.html에서 아래의 코드를
<tr cond="$additional_conditional_discount_info_fblike">

아래와 같이 변경
<tr cond="$additional_conditional_discount_amount">

./skins/.../itemdetail_spec.html에서 아래의 코드 추가
<block loop="$additional_conditional_discount_info_coupon=>$coupon_key,$coupon_val">
	<span>{$coupon_val->conditional_additional_discount_info}<BR></span>
</block>
<span cond="$additional_conditional_discount_info_coupon && $additional_conditional_discount_info_fblike"><font color='red'>중복적용 불가</font></span>

v 3.1.7
3rd, May 2019
1. 잘못된 document_srl로 상세페이지 접근 시 경고 메세지 출력
./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
if( !$item_info )
	return new Object(-1, 'msg_invalid_item');

2. 네이버 EP 정보에 이벤트 정보 추가
./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$sNEpEventWords = strip_tags( Context::get('naver_ep_event_words') );
$oEnhancedItemInfo->naver_ep_event_words = $sNEpEventWords;

./tpl/naver_ep.html에 아래의 코드 추가
event_words
{$val->enhanced_item_info->naver_ep_event_words}

./tpl/updateitem.html에 아래의 코드 추가
<div class="x_control-group">
	<div class="x_control-label" for="">EP 연동 이벤트 정보</div>
	<div class="x_controls">
		<input name="naver_ep_event_words" type="text" value="{$item_info->enhanced_item_info->naver_ep_event_words}" />
		<a href="#naver_ep_event_words_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="naver_ep_event_words_help" class="x_help-block" hidden>{$lang->about_naver_ep_event_words}</p>
	</div>
</div>

v 3.1.8
5th, May 2019
1. 네이버쇼핑 EP 전송 데이터에 SV 캠페인 코드 지정하도록 수정
./tpl/updateitem.html에 아래의 코드 추가
<div class="x_control-group">
	<div class="x_control-label" for="">EP 연동 SV 캠페인 코드 2단계</div>
	<div class="x_controls">
		<input name="naver_ep_sv_campaign2" type="text" value="{$item_info->enhanced_item_info->naver_ep_sv_campaign2}" />
		<a href="#naver_ep_sv_campaign2_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="naver_ep_sv_campaign2_help" class="x_help-block" hidden>{$lang->about_naver_ep_sv_campaign2}</p>
	</div>
</div>
<div class="x_control-group">
	<div class="x_control-label" for="">EP 연동 SV 캠페인 코드 3단계</div>
	<div class="x_controls">
		<input name="naver_ep_sv_campaign3" type="text" value="{$item_info->enhanced_item_info->naver_ep_sv_campaign3}" />
		<a href="#naver_ep_sv_campaign3_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="naver_ep_sv_campaign3_help" class="x_help-block" hidden>{$lang->about_naver_ep_sv_campaign3}</p>
	</div>
</div>

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$sNEpSvCampaign2nd = trim( strip_tags( strtoupper( Context::get('naver_ep_sv_campaign2') ) ) );
if( strlen( $sNEpSvCampaign2nd ) )
{
	if(!ctype_alnum($sNEpSvCampaign2nd)) 
		return new Object(-1, 'msg_invalid_naverep_sv_campaign_code');
}
$sNEpSvCampaign3rd = trim( strip_tags( strtoupper( Context::get('naver_ep_sv_campaign3') ) ) );
if( strlen( $sNEpSvCampaign3rd ) )
{
	if(!ctype_alnum($sNEpSvCampaign3rd)) 
		return new Object(-1, 'msg_invalid_naverep_sv_campaign_code');
}

$oEnhancedItemInfo->naver_ep_sv_campaign2 = $sNEpSvCampaign2nd;
$oEnhancedItemInfo->naver_ep_sv_campaign3 = $sNEpSvCampaign3rd;

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드를
$discounted[$key1]->link = $sServerName.$sMid.'/'.$val1->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOP_00_00&utm_term=NVSHOP_'.$val1->document_srl;

아래와 같이 변경
$sSvCampaignCode2nd = $val1->enhanced_item_info->naver_ep_sv_campaign2 ? $val1->enhanced_item_info->naver_ep_sv_campaign2: '00';
$sSvCampaignCode3rd = $val1->enhanced_item_info->naver_ep_sv_campaign3 ? $val1->enhanced_item_info->naver_ep_sv_campaign3: '00';
$discounted[$key1]->link = $sServerName.$sMid.'/'.$val1->document_srl.'?utm_source=naver&utm_medium=cpc&utm_campaign=NV_PS_CPC_NVSHOP_'.$sSvCampaignCode2nd.'_'.$sSvCampaignCode3rd.'&utm_term=NVSHOP_'.$val1->document_srl;

v 3.1.9
15th, May 2019
1. 상품 영구 삭제와 논리적 삭제 기능을 분리함
./svitem.admin.controller.php::procSvitemAdminDeleteItem()을 procSvitemAdminPermanentDeleteItem()으로 변경

./svitem.admin.controller.php::procSvitemAdminDeleteItem() 추가
./queries/updateAdminItemDeactivated.xml 추가

v 3.1.10
16th, May 2019
1. Naver 쇼핑 EP 리스트 출력 목록 변경
./svitem.model.php::getNaverEpList()에서 아래의 코드 제거
$args->display='Y';

v 3.1.11
1st, Jun 2019
1. svshopmaster v 1.0.13에 대응
./svitem.admin.view.php::init()에서 아래의 코드 제거
if(Context::get('module')=='svshopmaster')
{
	$this->setLayoutPath('');
	$this->setLayoutFile('common_layout');
}

v 3.1.12
20th, Jun 2019
1. 연결된 svcart 정보에 module_srl 정보를 자동 추가
./svitem.admin.controller.php::procSvitemAdminInsertModInst()에 아래의 코드 추가
$oSvcartMidConfig = $oModuleModel->getModuleInfoByMid($args->svcart_mid);
$args->connected_svcart_module_srl_hidden = $oSvcartMidConfig->module_srl;

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$aNpayScript = $oSvitemModel->getNpayScriptBySvcartMid($oMidConfig->svcart_mid, $item_info->item_srl);
Context::set('npay_script_handler_global', $aNpayScript['global'] );
Context::set('npay_script_handler_button', $aNpayScript['btn'] );

아래와 같이 변경
$oRst = $oSvitemModel->getNpayScriptBySvcartMid($oMidConfig->connected_svcart_module_srl_hidden, $item_info->item_srl);
if (!$oRst->toBool())
	return $oRst;
$aNpayScript = $oRst->get('aNpayScript');

v 3.1.13
9th, Jul 2019
1. naver ep에서 품목 정상가와 무조건 할인가가 분리되어 표시되도록 수정
./tpl/naver_ep.html에서 아래의 코드를 
{$val->price}	{$val->price}	{$val->price}

아래와 같이 변경
{$val->discounted_price}	{$val->discounted_price}	{$val->price}

v 3.1.14
27th, Aug 2019
1. 상품 관리자 화면에서 현재고 수치 확인하도록 개선
./tpl/itemlist.html에서 아래의 코드를 추가
<th>{$lang->item_current_stock}</th>
<td>{number_format($val->current_stock)}</td>

./schemas/getAdminItemList.xml에 아래의 코드 추가
<column name="current_stock" />

v 3.1.15
18th, Sep 2019
1. 삭제한 상품은 상세페이지도 표시되지 않도록 개선
./svitem.model.php::_getItemInfo()에 아래의 코드 추가
if( !$oItemInfo->data->module_srl )
	return null;

v 3.1.16
7th, Oct 2019
1. 아래의 네이버페이 검수팀 요청 반영
- 상품상세  페이지 > 네이버페이 구매 > 주문상품수정 > 상품상세 페이지로 이동 되어야 합니다. 
- 장바구니  페이지 > 네이버페이 구매 > 주문상품수정 > 장바구니 페이지로 이동 되어야 합니다.
./tpl/skin.js/handler_item.js::_addItemsToCartObjAndTransferToNpay()에서 아래의 코드를
location.href = current_url.setQuery('mid', g_sSvcartMid).setQuery('act','dispSvcartNpayBuy').setQuery('cartnos',sCartSrl);

아래와 같이 변경
location.href = current_url.setQuery('mid', g_sSvcartMid).setQuery('act','dispSvcartNpayBuy').setQuery('cartnos',sCartSrl).setQuery('shop_mid',g_sSvitemMid).setQuery('item_srl',g_nDocumentSrl);

./skins/~/itemdetail.html에 아래의 코드 추가
var g_sSvitemMid = '{$module_info->mid}';
var g_nDocumentSrl = '{$item_info->document_srl}';

./m.skins/~/itemdetail.html에 아래의 코드 추가
var g_sSvitemMid = '{$module_info->mid}';
var g_nDocumentSrl = '{$item_info->document_srl}';

v 3.1.17
25th, Oct 2019
1. 품절인 상품에는 네이버페이 버튼 비활성화; svcart v 1.0.10과 연계
./svitem.model.php::getNpayScriptBySvcartMid()에서 아래의 코드를
$oSvcartModel = &getModel('svcart');
return $oSvcartModel->getNpayScriptBySvcartMid( $sSvcartMid, 'svitem', $nItemSrl );

아래와 같이 변경
$nAvailableStock = $this->getItemStock( $nItemSrl);
$oSvcartModel = &getModel('svcart');
return $oSvcartModel->getNpayScriptBySvcartMid( $sSvcartMid, 'svitem', $nItemSrl, $nAvailableStock );

v 3.1.18
24th, Dec 2019
1. 임시저장한 문서는 상세페이지의 후기와 질문 섹션에 표시하지 않도록 개선
./svitem.model.php::getQnas()에 아래의 코드 추가
if( $revval->variables['status'] == 'TEMP' ) // 임시저장 후기를 숨김
	continue;

./svitem.model.php::getReviews()에 아래의 코드 추가
if( $revval->variables['status'] == 'TEMP' ) // 임시저장 후기를 숨김
	continue;

v 3.1.19
6th, Feb 2020
1. mileage 관련 코드 모두 제거
./tpl/index.html에서 아래의 코드 제거
<include target="dashboard" cond="$inc=='dashboard'" />
<include target="mailsetuplist" cond="$inc=='mailsetuplist'" />
<include target="mailsetup" cond="$inc=='mailsetup'" />
<include target="smssetup" cond="$inc=='smssetup'" />
<include target="statdaily" cond="$inc=='statdaily'" />
<include target="statmonthly" cond="$inc=='statmonthly'" />
<include target="taxinvoice" cond="$inc=='taxinvoice'" />
<include target="mileagelist" cond="$inc=='mileagelist'" />
<include target="mileagehistory" cond="$inc=='mileagehistory'" />

v 3.1.20
24th, Feb 2020
1. 개별 상품에 표시할 뱃지 아이콘을 사용자 지정 변수에 기본 변수로 이동

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$aBadgeIcon = Context::get('badge_icon' );
$aBadgeIconToSave = [];
foreach( $aBadgeIcon as $nIdx=>$sVal)
	$aBadgeIconToSave[$sVal] = 1;
$oEnhancedItemInfo->default_badge_icon = $aBadgeIconToSave;

./svitem.model.php::extractItemListForListPage()에서 아래의 코드를
foreach( $output->data as $nIdx => $oVal )
	$this->_unserializeItemInfo($oVal);
$oSvpromotionModel = &getModel('svpromotion');
	$output->data = $oSvpromotionModel->getItemPriceList($output->data);

아래와 같이 변경
$oSvpromotionModel = &getModel('svpromotion');
$output->data = $oSvpromotionModel->getItemPriceList($output->data);
foreach( $output->data as $nIdx => $oVal )
{
	$this->_unserializeItemInfo($oVal);
	$dtReg = new DateTime($oVal->regdate); // new badge 표시 여부 시작 
	$dtToday = new DateTime(date('Ymdhis'));
	$dtElapsedDays = date_diff($dtReg, $dtToday);
	if( $dtElapsedDays->days < 30 )
		$oVal->enhanced_item_info->default_badge_icon['new']=1; // new badge 표시 여부 끝

	if( $oVal->discount_amount )
		$oVal->enhanced_item_info->default_badge_icon['sale']=1; // sale badge 표시 여부 끝
}

./tpl/updateitem.html에 아래의 코드 추가
<div class="x_control-group">
	<label class="x_control-label">표시할 뱃지 아이콘</label>
	<div class="x_controls">
		<ul>
			<li><label for="badge-best"><input type="checkbox" name="badge_icon[]" id="badge-best" value="best" checked="checked"|cond="$item_info->enhanced_item_info->default_badge_icon['best']==1"/>best</label></li>
			<li><label for="badge-hot"><input type="checkbox" name="badge_icon[]" id="badge-hot" value="hot" checked="checked"|cond="$item_info->enhanced_item_info->default_badge_icon['hot']==1"/>hot</label></li>
		</ul>
		<a href="#badge_help" class="x_icon-question-sign" data-toggle>도움말</a>
		<p id="badge_help" class="x_help-block" hidden></p>
	</div>
</div>

./skins/~/list.html에 아래의 코드 추가
<div class="item-badge newclearfix">
	<ul>
		<li cond="$val->enhanced_item_info->default_badge_icon['best']==1"><img src="/modules/svitem/skins/plain/img/best.gif" /></li>
		<li cond="$val->enhanced_item_info->default_badge_icon['hot']==1"><img src="/modules/svitem/skins/plain/img/hot.gif" /></li>
		<li cond="$val->enhanced_item_info->default_badge_icon['new']==1"><img src="/modules/svitem/skins/plain/img/new.gif" /></li>
		<li cond="$val->enhanced_item_info->default_badge_icon['sale']==1"><img src="/modules/svitem/skins/plain/img/sale.gif" /></li>
	</ul>
</div>

./m.skins/~/list_grid.html에 아래의 코드 추가
<div class="item-badge">
		<ul>
			<li cond="$val->enhanced_item_info->default_badge_icon['best']==1"><img src="./img/best.png" /></li>
			<li cond="$val->enhanced_item_info->default_badge_icon['hot']==1"><img src="./img/hot.png" /></li>
			<li cond="$val->enhanced_item_info->default_badge_icon['new']==1"><img src="./img/new.png" /></li>
			<li cond="$val->enhanced_item_info->default_badge_icon['sale']==1"><img src="./img/sale.png" /></li>
		</ul>
	</div>
</li>

./m.skins/~/list_list.html에 아래의 코드 추가
<div class="item-badge">
		<ul>
			<li cond="$val->enhanced_item_info->default_badge_icon['best']==1"><img src="./img/best.png" /></li>
			<li cond="$val->enhanced_item_info->default_badge_icon['hot']==1"><img src="./img/hot.png" /></li>
			<li cond="$val->enhanced_item_info->default_badge_icon['new']==1"><img src="./img/new.png" /></li>
			<li cond="$val->enhanced_item_info->default_badge_icon['sale']==1"><img src="./img/sale.png" /></li>
		</ul>
	</div>
</li>

2. 잘못된 함수명 수정
./svitem.admin.controller.php::_createInsertItemRuleset()를 createInsertItemRuleset()로 변경

v 3.1.21
18th, Apr 2020
1. 상품 상세페이지 관리자 UI 개선
./schemas/svitem_items.xml에 아래의 코드 추가
<column name="pc_doc_srl" type="number" size="11" default="0" notnull="notnull" />
<column name="gallery_doc_srl" type="number" size="11" default="0" notnull="notnull" />
<column name="pc_description" type="text" />
<column name="mob_description" type="text" />

./svitem.admin.controller.php::_insertItem()에 아래의 코드 추가
$args->mob_doc_srl = getNextSequence();
$args->pc_doc_srl = getNextSequence();
$args->gallery_doc_srl = getNextSequence();

./queries/insertItem.xml에 아래의 코드 추가
<column name="mob_doc_srl" var="mob_doc_srl" notnull="notnull" />
<column name="pc_doc_srl" var="pc_doc_srl" notnull="notnull" />
<column name="gallery_doc_srl" var="gallery_doc_srl" notnull="notnull" />

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$sUaType = Context::get('ua_type');
if( $sUaType == 'mob' )
{
	$doc_args->document_srl = Context::get('mob_doc_srl');
	$doc_args->module_srl = $module_srl;
	$doc_args->content = $description;
	$doc_args->title = $item_name;
	$doc_args->list_order = $doc_args->document_srl*-1;
	$doc_args->tags = Context::get('tag');
	$doc_args->allow_comment = 'Y';
	$oDocumentModel = &getModel('document');
	$oDocumentController = &getController('document');
	$output = $oDocumentController->updateDocument($oDocumentModel->getDocument($doc_args->document_srl), $doc_args);
	if (!$output->toBool())
		return $output;
}
elseif( $sUaType == 'pc' )
	$args->pc_description = $description;

$nGalleryDocSrl = Context::get('gallery_doc_srl');
$oFileController = getController('file');
$oFileController->setFilesValid($nGalleryDocSrl);

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에서 아래의 코드를
$oModuleModel = &getModel('module');
$oConfig = $oModuleModel->getModuleConfig('svitem');
Context::set('naver_ep_use', $oConfig->naver_ep_use);
Context::set('daum_ep_use', $oConfig->daum_ep_use);

$oFileModel = &getModel('file');
$oEditorModel = &getModel('editor');
$oDocumentModel = &getModel('document');
$oSvitemModel = &getModel('svitem');
$item_srl = Context::get('item_srl');
$item_info = $oSvitemModel->getItemInfoByItemSrl($item_srl);

$config = $oSvitemModel->getModuleConfig();
Context::set('config',$config);
if($item_info->thumb_file_srl)
{
	$file = $oFileModel->getFile($item_info->thumb_file_srl);
	if($file)
		$item_info->thumbnail_url = getFullUrl().$file->download_url;
}
Context::set('oDocument', $oDocumentModel->getDocument($item_info->document_srl));
// editor
Context::set('document_srl', $item_info->document_srl);
Context::set('editor', $oEditorModel->getModuleEditor('document', $this->module_info->module_srl, $item_info->document_srl, 'document_srl', 'description'));
Context::set('item_info', $item_info);

아래와 같이 수정
$oSvitemModel = &getModel('svitem');
$oConfig = $oSvitemModel->getModuleConfig();
Context::set('config',$oConfig);
$nItemSrl = Context::get('item_srl');
$oItemInfo = $oSvitemModel->getItemInfoByItemSrl($nItemSrl);
$sUaType = Context::get('ua_type');
switch($sUaType)
{
	case 'mob':
	case 'pc':
		break;
	default:
		$sUaType = 'mob';
}

Context::set('ua_type', $sUaType );
if($oItemInfo->thumb_file_srl)
{
	$oFileModel = &getModel('file');
	$oFile = $oFileModel->getFile($oItemInfo->thumb_file_srl);
	if($oFile)
		$oItemInfo->thumbnail_url = getFullUrl().$oFile->download_url;
}
$oDocumentModel = &getModel('document');
$oDocument = $oDocumentModel->getDocument($oItemInfo->document_srl);
//Context::set('oDocument', $oDocumentModel->getDocument($oItemInfo->document_srl));
//Context::set('document_srl', $oItemInfo->document_srl);
if( $sUaType == 'mob' )
	$oItemInfo->sDescription = $oDocument->getContentText();
elseif( $sUaType == 'pc' )
{
	if( !$oItemInfo->pc_doc_srl )
	{
		$oItemInfo->document_srl = getNextSequence();
		$oItemInfo->pc_doc_srl = $oItemInfo->document_srl;
	}
	else
		$oItemInfo->document_srl = $oItemInfo->pc_doc_srl;
	$oItemInfo->sDescription = htmlentities($oItemInfo->pc_description);
}
if( !$oItemInfo->gallery_doc_srl )
	$oItemInfo->gallery_doc_srl = getNextSequence();
Context::set('item_info', $oItemInfo);

// editor
$oEditorModel = &getModel('editor');
Context::set('editor', $oEditorModel->getModuleEditor('document', $this->module_info->module_srl, $oItemInfo->document_srl, 'document_srl', 'description'));

// gallery image editor
$oOption->content_key_name = 'null';
$oOption->height = 1;
$oOption->allow_fileupload = true;
$oOption->primary_key_name = 'document_srl';
Context::set('gallery_editor', $oEditorModel->getEditor( $oItemInfo->gallery_doc_srl, $oOption)); // 갤러리 첨부파일 로드하기 위한 hidden 객체

./queries/updateAdminItem.xml에 아래의 코드 추가
<column name="mob_description" var="mob_description" />
<column name="pc_description" var="pc_description" />

./tpl/updateitem.html에 아래의 코드 추가
<input name="mob_doc_srl" type="hidden" value="{$item_info->document_srl}" />
<input name="pc_doc_srl" type="hidden" value="{$item_info->pc_doc_srl}" />
<input name="gallery_doc_srl" type="hidden" value="{$item_info->gallery_doc_srl}" />
<input name="ua_type" type="hidden" value="{$ua_type}" />

	<div class="x_control-group">
		<div class="x_control-label" for="editor2">갤러리 썸네일 <em style="color:red">*</em></div>
		<div class="x_controls">
			<!-- css -->
			<!-- JS -->
			<!--#JSPLUGIN:ckeditor--><div id="ckeditor_instance_{$item_info->gallery_doc_srl}" data-editor-sequence="{$item_info->gallery_doc_srl}" data-editor-primary-key-name="document_srl" style="visibility:hidden;" ></div>
				<!--#JSPLUGIN:jquery.fileupload--><!--#JSPLUGIN:jquery.finderSelect--><!--#JSPLUGIN:handlebars--><div id="xefu-container-{$item_info->gallery_doc_srl}" class="xefu-container xe-clearfix" data-editor-sequence="{$item_info->gallery_doc_srl}">
				<div class="xefu-dropzone">
					<span class="xefu-btn fileinput-button xefu-act-selectfile">
						<span><i class="xi-icon xi-file-add"></i> 파일 첨부</span>
						<input id="xe-fileupload" type="file" class="fileupload-processing " value="파일 첨부" name="Filedata" data-auto-upload="true" data-editor-sequence="{$item_info->gallery_doc_srl}" multiple />
					</span>
					<p class="xefu-dropzone-message">여기에 파일을 끌어 놓거나 파일 첨부 버튼을 클릭하세요.</p>
					<p class="upload_info">파일 크기 제한 : <span class="allowed_filesize">0MB</span> <span>(허용 확장자 : <span class="allowed_filetypes">*.*</span>)</span></p>
					<p class="xefu-progress-status" style="display: none;">파일 업로드 중... (<span class="xefu-progress-percent">0%</span>)</p>
					<div class="xefu-progressbar" style="display: none;"><div></div></div>
				</div>
				<div class="xefu-controll xe-clearfix">
					<div style="float: left;">
						<span class="file_count">0</span>개 첨부 됨 (<span class="attached_size"></span> / <span class="allowed_attach_size"></span>)
					</div>
					<div style="float: right">
						<input type="button" class="xefu-btn xefu-act-delete-selected" style=" vertical-align: middle; vertical-align: middle;" value="선택 삭제">
					</div>
				</div>
				<div class="xefu-list">
					<div class="xefu-list-images">
						<ul>
						</ul>
					</div>
					<div class="xefu-list-files">
						<ul>
						</ul>
					</div>
				</div>
			</div>
<script>
jQuery(function($){
// uploader
var setting = {
	maxFileSize: 104857600,
	limitMultiFileUploadSize: 104857600		
};
var uploader = $('#xefu-container-{$item_info->gallery_doc_srl}').xeUploader(setting);
window.xe.msg_exceeds_limit_size = '허용된 용량을 초과하여 첨부가 되지 않았습니다.';
window.xe.msg_checked_file_is_deleted = '%d개의 첨부 파일이 삭제되었습니다.';
window.xe.msg_file_cart_is_null = '삭제할 파일을 선택해주세요.';
window.xe.msg_checked_file_is_deleted = '%d개의 첨부 파일이 삭제되었습니다.';
window.xe.msg_not_allowed_filetype = '업로드할 수 없는 파일 형식입니다.';
window.xe.msg_file_upload_error = '파일 업로드 중 에러가 발생하였습니다.';
});
(function($){
"use strict";
// editor
$(function(){
	CKEDITOR.config.customConfig = '';
	var settings = {
		ckeconfig: {
			height: '1',
			skin: 'moono',
			contentsCss: './modules/editor/styles/ckeditor_light/editor.css',
			xe_editor_sequence: '{$item_info->gallery_doc_srl}',
			toolbarCanCollapse: true,
			language: "ko"
		},
		loadXeComponent: true,
		enableToolbar: true,
		content_field: jQuery('[name=]')
	};
	settings.enableToolbar = false;
	settings.ckeconfig.toolbarCanCollapse = false;
	settings.loadXeComponent = false;
	var ckeApp = $('#ckeditor_instance_{$item_info->gallery_doc_srl}').XeCkEditor(settings);
});
})(jQuery);
</script>
		</div>
	</div>
	<div class="x_control-group">
		<label class="x_control-label" for="taxfree">편집할 상세페이지 선택</label>
		<div class="x_controls">
			<label for="ua_type"><input type="radio" name="ua_type" id="ua_type" value="mob" checked="checked"|cond="$ua_type=='mob'||$ua_type==''" />MOB 상세페이지</label>
			<label for="ua_type"><input type="radio" name="ua_type" id="ua_type" value="pc" checked="checked"|cond="$ua_type=='pc'" />PC 상세페이지</label>
		</div>
		<div class="x_control-label" for="editor2">{$ua_type} {$lang->description} <em style="color:red">*</em></div>
		<div class="x_controls">
			{$editor}
		</div>
	</div>

./svitem.view.php::dispSvitemItemDetail()에 아래 코드 추가
$oFileModel = getModel('file');
$aGalleryImg = $oFileModel->getFiles($item_info->gallery_doc_srl, array(), 'file_srl', true);
if( count( $aGalleryImg ) )
{
	$aAllowdFileExtension = [ 'GIF', 'JPG', 'PNG', 'BMP', 'TIFF' ];
	foreach( $aGalleryImg as $nIdx => $oFile )
	{
		$aFileName = explode('.', $oFile->source_filename);
		$sFileExt = strtoupper( $aFileName[1] );
		if( in_array($sFileExt, $aAllowdFileExtension ) )
			$aGallery[] = $oFile->uploaded_filename;
	}
}
Context::set('visualArr', $aGallery);

./skins/~/itemdetail_thumb.html에서 아래의 코드를
<!--@if($item_info->extra_var_objs->thumbi->value)-->{@ $thumbi = $item_info->extra_var_objs->thumbi->value}<!--@else-->{@ $thumbi = 1}<!--@endif-->
{@ $uploaded_list = $oDocument->getUploadedFiles(); $filei = 0; }
<block loop="$uploaded_list=>$key,$file">
	<!--@if($filei < $thumbi)-->
		{@ $file_explode = explode(".",strtoupper($file->source_filename))}
		{@ $file_srl = substr($file->uploaded_filename, 1)}
		<!--@if($file_explode[1]=="GIF" || $file_explode[1]=="JPG" || $file_explode[1]=="PNG" || $file_explode[1]=="BMP")-->
			{@ $visualArr[$filei] = $file->uploaded_filename; $filei++; }
		<!--@end-->
	<!--@end-->
</block>
<block loop="$visualArr=>$key,$val" cond="$val">
	{@
		$thumbnail_path = sprintf('files/thumbnails/%s',getNumberingPath($module_info->module_srl, 3));
		$visual_source[$key] = strstr($val, 'files/');
		$visual_sfname[$key] = substr($visual_source[$key], 24, -4);
		$visual_file[$key] = sprintf('%s%s_r%dx%d.png', $thumbnail_path, $visual_sfname[$key], $module_info->thumbnail_width, $module_info->thumbnail_height);
		$visual_url[$key] = Context::getRequestUri().$visual_file[$key];
		if(!file_exists($visual_file[$key])) $output = FileHandler::createImageFile($visual_source[$key], $visual_file[$key], $module_info->thumbnail_width, $module_info->thumbnail_height, 'png', $module_info->thumbnail_type);
	}
</block>
<div class="item-thumb newclearfix">
	<a href="{$visualArr[0]}" class="jqzoom" rel='item-thumb' title="triumph">
		<img src="{$visual_url[0]}" style="width:{$module_info->thumbnail_width}px; height:{$module_info->thumbnail_height}px" />
	</a>
</div>
<div cond="$thumbi > 1" class="item-thumb-list newclearfix">
	<ul id="item-thumb-list">
		{@ $fileii=0}
		<li loop="$visualArr=>$key,$val">
			<a class="zoomThumbActive"|cond="$fileii==0" href='javascript:void(0);' rel="{gallery: 'item-thumb', smallimage: '{$visual_url[$fileii]}',largeimage: '{$visualArr[$fileii]}'}"><img src="{$visual_url[$key]}" style="width:50px; height:50px"></a>
			{@ $fileii++}
		</li>
	</ul>
</div>

아래와 같이 수정
<block cond="!count($visualArr)">
	<div class="item-thumb newclearfix">
		<a href="#" rel='item-thumb' title="triumph">
			<img src="./modules/svitem/skins/TrendshopS_sv/img/no_img_390x390.jpg" style="width:390px; height:390px" />
		</a>
	</div>
</block>
<block cond="count($visualArr)">
	<block loop="$visualArr=>$key,$val">
	{@
		$thumbnail_path = sprintf('files/thumbnails/%s',getNumberingPath($module_info->module_srl, 3));
		$visual_source[$key] = strstr($val, 'files/');
		$visual_sfname[$key] = substr($visual_source[$key], 24, -4);
		$visual_file[$key] = sprintf('%s%s_r%dx%d.png', $thumbnail_path, $visual_sfname[$key], $module_info->thumbnail_width, $module_info->thumbnail_height);
		$visual_url[$key] = Context::getRequestUri().$visual_file[$key];
		if(!file_exists($visual_file[$key])) $output = FileHandler::createImageFile($visual_source[$key], $visual_file[$key], $module_info->thumbnail_width, $module_info->thumbnail_height, 'png', $module_info->thumbnail_type);
	}
	</block>
	<div class="item-thumb newclearfix">
		<a href="{$visualArr[0]}" class="jqzoom" rel='item-thumb' title="triumph">
			<img src="{$visual_url[0]}" style="width:{$module_info->thumbnail_width}px; height:{$module_info->thumbnail_height}px" />
		</a>
	</div>
</block>
<div class="item-thumb-list newclearfix">
	<ul id="item-thumb-list">
		{@ $fileii=0}
		<li loop="$visualArr=>$key,$val">
			<a class="zoomThumbActive"|cond="$fileii==0" href='javascript:void(0);' rel="{gallery: 'item-thumb', smallimage: '{$visual_url[$fileii]}',largeimage: '{$visualArr[$fileii]}'}"><img src="{$visual_url[$key]}" style="width:50px; height:50px"></a>
			{@ $fileii++}
		</li>
	</ul>
</div>

./m.skins/~/itemdetail_thumb.html에서 아래의 코드를
<!--@if($item_info->extra_var_objs->thumbi->value)-->{@ $thumbi = $item_info->extra_var_objs->thumbi->value}<!--@else-->{@ $thumbi = 1}<!--@endif-->
{@ $uploaded_list = $oDocument->getUploadedFiles(); $filei = 0; }
<block loop="$uploaded_list=>$key,$file">
	<!--@if($filei < $thumbi)-->
		{@ $file_explode = explode(".",strtoupper($file->source_filename))}
		{@ $file_srl = substr($file->uploaded_filename, 1)}
		<!--@if($file_explode[1]=="GIF" || $file_explode[1]=="JPG" || $file_explode[1]=="PNG" || $file_explode[1]=="BMP")-->
			{@ $visualArr[$filei] = $file->uploaded_filename; $filei++; }
		<!--@end-->
	<!--@end-->
</block>
<block loop="$visualArr=>$key,$val" cond="$val">
	{@
		$thumbnail_path = sprintf('files/thumbnails/%s',getNumberingPath($module_info->module_srl, 3));
		$visual_source[$key] = strstr($val, 'files/');
		$visual_sfname[$key] = substr($visual_source[$key], 24, -4);
		$visual_file[$key] = sprintf('%s%s_r%dx%d.png', $thumbnail_path, $visual_sfname[$key], $module_info->thumbnail_width, $module_info->thumbnail_height);
		$visual_url[$key] = Context::getRequestUri().$visual_file[$key];
		if(!file_exists($visual_file[$key])) $output = FileHandler::createImageFile($visual_source[$key], $visual_file[$key], $module_info->thumbnail_width, $module_info->thumbnail_height, 'png', $module_info->thumbnail_type);
		$visual_file2[$key] = sprintf('%s%s_r%dx%d.png', $thumbnail_path, $visual_sfname[$key], 80, 80);
		$visual_url2[$key] = Context::getRequestUri().$visual_file2[$key];
		if(!file_exists($visual_file2[$key])) $output = FileHandler::createImageFile($visual_source[$key], $visual_file2[$key], 80, 80, 'png', 'crop');
	}
</block>

아래와 같이 수정
<block cond="!count($visualArr)">
	<div id="item-thumb" class="item-thumb">
		<div class="item">
			<img src="./modules/svitem/m.skins/trendshop/img/no_img_720x720.jpg" />
		</div>
	</div>
</block>
<block cond="count($visualArr)">
	<block loop="$visualArr=>$key,$val" cond="$val">
		{@
			$thumbnail_path = sprintf('files/thumbnails/%s',getNumberingPath($module_info->module_srl, 3));
			$visual_source[$key] = strstr($val, 'files/');
			$visual_sfname[$key] = substr($visual_source[$key], 24, -4);
			$visual_file[$key] = sprintf('%s%s_r%dx%d.png', $thumbnail_path, $visual_sfname[$key], $module_info->thumbnail_width, $module_info->thumbnail_height);
			$visual_url[$key] = Context::getRequestUri().$visual_file[$key];
			if(!file_exists($visual_file[$key])) $output = FileHandler::createImageFile($visual_source[$key], $visual_file[$key], $module_info->thumbnail_width, $module_info->thumbnail_height, 'png', $module_info->thumbnail_type);
			$visual_file2[$key] = sprintf('%s%s_r%dx%d.png', $thumbnail_path, $visual_sfname[$key], 80, 80);
			$visual_url2[$key] = Context::getRequestUri().$visual_file2[$key];
			if(!file_exists($visual_file2[$key])) $output = FileHandler::createImageFile($visual_source[$key], $visual_file2[$key], 80, 80, 'png', 'crop');
		}
	</block>
</block>

2. 비효율 코드 개선
./svitem.admin.view.php::dispSvitemAdminUpdateItem()에서 아래의 코드를
$oModuleModel = &getModel('module');
$oConfig = $oModuleModel->getModuleConfig('svitem');

Context::set('naver_ep_use', $oConfig->naver_ep_use);
Context::set('daum_ep_use', $oConfig->daum_ep_use);

$oFileModel = &getModel('file');
$oEditorModel = &getModel('editor');
$oDocumentModel = &getModel('document');
$oSvitemModel = &getModel('svitem');
$nItemSrl = Context::get('item_srl');
$oItemInfo = $oSvitemModel->getItemInfoByItemSrl($nItemSrl);

$config = $oSvitemModel->getModuleConfig();
Context::set('config',$config);

아래와 같이 변경
$oSvitemModel = &getModel('svitem');
$oConfig = $oSvitemModel->getModuleConfig();
Context::set('config',$oConfig);

$oFileModel = &getModel('file');
$oEditorModel = &getModel('editor');
$oDocumentModel = &getModel('document');
$nItemSrl = Context::get('item_srl');
$oItemInfo = $oSvitemModel->getItemInfoByItemSrl($nItemSrl);

3. 대표 썸네일 인덱스 지정 기능 추가
./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
$nRepGalleryThumbIdx = $item_info->enhanced_item_info->rep_gallery_thumb_idx;
if( $nRepGalleryThumbIdx ) // 대표 썸네일 번호 지정이라면
{
	$aTmpGallery = [];
	$aTmpGallery[] = $aGallery[$nRepGalleryThumbIdx];
	unset($aGallery[$nRepGalleryThumbIdx]);
	foreach( $aGallery as $nIdx => $sFilename )
		$aTmpGallery[] = $sFilename;
	$aGallery = $aTmpGallery;
}

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$nGalleryRepThumbnailIdx = Context::get('gallery_rep_thumbnail_idx');
if( $nGalleryRepThumbnailIdx )
{
	$oFileModel = getModel('file');
	$nThumFileCnt = $oFileModel->getFilesCount($nGalleryDocSrl);

	if( $nGalleryRepThumbnailIdx > $nThumFileCnt - 1 )
		return new Object(-1, 'msg_invalid_gallery_rep_thumbnail_idx');

	$oEnhancedItemInfo->rep_gallery_thumb_idx = $nGalleryRepThumbnailIdx;
}

3. 상세페이지 아카이브와 개별 상세페이지 선택 기능 추가
./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
if( strlen( $oHiddenExtraVars->description_skin_pc->value ) > 0 )
	Context::set('description_skin_pc_selected', $this->_g_sArchivePath.$oHiddenExtraVars->description_skin_pc->value);
if( strlen( $oHiddenExtraVars->description_skin_mob->value ) > 0 )
	Context::set('description_skin_mob_selected', $this->_g_sArchivePath.$oHiddenExtraVars->description_skin_mob->value);
// document
$oDocumentModel = &getModel('document');
$oDocument = $oDocumentModel->getDocument($item_info->document_srl);
Context::set('oDocument', $oDocument);

아래와 같이 변경
// for detail description
if(	Mobile::isMobileCheckByAgent() )
{
	if( strlen( $oHiddenExtraVars->description_skin_mob->value ) > 0 )
	{
		$oTemplate = &TemplateHandler::getInstance();
		$sTplItemDesc = $oTemplate->compile($this->_g_sArchivePath, $oHiddenExtraVars->description_skin_mob->value); 
	}
	else
	{
		$sTplItemDesc = $item_info->mob_description;
		if( strpos($sTplItemDesc, '%%PC%%') !== false )
			$sTplItemDesc = $item_info->pc_description;
	}
}
else
{
	if( strlen( $oHiddenExtraVars->description_skin_pc->value ) > 0 )
	{
		$oTemplate = &TemplateHandler::getInstance();
		$sTplItemDesc = $oTemplate->compile($this->_g_sArchivePath, $oHiddenExtraVars->description_skin_pc->value); 
	}
	else
	{
		$sTplItemDesc = $item_info->pc_description;
		if( strpos($sTplItemDesc, '%%MOB%%') !== false )
			$sTplItemDesc = $item_info->mob_description;
	}
}
Context::set('sItemDescription', $sTplItemDesc);

// for sns share
$oDocumentModel = &getModel('document');
$oDocument = $oDocumentModel->getDocument($item_info->document_srl);
$dbInfo = Context::getDBInfo();
$oSnsInfo->sPermanentUrl = $oDocument->getPermanentUrl().'?l='.$dbInfo->lang_type;
$oSnsInfo->sEncodedDocTitle = urlencode($oDocument->getTitle());
Context::set('oSnsInfo', $oSnsInfo);
unset( $oSnsInfo );
unset( $oDocument );
unset( $oDocumentModel );

./skins/~/itemdetail.html에서 아래의 코드를
<?
$sDescriptionSkinPath = Context::get('description_skin_pc_selected');
if( strlen( $sDescriptionSkinPath ) > 0 )
	include $sDescriptionSkinPath;
else
{
	$oContextDocument = Context::get('oDocument');
	echo $oContextDocument->getContent(false);
}
?>

아래와 같이 수정
{$sItemDescription}

./m.skins/~/itemdetail.html에서 아래의 코드를
<?
$sDescriptionSkinPath = Context::get('description_skin_mob_selected');
if( strlen( $sDescriptionSkinPath ) > 0 )
	include $sDescriptionSkinPath;
else
{
	$oContextDocument = Context::get('oDocument');
	echo $oContextDocument->getContent(false);
}
?>

아래와 같이 수정
{$sItemDescription}

./skins/~/itemdetail_thumb.html에서 아래의 코드를
<div id="sns-share" class="sns-share newclearfix" data-url="{$oDocument->getPermanentUrl().'?l='.$lang_type}" data-title="{urlencode($oDocument->getTitle())}">

아래와 같이 수정
<div id="sns-share" class="sns-share newclearfix" data-url="{$oSnsInfo->sPermanentUrl}" data-title="{$oSnsInfo->sEncodedDocTitle}">

./m.skins/~/itemdetail.html에서 아래의 코드를
<div id="sns-share" class="sns-share" data-url="{$oDocument->getPermanentUrl().'?l='.$lang_type}" data-title="{urlencode($oDocument->getTitle())}">

아래와 같이 수정
<div id="sns-share" class="sns-share" data-url="{$oSnsInfo->sPermanentUrl}" data-title="{$oSnsInfo->sEncodedDocTitle}">

4. 상품 간략 설명을 사용자정의변수에 기본 변수로 이동
./tpl/updateitem.html에 아래의 코드 추가
<div class="x_control-group">
	<label class="x_control-label" for="item_brief">{$lang->item_brief}</label>
	<div class="x_controls">
		<textarea name="item_brief" id="item_brief" class="item_brief" rows="8" cols="22" placeholder="{$lang->about_item_brief}">{$item_info->enhanced_item_info->item_brief}</textarea>
		<a href="#item_brief_help" class="x_icon-question-sign" data-toggle>{$lang->help}</a>
		<p id="item_brief_help" class="x_help-block" hidden>{$lang->about_item_brief}</p>
	</div>
</div>

./svitem.admin.controller.php::procSvitemAdminUpdateItem()에 아래의 코드 추가
$oEnhancedItemInfo->item_brief = trim( Context::get('item_brief' ) );

/skins/~/itemdetail_spec.html에서 아래의 코드를
<tr cond="$item_info->extra_var_objs->desc">
	<th>상품설명</th>
	<td>{$item_info->extra_var_objs->desc->value}</td>
</tr>

아래와 같이 수정
<tr cond="$item_info->enhanced_item_info->item_brief">
	<th>상품설명</th>
	<td>{$item_info->enhanced_item_info->item_brief}</td>
</tr>

./m.skins/~/itemdetail_spec.html에서 아래의 코드를
<tr cond="$item_info->extra_var_objs->desc->value">
	<th>상품설명</th>
	<td>{$item_info->extra_var_objs->desc->value}</td>
</tr>

아래와 같이 수정
<tr cond="$item_info->enhanced_item_info->item_brief">
	<th>상품설명</th>
	<td>{$item_info->enhanced_item_info->item_brief}</td>
</tr>

./svitem.view.php::dispSvitemItemDetail()에 아래의 코드 추가
if( $item_info->enhanced_item_info->item_brief == '%%OG%%' )
	$item_info->enhanced_item_info->item_brief = $oDocument->getContent(false);

5. 관리자 UI 오류 수정
./svitem.admin.controller.php::procSvitemAdminDeleteItemExtra()에서 아래의 코드를
$this->setRedirectUrl(getNotencodedUrl("","module","admin","act","dispSvitemAdminItemExtraSetup","module_srl",$module_srl));

아래와 같이 변경
$this->setRedirectUrl(getNotencodedUrl('','module','svshopmaster','act','dispSvitemAdminItemExtraSetup','module_srl',$module_srl));

v 3.1.22
1st, May 2020
1. 상품 신규 등록 코드 개선
./svitem.admin.controller.php::procSvitemAdminInsertItem()에서 아래의 코드를
$oFileController = &getController('file');
$args = Context::gets('module_srl','thumbnail_image','contents_file','thumbnail_image_1','thumbnail_image_2','thumbnail_image_3','thumbnail_image_4','thumbnail_image_5');
$args->item_srl = $item_srl;
if (is_uploaded_file($args->thumbnail_image['tmp_name']))
{
	$output = $oFileController->insertFile($args->thumbnail_image, $args->module_srl, $args->item_srl);
	if(!$output || !$output->toBool())
		return $output;
	$args->thumb_file_srl = $output->get('file_srl');
}
//if(is_uploaded_file($args->contents_file['tmp_name']))
//{
//	$output = $oFileController->insertFile($args->contents_file, $args->module_srl, $item_srl);
//	if(!$output || !$output->toBool())
//		return $output;
//	$args->file_srl = $output->get('file_srl');
//}
if(is_uploaded_file($args->thumbnail_image_1['tmp_name']))
{
	$output = $oFileController->insertFile($args->contents_file_1, $args->module_srl, $item_srl);
	if(!$output || !$output->toBool())
		return $output;
	$args->thumb_file_1_srl = $output->get('file_srl');
}
//if($args->file_srl || $args->thumb_file_srl || $args->thumb_file_1_srl)
if($args->thumb_file_srl || $args->thumb_file_1_srl)
{
	$output = executeQuery('svitem.updateItemFile', $args);
	if(!$output->toBool())
		return $output;
}
$oFileController->setFilesValid($item_srl);

아래와 같이 변경
$oFileController = &getController('file');
$args = Context::gets('module_srl','thumbnail_image');
$args->item_srl = $item_srl;
if (is_uploaded_file($args->thumbnail_image['tmp_name']))
{
	$output = $oFileController->insertFile($args->thumbnail_image, $args->module_srl, $args->item_srl);
	if(!$output || !$output->toBool())
		return $output;
	$args->thumb_file_srl = $output->get('file_srl');
}

if($args->thumb_file_srl)
{
	$output = executeQuery('svitem.updateItemFile', $args);
	if(!$output->toBool())
		return $output;
}
$oFileController->setFilesValid($item_srl);

v 3.1.23
1st, Jun 2020
1. 상품 썸네일에 .이 여러개인 이미지 파일 업로드 처리 기능 추가
./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
$aFileName = explode('.', $oFile->source_filename);
$sFileExt = strtoupper( $aFileName[1] );
if( in_array($sFileExt, $aAllowdFileExtension ) )
	$aGallery[] = $oFile->uploaded_filename;

아래와 같이 변경
$aFileName = explode('.', $oFile->source_filename);
$nChunk = count($aFileName);
$sFileExt = strtoupper( $aFileName[$nChunk-1] );
if( in_array($sFileExt, $aAllowdFileExtension ) )
	$aGallery[] = $oFile->uploaded_filename;

v 4.0.0
2nd, Aug 2020
1. extravar.class 기능 개선
./svitem.extravar.controller.php 추가

./svitem.class.php에서 아래의 코드 제거
require_once(_XE_PATH_.'modules/svitem/ExtraItem.class.php');

./svitem.admin.view.php::dispSvitemAdminItemExtraSetup()에서 아래의 코드를
$args->module_srl = Context::get('module_srl');
$output = executeQueryArray('svitem.getItemExtraList', $args);
if(!$output->toBool()) 
	return $output;
$ExtraList = $output->data;
Context::set('list', $ExtraList);

아래와 같이 변경
require_once(_XE_PATH_.'modules/svitem/svitem.extravar.controller.php');
$oExtraVarsController = new svitemExtraVarController();
$nModuleSrl = Context::get('module_srl');
$aRst = $oExtraVarsController->getItemExtraFormList($nModuleSrl);
Context::set('list', $aRst);
unset($aRst);
unset($oExtraVarsController);

./svitem.admin.controller.php::procSvitemAdminInsertItemExtra()에서 아래의 코드를
$args->module_srl = Context::get('module_srl');
$args->extra_srl = Context::get('extra_srl');
$args->column_type = Context::get('column_type');
$args->column_name = strtolower(Context::get('column_name'));
$args->column_title = Context::get('column_title');
$args->default_value = explode("\n", str_replace("\r", '', Context::get('default_value')));
$args->required = Context::get('required');
$args->is_active = (isset($args->required));
if(!in_array(strtoupper($args->required), array('Y','N')))
	$args->required = 'N';

$args->description = Context::get('description');
// check column_name
if($this->checkColumnName($args->module_srl, $args->column_name))
	return new Object(-1, 'msg_invalid_column_name');
$this->insertItemExtra($args);
if(!in_array(Context::getRequestMethod(),array('XMLRPC','JSON'))) 
{
	$returnUrl = Context::get('success_return_url') ? Context::get('success_return_url') : getNotEncodedUrl('', 'module', Context::get('module'), 'act', 'dispSvitemAdminItemExtraSetup');
	$this->setRedirectUrl($returnUrl);
	return;
}

아래와 같이 변경
$oArgs->module_srl = Context::get('module_srl');
$oArgs->extra_srl = Context::get('extra_srl');
$oArgs->column_type = Context::get('column_type');
$oArgs->column_name = strtolower(Context::get('column_name'));
$oArgs->column_title = Context::get('column_title');
$oArgs->default_value = explode("\n", str_replace("\r", '', Context::get('default_value')));
$oArgs->required = Context::get('required');
$oArgs->is_active = (isset($oArgs->required));
$oArgs->description = Context::get('description');
if(!in_array(strtoupper($oArgs->required), array('Y','N')))
	$oArgs->required = 'N';

require_once(_XE_PATH_.'modules/svitem/svitem.extravar.controller.php');
$oExtraVarsController = new svitemExtraVarController();
$oRst = $oExtraVarsController->addVar($oArgs);
if(!$oRst->toBool()) 
	return $oRst;
unset($oArgs);
unset($oRst);
unset($oExtraVarsController);
if(!in_array(Context::getRequestMethod(),array('XMLRPC','JSON'))) 
{
	$sReturnUrl = Context::get('success_return_url') ? Context::get('success_return_url') : getNotEncodedUrl('', 'module', Context::get('module'), 'act', 'dispSvitemAdminItemExtraSetup');
	$this->setRedirectUrl($sReturnUrl);
	return;
}

./svitem.admin.view.php::checkColumnName() 제거
./svitem.admin.view.php::insertItemExtra() 제거

./svitem.admin.controller.php::procSvitemAdminDeleteItemExtra()에서 아래의 코드를
$module_srl = Context::get('module_srl');
//DB 삭제부분
$args->extra_srl = Context::get('extra_srl');
$output = executeQuery('svitem.deleteItemExtra', $args);
if(!$output->toBool())
	return $output;
//dynamic ruleset 재생성
$oSvitemModel = &getModel('svitem');
$extra_vars = $oSvitemModel->getItemExtraFormList($module_srl);
$this->createInsertItemRuleset($extra_vars);
$this->setMessage('success_deleted');
if(!in_array(Context::getRequestMethod(),array('XMLRPC','JSON'))) 
	$this->setRedirectUrl(getNotencodedUrl('','module','svshopmaster','act','dispSvitemAdminItemExtraSetup','module_srl',$module_srl));

아래와 같이 변경
$nModuleSrl = Context::get('module_srl');
$oArgs->nModuleSrl = $nModuleSrl;
$oArgs->nExtraSrl = Context::get('extra_srl');
require_once(_XE_PATH_.'modules/svitem/svitem.extravar.controller.php');
$oExtraVarsController = new svitemExtraVarController();
$oRst = $oExtraVarsController->removeVar($oArgs);
if(!$oRst->toBool()) 
	return $oRst;
unset($oArgs);
unset($oRst);
unset($oExtraVarsController);
$this->setMessage('success_deleted');
if(!in_array(Context::getRequestMethod(),array('XMLRPC','JSON'))) 
	$this->setRedirectUrl(getNotencodedUrl('','module','svshopmaster','act','dispSvitemAdminItemExtraSetup','module_srl',$nModuleSrl));

./svitem.admin.model.php::getCombinedExtraVars() 추가

./svitem.model.php::getOutputsOnCatalogPage() 제거
./svitem.model.php::getDefaultDisplayConfig() 제거
./svitem.model.php::getOutputsOnDetailPage() 제거

./svitem.admin.controller.php::_insertListConfig() 제거
./svitem.admin.controller.php::_insertDetailListConfig() 제거

./svitem.admin.controller.php::_insertDisplayConfig() 추가

./svitem.admin.controller.php::procSvitemAdminInsertListDisplayConfig() 제거
./svitem.admin.controller.php::procSvitemAdminInsertDetailDisplayConfig() 제거

./svitem.admin.controller.php::procSvitemAdminSaveDisplayConfig() 추가

./svitem.view.php::dispSvitemItemList()에서 아래의 코드를
Context::set('list_config', $oSvitemModel->getOutputsOnCatalogPage($nModuleSrl));

아래와 같이 변경
require_once(_XE_PATH_.'modules/svitem/svitem.extravar.controller.php');
$oExtraVarsController = new svitemExtraVarController();
$oArgs->sPageType = 'catalog';
$oArgs->nModuleSrl = $this->module_info->module_srl;
Context::set('list_config', $oExtraVarsController->getCombinedExtraVars($oArgs));
unset($oArgs);

./svitem.view.php::dispSvitemItemDetail()에서 아래의 코드를
Context::set('list_config', $oSvitemModel->getOutputsOnDetailPage($this->module_info->module_srl));

아래와 같이 변경
require_once(_XE_PATH_.'modules/svitem/svitem.extravar.controller.php');
$oExtraVarsController = new svitemExtraVarController();
$oArgs->sPageType = 'detail';
$oArgs->nModuleSrl = $this->module_info->module_srl;
$aRst = $oExtraVarsController->getCombinedExtraVars($oArgs);
Context::set('list_config', $aRst);
unset($aRst); 
unset($oArgs);

2. item class 추가
./svitem.item_admin.php 추가
./svitem.item_consumer.php 추가

-------------------- todo -------------------------------
스킨에서 svcart_mid를 가져오지 말고 svitem_srl이 속한 svitem_module_srl에서 svcart_mid를 확인해야 함
이 데이터 불러오는 이유가 오직 장바구니를 확인하겠습니까 물어보기 위한 것일 뿐. 이 설정을 svitem으로 옮기면 안되나?
어떤 svcart_mid로 갈지는 svitem_module_info에 저장되어 있음.

./svitem.model.php::getItemStock()을 getItemInfoByItemSrl()의 종속 메소드로 변경해야 하나?

제품을 가상 쇼핑몰 페이지 사이 이동 기능 -> 기본적으로 svitem tbl과 document tbl의 module_srl 변경해야 함

./tpl/skin.js/itemdetail.js::_orderItemsDirectly()에서 svcart_mid를 별수로 입력하지 말고 svitem module srl만 입력하면 cart는 내부적으로 판단
./tpl/skin.js/itemdetail.js::_addItemsToCartObj()에서 svcart_mid를 별수로 입력하지 말고 svitem module srl만 입력하면 cart는 내부적으로 판단

카탈로그 단축 URL에 -> 카테고리 영문명 기능?

프로모션 정보가 naver, daum EP에 반영되도록 해야 함

tbl::xe_svitem_display_categories과 xe_svitem_display_items는 show window 개념으로 설계한 듯 -> namespace를 개념에 맞게 변경해줘야 함
svitem_display_categories tbl -> show_window_tabs 로 변경
svitem_display_category_item tbl -> show_window_item 로 변경

관리자 제품 상세 페이지 스킨 선택상자의 경로를 detail_page로 수정

getSvitemAdminGetCategoryListAjax()에서 getCatalog 사용으로 변경

tbl svtiem_items::category_node_srl을 catalog_node_srl로 변경할 때 daum_ep.txt 스킨에 반영해야 함

queries/updateCurrentStockCount.xml 관련 기능 조회하고 삭제
./svitem.controller.php::setItemStock() 관련 기능 정리해야 함 -> svcart에 걸쳐서 svorder까지 연관

svpromotionAdminView::dispSvpromotionAdminItemDiscountList()에서 호출하는 getSvitemAdminItemList()->_getItemList()의 인수를
context:get()에서 $oArgs 인수 입력으로 변경해야 함

동일 아이템에 대해 별도 색상 입력 기능
옵션을 아이템으로 연결

./svitem.model.php::getDaumEpList()과 ./svitem.model.php::getNaverEpList() 결합

item information을 XML로 변경 -> 후에 shopify와 같이 admin과 skin을 완전히 분리하기 위한 준비 작업